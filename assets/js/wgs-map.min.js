const WGSMap={config:{defaultCenter:[49.8,15.5],defaultZoom:7,maxZoom:19,tileUrl:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',debounceAutocomplete:300,debounceRoute:500,minCharsAutocomplete:2},map:null,markers:{},layers:{},controllers:{autocomplete:null,geocode:null,route:null},cache:{geocode:new Map,route:new Map},init(o,e={}){const t=window.logger||console;if("undefined"==typeof L)return t.error("Leaflet not loaded"),null;if(!document.getElementById(o))return t.error(`Map container #${o} not found`),null;try{const r=e.center||this.config.defaultCenter,n=e.zoom||this.config.defaultZoom;return this.map=L.map(o).setView(r,n),L.tileLayer(this.config.tileUrl,{maxZoom:this.config.maxZoom,attribution:this.config.attribution}).addTo(this.map),t.log("WGSMap initialized:",o),"function"==typeof e.onInit&&e.onInit(this.map),this.map}catch(o){return t.error("Map init error:",o),null}},addMarker(o,e,t={}){if(!this.map)return console.error("Map not initialized"),null;try{const r={};t.icon&&("string"==typeof t.icon?r.icon=L.divIcon({html:t.icon,className:t.iconClass||"",iconSize:t.iconSize||[50,30],iconAnchor:t.iconAnchor||[25,15]}):r.icon=t.icon),t.draggable&&(r.draggable=!0);const n=L.marker(e,r).addTo(this.map);return t.popup&&n.bindPopup(t.popup),t.onClick&&n.on("click",t.onClick),t.onDragEnd&&n.on("dragend",t.onDragEnd),this.markers[o]=n,n}catch(o){return console.error("Add marker error:",o),null}},removeMarker(o){this.markers[o]&&(this.map.removeLayer(this.markers[o]),delete this.markers[o])},async geocode(o){const e=window.logger||console;if(this.cache.geocode.has(o))return e.log("ðŸ“¦ Geocode cache hit:",o),this.cache.geocode.get(o);this.controllers.geocode&&(this.controllers.geocode.abort(),this.controllers.geocode=null),this.controllers.geocode=new AbortController;try{const e=await fetch(`api/geocode_proxy.php?action=search&address=${encodeURIComponent(o)}`,{signal:this.controllers.geocode.signal});if(e.ok){const t=await e.json();return this.cache.geocode.set(o,t),t}throw new Error(`Geocoding failed: ${e.status}`)}catch(o){if("AbortError"!==o.name)throw e.error("Geocode error:",o),o}finally{this.controllers.geocode=null}},async autocomplete(o,e={}){const t=window.logger||console;this.controllers.autocomplete&&(this.controllers.autocomplete.abort(),this.controllers.autocomplete=null),this.controllers.autocomplete=new AbortController;try{const t=e.type||"street",r=e.limit||5,n=e.country?String(e.country).toUpperCase():"",i=new URLSearchParams({text:o,format:"geojson",limit:r,apiKey:"ea590e7e6d3640f9a63ec5a9fb1ff002",lang:"cs"});if("city"===t&&i.append("type","city"),n){const o=n.split(",").map(o=>o.trim().toLowerCase());i.append("filter",`countrycode:${o.join(",")}`)}const a=await fetch(`https://api.geoapify.com/v1/geocode/autocomplete?${i.toString()}`,{signal:this.controllers.autocomplete.signal});if(a.ok)return await a.json();throw new Error(`Autocomplete failed: ${a.status}`)}catch(o){if("AbortError"!==o.name)throw t.error("Autocomplete error:",o),o}finally{this.controllers.autocomplete=null}},async calculateRoute(o,e){const t=window.logger||console,r=`${o.join(",")}-${e.join(",")}`;if(this.cache.route.has(r))return t.log("ðŸ“¦ Route cache hit"),this.cache.route.get(r);this.controllers.route&&(this.controllers.route.abort(),this.controllers.route=null),this.controllers.route=new AbortController;try{const t=await fetch(`api/geocode_proxy.php?action=route&start_lon=${o[1]}&start_lat=${o[0]}&end_lon=${e[1]}&end_lat=${e[0]}`,{signal:this.controllers.route.signal});if(t.ok){const o=await t.json();return this.cache.route.set(r,o),o}throw new Error(`Route calculation failed: ${t.status}`)}catch(o){if("AbortError"!==o.name)throw t.error("Route error:",o),o}finally{this.controllers.route=null}},drawRoute(o,e={}){if(!this.map)return console.error("Map not initialized"),null;e.layerId&&this.layers[e.layerId]&&this.map.removeLayer(this.layers[e.layerId]);const t=L.polyline(o,{color:e.color||"#006600",weight:e.weight||4,opacity:e.opacity||.7}).addTo(this.map);return!1!==e.fitBounds&&this.map.fitBounds(t.getBounds()),e.layerId&&(this.layers[e.layerId]=t),t},removeLayer(o){this.layers[o]&&(this.map.removeLayer(this.layers[o]),delete this.layers[o])},flyTo(o,e){this.map&&this.map.flyTo(o,e||this.map.getZoom())},clear(){Object.keys(this.markers).forEach(o=>{this.removeMarker(o)}),Object.keys(this.layers).forEach(o=>{this.removeLayer(o)}),this.cache.geocode.clear(),this.cache.route.clear()},destroy(){this.clear(),Object.keys(this.controllers).forEach(o=>{this.controllers[o]&&(this.controllers[o].abort(),this.controllers[o]=null)}),this.map&&(this.map.remove(),this.map=null)},debounce(o,e){if("function"==typeof window.debounce)return window.debounce(o,e);let t;return function(...r){clearTimeout(t),t=setTimeout(()=>{clearTimeout(t),o(...r)},e)}}};"undefined"!=typeof module&&module.exports&&(module.exports=WGSMap);
//# sourceMappingURL=wgs-map.min.js.map