const registrationForm=document.getElementById("registrationForm");async function getCsrfToken(e){if(!e)return null;const t=e.querySelector('input[name="csrf_token"]');if(t&&t.value)return t.value;try{const e=await fetch("app/controllers/get_csrf_token.php",{credentials:"same-origin"}),o=await e.json();if(("success"===o.status||!0===o.success)&&o.token)return t&&(t.value=o.token),o.token}catch(e){logger.error("CSRF fetch failed:",e)}return null}function showNotification(e,t="info"){const o=document.getElementById("notification");o&&(o.textContent=e,o.className=`notification ${t}`,o.style.display="block","error"!==t&&setTimeout(()=>{o.style.display="none"},3e3))}registrationForm.addEventListener("submit",async e=>{e.preventDefault();const t=document.getElementById("regKey").value.trim(),o=document.getElementById("regName").value.trim(),n=document.getElementById("regEmail").value.trim(),r=document.getElementById("regPhone").value.trim(),i=document.getElementById("regPassword").value,s=document.getElementById("regPasswordConfirm").value;if(t&&o&&n&&i)if(i.length<12)showNotification("Heslo musí mít alespoň 12 znaků","error");else if(i===s)try{const e=await getCsrfToken(registrationForm);if(!e)return void showNotification("Nepodařilo se ověřit bezpečnostní token. Obnovte stránku a zkuste to znovu.","error");const s=await fetch("app/controllers/registration_controller.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},credentials:"include",body:`registration_key=${encodeURIComponent(t)}&name=${encodeURIComponent(o)}&email=${encodeURIComponent(n)}&phone=${encodeURIComponent(r)}&password=${encodeURIComponent(i)}&csrf_token=${encodeURIComponent(e)}`}),a=await s.json();"success"===a.status?(showNotification(`Registrace úspěšná! Vaše ID: ${a.user_id}. Přesměrovávám...`,"success"),setTimeout(()=>{window.location.href="login.php"},2e3)):showNotification(a.message||"Registrace selhala","error")}catch(e){logger.error("Registration error:",e),showNotification("Chyba při registraci","error")}else showNotification("Hesla se neshodují","error");else showNotification("Vyplňte všechna povinná pole","error")}),logger.log("Registration system loaded");
//# sourceMappingURL=registration.min.js.map