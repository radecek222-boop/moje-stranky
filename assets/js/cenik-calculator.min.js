!function(){"use strict";const e=50.056725,t=14.577261,n=.28;let a="standalone";const i={diagnostika:110,prvniDil:205,dalsiDil:70,zakladniSazba:165,mechanismusPriplatek:45,druhaOsoba:95,material:50,vyzvednutiSklad:10},s={"btn.back":"Zpět","btn.addToProtocol":"Započítat","btn.exportPDF":"Export do PDF","btn.newCalculation":"Nová kalkulace","summary.transportation":"Dopravné","summary.inspection":"Inspekce / diagnostika","summary.upholsteryWork":"Čalounické práce","summary.part":"díl","summary.parts":"díly","summary.firstPart":"První díl","summary.additionalParts":"Další díly","summary.basicServiceRate":"Základní servisní sazba","summary.mechanicalParts":"Mechanické opravy","summary.mechanism":"mechanismus","summary.relaxMechanisms":"Relax mechanismy","summary.slidingMechanisms":"Výsuvné mechanismy","summary.secondPerson":"Druhá osoba (těžký nábytek)","summary.materialSupplied":"Materiál od WGS","summary.warehousePickup":"Vyzvednutí dílu na skladě","summary.claim":"reklamace","summary.claimNoTransport":"Reklamace - bez dopravného","summary.unknownAddress":"Neznámá adresa","alert.selectAddress":"Prosím vyberte adresu ze seznamu","alert.pdfError":"Chyba při generování PDF","alert.distanceError":"Chyba při výpočtu vzdálenosti","alert.distanceCalculationError":"Nelze vypočítat vzdálenost","alert.pdfLoading":"Generuji PDF..."};function o(e){if("function"==typeof window.t){const t=window.t(e);if(t&&t!==e)return t}return s[e]||e}const r={krok:1,adresa:null,vzdalenost:0,dopravne:0,reklamaceBezDopravy:!1,vyzvednutiSklad:!1,typServisu:"calouneni",pocetProduktu:1,sedaky:0,operky:0,podrucky:0,panely:0,relax:0,vysuv:0,tezkyNabytek:!1,material:!1,vlastniCena:!1,vlastniCenaHodnota:0};let d={...r};function l(){document.getElementById("kalkulacka")&&(function(){d={...r},window.stav=d,document.querySelectorAll('input[type="number"]').forEach(e=>{["sedaky","operky","podrucky","panely","relax","vysuv"].includes(e.id)&&(e.value=0),"pocetProduktu"===e.id&&(e.value=1)}),document.querySelectorAll('input[type="checkbox"]').forEach(e=>{["tezky-nabytek","material","reklamace-bez-dopravy","vyzvednuti-sklad","vlastni-cena-checkbox"].includes(e.id)&&(e.checked=!1)});const e=document.getElementById("vlastni-cena-input-wrapper");e&&(e.style.display="none");const t=document.getElementById("vlastni-cena-input");t&&(t.value="");const n=document.querySelector('input[name="service-type"][value="calouneni"]');n&&(n.checked=!0);const a=document.getElementById("distance-result");a&&(a.style.display="none");const i=document.getElementById("calc-address");i&&(i.value=""),document.querySelectorAll(".wizard-step").forEach(e=>{"step-address"===e.id?(e.classList.remove("hidden"),e.style.display="flex"):(e.classList.add("hidden"),e.style.display="none")}),p()}(),function(){const e=document.getElementById("calc-address"),t=document.getElementById("address-suggestions");if(!e)return;if(!t)return;let n;e.addEventListener("input",e=>{clearTimeout(n);const a=e.target.value.trim();a.length<3?t.classList.add("hidden"):n=setTimeout(()=>async function(e,t){try{const n=await WGSMap.autocomplete(e,{type:"street",limit:5,country:"CZ,SK"});n&&n.features&&n.features.length>0?function(e,t){t.innerHTML="",e.slice(0,5).forEach(e=>{const n=document.createElement("div");n.className="suggestion-item",n.textContent=e.properties.formatted||e.properties.address_line1||o("summary.unknownAddress"),n.addEventListener("click",()=>{const n=e.geometry.coordinates;c(e.properties.formatted||e.properties.address_line1,n[1],n[0]),t.classList.add("hidden")}),t.appendChild(n)}),t.classList.remove("hidden")}(n.features,t):t.classList.add("hidden")}catch(e){console.error("[Kalkulačka] Chyba autocomplete:",e),t.classList.add("hidden")}}(a,t),300)})}(),function(){document.querySelectorAll('input[name="service-type"]').forEach(e=>{e.addEventListener("change",e=>{d.typServisu=e.target.value})});["tezky-nabytek","material","vyzvednuti-sklad"].forEach(e=>{const t=document.getElementById(e);t&&t.addEventListener("change",t=>{const n=e.replace(/-/g,"");"tezkynabytek"===n?d.tezkyNabytek=t.target.checked:"vyzvednutisklad"===n?d.vyzvednutiSklad=t.target.checked:d[n]=t.target.checked})});const e=document.getElementById("reklamace-bez-dopravy");e&&e.addEventListener("change",e=>{if(d.reklamaceBezDopravy=e.target.checked,e.target.checked){d.dopravne=0;const e=document.getElementById("transport-cost");e&&(e.textContent="0.00 ("+o("summary.claim")+")")}else if(d.vzdalenost>0){d.dopravne=Math.round(2*d.vzdalenost*n*100)/100;const e=document.getElementById("transport-cost");e&&(e.textContent=d.dopravne.toFixed(2))}});const t=document.getElementById("vlastni-cena-checkbox"),a=document.getElementById("vlastni-cena-input-wrapper"),i=document.getElementById("vlastni-cena-input");t&&a&&t.addEventListener("change",e=>{d.vlastniCena=e.target.checked,e.target.checked?(a.style.display="block",i&&setTimeout(()=>i.focus(),100)):(a.style.display="none",d.vlastniCenaHodnota=0,i&&(i.value=""))});i&&i.addEventListener("input",e=>{d.vlastniCenaHodnota=parseFloat(e.target.value)||0});["pocetProduktu","sedaky","operky","podrucky","panely","relax","vysuv"].forEach(e=>{const t=document.getElementById(e);t&&t.addEventListener("change",()=>{d[e]=parseInt(t.value)||("pocetProduktu"===e?1:0),y()})})}(),p(),function(){const e=document.getElementById("step-address");if(!e)return;setTimeout(()=>{const t=e.offsetHeight;t>0&&document.querySelectorAll(".wizard-step").forEach(e=>{e.style.minHeight=t+"px"})},100)}())}async function c(a,i,s){document.getElementById("calc-address").value=a,d.adresa=a;try{const a="/api/geocode_proxy.php?action=route&start_lat="+e+"&start_lon="+t+"&end_lat="+i+"&end_lon="+s,r=await fetch(a),l=await r.json();if(l.routes&&l.routes.length>0){const e=l.routes[0].distance,t=Math.round(e/1e3);d.vzdalenost=t;const a=document.getElementById("reklamace-bez-dopravy"),i=a&&a.checked;i?(d.dopravne=0,d.reklamaceBezDopravy=!0):(d.dopravne=Math.round(2*t*n*100)/100,d.reklamaceBezDopravy=!1),document.getElementById("distance-value").textContent=t,document.getElementById("transport-cost").textContent=d.dopravne.toFixed(2)+(i?" ("+o("summary.claim")+")":""),document.getElementById("distance-result").classList.remove("hidden")}else wgsToast.error(o("alert.distanceError"))}catch(e){console.error("[Kalkulačka] Chyba výpočtu vzdálenosti:",e),wgsToast.error(o("alert.distanceCalculationError"))}}function p(){document.querySelectorAll(".progress-step").forEach((e,t)=>{t<d.krok?e.classList.add("active"):e.classList.remove("active")})}function u(){const e=document.getElementById("kalkulacka");e&&e.scrollIntoView({behavior:"smooth",block:"start"})}function y(){const e=d.sedaky+d.operky+d.podrucky+d.panely,t=d.pocetProduktu||1,n=document.getElementById("total-parts"),a=document.getElementById("parts-price-breakdown");if(n&&(n.textContent=e),a&&e>0){let n=0;const s=Math.min(t,e);if(1===s)1===e?(n=i.prvniDil,a.textContent=`(1× první díl = ${i.prvniDil}€)`):(n=i.prvniDil+(e-1)*i.dalsiDil,a.textContent=`(1× ${i.prvniDil}€ + ${e-1}× ${i.dalsiDil}€ = ${n}€)`);else{const t=e-s;n=s*i.prvniDil+t*i.dalsiDil,a.textContent=`(${s}× ${i.prvniDil}€ + ${t}× ${i.dalsiDil}€ = ${n}€)`}}else a&&(a.textContent="")}function m(){const e=document.getElementById("summary-details"),t=document.getElementById("grand-total");let n="",a=0;if("vlastni"===d.typServisu&&d.vlastniCenaHodnota>0)return n+=`<div class="summary-line" style="font-size: 1.1em;">\n                <span>Vlastní cena:</span>\n                <span class="summary-price">${d.vlastniCenaHodnota.toFixed(2)} €</span>\n            </div>`,d.vyzvednutiSklad?(n+=`<div class="summary-line">\n                    <span>${o("summary.warehousePickup")}:</span>\n                    <span class="summary-price">${i.vyzvednutiSklad.toFixed(2)} €</span>\n                </div>`,a=d.vlastniCenaHodnota+i.vyzvednutiSklad):a=d.vlastniCenaHodnota,d.reklamaceBezDopravy&&(n+=`<div class="summary-subline" style="color: #666; font-style: italic;">\n                    (${o("summary.claimNoTransport")})\n                </div>`),e.innerHTML=n,t.innerHTML=`<strong>${a.toFixed(2)} €</strong>`,void v();if(n+=`<div class="summary-line">\n            <span>${o("summary.transportation")} (${d.vzdalenost} km × 2 × 0.28€):</span>\n            <span class="summary-price">${d.dopravne.toFixed(2)} €</span>\n        </div>`,a+=d.dopravne,"diagnostika"===d.typServisu&&(n+=`<div class="summary-line">\n                <span>${o("summary.inspection")}:</span>\n                <span class="summary-price">${i.diagnostika.toFixed(2)} €</span>\n            </div>`,a+=i.diagnostika),"calouneni"===d.typServisu||"kombinace"===d.typServisu){const e=d.sedaky+d.operky+d.podrucky+d.panely,t=d.pocetProduktu||1,s=Math.min(t,e||1);if(e>0){let t;if(1===s)t=1===e?i.prvniDil:i.prvniDil+(e-1)*i.dalsiDil;else{const n=e-s;t=s*i.prvniDil+n*i.dalsiDil}const r=o(1===e?"summary.part":"summary.parts"),d=s>1?`, ${s} produkty`:"";if(n+=`<div class="summary-line">\n                    <span>${o("summary.upholsteryWork")} (${e} ${r}${d}):</span>\n                    <span class="summary-price">${t.toFixed(2)} €</span>\n                </div>`,1===s&&e>1)n+=`<div class="summary-subline">\n                        ↳ ${o("summary.firstPart")}: ${i.prvniDil}€, ${o("summary.additionalParts")}: ${e-1}× ${i.dalsiDil}€\n                    </div>`;else if(s>1){const t=e-s;n+=`<div class="summary-subline">\n                        ↳ ${s}× první díl: ${s}× ${i.prvniDil}€${t>0?`, další: ${t}× ${i.dalsiDil}€`:""}\n                    </div>`}a+=t}}if("mechanika"===d.typServisu||"kombinace"===d.typServisu){const e=d.relax+d.vysuv;if("mechanika"===d.typServisu&&(n+=`<div class="summary-line">\n                    <span>${o("summary.basicServiceRate")}:</span>\n                    <span class="summary-price">${i.zakladniSazba.toFixed(2)} €</span>\n                </div>`,a+=i.zakladniSazba),e>0){const t=e*i.mechanismusPriplatek;n+=`<div class="summary-line">\n                    <span>${o("summary.mechanicalParts")} (${e}× ${o("summary.mechanism")}):</span>\n                    <span class="summary-price">${t.toFixed(2)} €</span>\n                </div>`,d.relax>0&&(n+=`<div class="summary-subline">\n                        ↳ ${o("summary.relaxMechanisms")}: ${d.relax}× ${i.mechanismusPriplatek}€\n                    </div>`),d.vysuv>0&&(n+=`<div class="summary-subline">\n                        ↳ ${o("summary.slidingMechanisms")}: ${d.vysuv}× ${i.mechanismusPriplatek}€\n                    </div>`),a+=t}}d.tezkyNabytek&&(n+=`<div class="summary-line">\n                <span>${o("summary.secondPerson")}:</span>\n                <span class="summary-price">${i.druhaOsoba.toFixed(2)} €</span>\n            </div>`,a+=i.druhaOsoba),d.material&&(n+=`<div class="summary-line">\n                <span>${o("summary.materialSupplied")}:</span>\n                <span class="summary-price">${i.material.toFixed(2)} €</span>\n            </div>`,a+=i.material),d.vyzvednutiSklad&&(n+=`<div class="summary-line">\n                <span>${o("summary.warehousePickup")}:</span>\n                <span class="summary-price">${i.vyzvednutiSklad.toFixed(2)} €</span>\n            </div>`,a+=i.vyzvednutiSklad),e.innerHTML=n,t.innerHTML=`<strong>${a.toFixed(2)} €</strong>`,v()}function v(){const e=document.querySelector("#step-summary .wizard-buttons");e&&(e.innerHTML="protokol"===a?`\n                <button class="btn-secondary" data-action="previousStep">${o("btn.back")}</button>\n                <button class="btn-primary" data-action="zapocitatDoProtokolu">${o("btn.addToProtocol")}</button>\n            `:`\n                <button class="btn-secondary" data-action="previousStep">${o("btn.back")}</button>\n                <button class="btn-primary" data-action="exportovatCenikPDF">${o("btn.exportPDF")}</button>\n                <button class="btn-primary" data-action="resetovatKalkulacku">${o("btn.newCalculation")}</button>\n            `)}window.stav=d,window.addEventListener("DOMContentLoaded",()=>{document.getElementById("kalkulacka")&&l()}),window.initKalkulacka=l,window.nextStep=function(){const e=document.getElementById("kalkulacka")||document.getElementById("calculatorModalBody");if(1===d.krok&&d.vlastniCena){if(!d.vlastniCenaHodnota||d.vlastniCenaHodnota<=0)return void wgsToast.warning("Zadejte vlastní cenu");const t=document.getElementById("reklamace-bez-dopravy");t&&t.checked&&(d.reklamaceBezDopravy=!0,d.dopravne=0),d.adresa||(d.adresa=d.reklamaceBezDopravy?o("summary.claimNoTransport"):"-"),d.typServisu="vlastni";const n=e?e.querySelector(".wizard-step:not(.hidden)"):document.querySelector(".wizard-step:not(.hidden)");n&&(n.classList.add("hidden"),n.style.display="none"),d.krok=5,m();const a=document.getElementById("step-summary");return a&&(a.classList.remove("hidden"),a.style.display="flex"),p(),void u()}if(1===d.krok&&!d.adresa){const e=document.getElementById("reklamace-bez-dopravy");if(!(e&&e.checked))return void wgsToast.warning(o("alert.selectAddress"));d.dopravne=0,d.vzdalenost=0,d.reklamaceBezDopravy=!0,d.adresa=o("summary.claimNoTransport")}const t=e?e.querySelector(".wizard-step:not(.hidden)"):document.querySelector(".wizard-step:not(.hidden)");let n;if(t&&(t.classList.add("hidden"),t.style.display="none"),d.krok++,2===d.krok?n="step-service-type":3===d.krok?"diagnostika"===d.typServisu?(d.krok=4,n="step-extras"):n="calouneni"===d.typServisu?"step-upholstery":"mechanika"===d.typServisu?"step-mechanics":(d.typServisu,"step-upholstery"):4===d.krok?"kombinace"===d.typServisu&&t&&"step-upholstery"===t.id?(n="step-mechanics",d.krok=3):n="step-extras":5===d.krok&&(m(),n="step-summary"),!n)return;const a=document.getElementById(n);a&&(a.classList.remove("hidden"),a.style.display="flex"),p(),u()},window.previousStep=function(){const e=document.querySelector(".wizard-step:not(.hidden)");let t;e&&(e.classList.add("hidden"),e.style.display="none"),d.krok--,1===d.krok?t="step-address":2===d.krok?t="step-service-type":3===d.krok?"calouneni"===d.typServisu||"kombinace"===d.typServisu?t="step-upholstery":"mechanika"===d.typServisu&&(t="step-mechanics"):4===d.krok&&("kombinace"===d.typServisu&&e&&"step-mechanics"===e.id?(t="step-upholstery",d.krok=3):t="step-extras");const n=document.getElementById(t);n&&(n.classList.remove("hidden"),n.style.display="flex"),p(),u()},window.incrementCounter=function(e){const t=document.getElementById(e);if(t){const n=parseInt(t.max)||20;let a=parseInt(t.value)||0;a<n&&(t.value=a+1,d[e]=a+1,y())}},window.decrementCounter=function(e){const t=document.getElementById(e);if(t){let n=parseInt(t.value)||0;n>0&&(t.value=n-1,d[e]=n-1,y())}},window.predvyplnitAdresu=async function(e){if(!e||!e.trim())return;const t=document.getElementById("calc-address");t&&(t.value=e.trim());try{const t=await WGSMap.autocomplete(e,{type:"street",limit:1,country:"CZ,SK"});if(t&&t.features&&t.features.length>0){const n=t.features[0],a=n.geometry.coordinates,i=n.properties.formatted||e;await c(i,a[1],a[0])}}catch(e){console.warn("[Kalkulačka] Nepodařilo se geocodovat adresu:",e)}},window.resetovatKalkulacku=function(){d={krok:1,adresa:null,vzdalenost:0,dopravne:0,reklamaceBezDopravy:!1,vyzvednutiSklad:!1,typServisu:"calouneni",pocetProduktu:1,sedaky:0,operky:0,podrucky:0,panely:0,relax:0,vysuv:0,tezkyNabytek:!1,material:!1,vlastniCena:!1,vlastniCenaHodnota:0},window.stav=d,document.getElementById("calc-address").value="",document.getElementById("distance-result").classList.add("hidden"),document.getElementById("address-suggestions").classList.add("hidden"),document.querySelector('input[name="service-type"][value="calouneni"]').checked=!0;const e=document.getElementById("pocetProduktu");e&&(e.value=1),["sedaky","operky","podrucky","panely","relax","vysuv"].forEach(e=>{const t=document.getElementById(e);t&&(t.value=0)}),["tezky-nabytek","material","reklamace-bez-dopravy","vyzvednuti-sklad","vlastni-cena-checkbox"].forEach(e=>{const t=document.getElementById(e);t&&(t.checked=!1)});const t=document.getElementById("vlastni-cena-input-wrapper");t&&(t.style.display="none");const n=document.getElementById("vlastni-cena-input");n&&(n.value=""),document.querySelectorAll(".wizard-step").forEach(e=>{e.classList.add("hidden"),e.style.display="none"});const a=document.getElementById("step-address");a.classList.remove("hidden"),a.style.display="flex",p(),u()},window.exportovatCenikPDF=async function(){try{if(void 0===window.jspdf||"undefined"==typeof html2canvas)return void wgsToast.info(o("alert.pdfLoading"));if(document.fonts&&document.fonts.ready){await document.fonts.ready;try{await document.fonts.load("400 16px Poppins"),await document.fonts.load("700 16px Poppins")}catch(e){console.warn("[Kalkulačka] Font Poppins nelze načíst, použije se fallback")}}let e=d.dopravne;if("diagnostika"===d.typServisu&&(e+=i.diagnostika),"calouneni"===d.typServisu||"kombinace"===d.typServisu){const t=d.sedaky+d.operky+d.podrucky+d.panely,n=d.pocetProduktu||1,a=Math.min(n,t||1);if(t>0){let n;if(1===a)n=1===t?i.prvniDil:i.prvniDil+(t-1)*i.dalsiDil;else{const e=t-a;n=a*i.prvniDil+e*i.dalsiDil}e+=n}}if("mechanika"===d.typServisu||"kombinace"===d.typServisu){"mechanika"===d.typServisu&&(e+=i.zakladniSazba);const t=d.relax+d.vysuv;t>0&&(e+=t*i.mechanismusPriplatek)}d.tezkyNabytek&&(e+=i.druhaOsoba),d.material&&(e+=i.material),d.vyzvednutiSklad&&(e+=i.vyzvednutiSklad);const t=document.createElement("div");t.id="pdf-kalkulace-temp",t.style.cssText="\n                width: 794px !important;\n                min-width: 794px !important;\n                max-width: 794px !important;\n                padding: 40px;\n                background: white;\n                font-family: 'Poppins', sans-serif;\n                position: fixed;\n                left: -9999px;\n                top: 0;\n                box-sizing: border-box;\n            ";const n=(new Date).toLocaleDateString("cs-CZ"),a="font-size: 0.75em; color: #888; font-style: italic; display: block; margin-top: 2px;";let s=`\n                <div style="text-align: center; margin-bottom: 20px;">\n                    <h1 style="font-size: 28px; color: #4a4a4a; margin: 0 0 5px 0; font-weight: bold;">\n                        KALKULACE CENY SERVISU\n                    </h1>\n                    <span style="${a}">SERVICE PRICE CALCULATION</span>\n                    <p style="font-size: 14px; color: #666; margin: 10px 0 0 0;">\n                        Datum / Date: ${n}\n                    </p>\n                </div>\n\n                <hr style="border: none; border-top: 2px solid #4a4a4a; margin: 20px 0;">\n\n                <div style="margin: 20px 0;">\n                    <h3 style="font-size: 16px; color: #2a2a2a; margin: 0 0 3px 0; font-weight: bold;">\n                        Adresa zákazníka\n                    </h3>\n                    <span style="${a}">Customer Address</span>\n                    <p style="font-size: 14px; margin: 8px 0 5px 0;">${d.adresa||"Neuvedeno / Not specified"}</p>\n                    <p style="font-size: 14px; margin: 0;">Vzdálenost z dílny / Distance from workshop: ${d.vzdalenost} km</p>\n                </div>\n\n                <div style="margin: 30px 0; background: #f8f9fa; padding: 20px; border-radius: 8px;">\n                    <h3 style="font-size: 18px; color: #2a2a2a; margin: 0 0 3px 0; font-weight: bold;">\n                        Specifikace zakázky\n                    </h3>\n                    <span style="${a}">Order Specification</span>\n            `;const r={diagnostika:{cs:"Inspekce / Diagnostika",en:"Inspection / Diagnostics"},calouneni:{cs:"Čalounické práce",en:"Upholstery Work"},mechanika:{cs:"Mechanické práce",en:"Mechanical Work"},kombinace:{cs:"Kombinace čalounění a mechaniky",en:"Combination of Upholstery and Mechanical"}}[d.typServisu]||{cs:"Neuveden",en:"Not specified"};if(s+=`\n                    <p style="font-size: 14px; margin: 15px 0 8px 0;">\n                        <strong>Typ servisu / Service type:</strong><br>\n                        ${r.cs} <span style="color: #888; font-style: italic;">/ ${r.en}</span>\n                    </p>\n            `,"calouneni"===d.typServisu||"kombinace"===d.typServisu){s+='<p style="font-size: 14px; margin: 8px 0;"><strong>Čalounické práce</strong> <span style="color: #888; font-style: italic;">/ Upholstery Work</span></p>',s+='<ul style="margin: 5px 0 5px 20px; font-size: 14px; line-height: 1.8;">',d.sedaky>0&&(s+=`<li>Sedáky / Seat cushions: ${d.sedaky}×</li>`),d.operky>0&&(s+=`<li>Opěrky / Backrests: ${d.operky}×</li>`),d.podrucky>0&&(s+=`<li>Područky / Armrests: ${d.podrucky}×</li>`),d.panely>0&&(s+=`<li>Panely / Panels: ${d.panely}×</li>`);0===d.sedaky+d.operky+d.podrucky+d.panely&&(s+='<li style="color: #999;">Nebyly vybrány žádné díly / No parts selected</li>'),s+="</ul>"}if("mechanika"===d.typServisu||"kombinace"===d.typServisu){s+='<p style="font-size: 14px; margin: 8px 0;"><strong>Mechanické práce</strong> <span style="color: #888; font-style: italic;">/ Mechanical Work</span></p>',s+='<ul style="margin: 5px 0 5px 20px; font-size: 14px; line-height: 1.8;">',d.relax>0&&(s+=`<li>Relax mechanismy / Recliner mechanisms: ${d.relax}×</li>`),d.vysuv>0&&(s+=`<li>Elektrické díly / Electric parts: ${d.vysuv}×</li>`);0===d.relax+d.vysuv&&(s+='<li style="color: #999;">Nebyly vybrány žádné mechanismy / No mechanisms selected</li>'),s+="</ul>"}if(s+='<p style="font-size: 14px; margin: 8px 0;"><strong>Doplňkové služby</strong> <span style="color: #888; font-style: italic;">/ Additional Services</span></p>',s+='<ul style="margin: 5px 0 5px 20px; font-size: 14px; line-height: 1.8;">',d.tezkyNabytek&&(s+="<li>Druhá osoba / Second person (těžký nábytek / heavy furniture >50kg): Ano / Yes</li>"),d.material&&(s+="<li>Materiál dodán od WGS / Material supplied by WGS: Ano / Yes</li>"),d.vyzvednutiSklad&&(s+="<li>Vyzvednutí dílu na skladě / Part pickup at warehouse: Ano / Yes</li>"),d.tezkyNabytek||d.material||d.vyzvednutiSklad||(s+='<li style="color: #999;">Žádné doplňkové služby / No additional services</li>'),s+="</ul>",s+="</div>",s+=`\n                <div style="margin: 30px 0; background: #f0f0f0; padding: 20px; border-radius: 8px;">\n                    <h3 style="font-size: 18px; color: #2a2a2a; margin: 0 0 3px 0; font-weight: bold;">\n                        Cenová kalkulace\n                    </h3>\n                    <span style="${a}">Price Calculation</span>\n\n                    <table style="width: 100%; border-collapse: collapse; font-size: 14px; margin-top: 15px;">\n                        <tr style="border-bottom: 1px solid #ddd;">\n                            <td style="padding: 8px 0;">Dopravné / Transport (${d.vzdalenost} km × 2 × 0.28€)</td>\n                            <td style="padding: 8px 0; text-align: right; font-weight: bold;">${d.dopravne.toFixed(2)} €</td>\n                        </tr>\n            `,"diagnostika"===d.typServisu&&(s+=`\n                    <tr style="border-bottom: 1px solid #ddd;">\n                        <td style="padding: 8px 0;">Inspekce / Diagnostika <span style="color: #888; font-style: italic;">/ Inspection / Diagnostics</span></td>\n                        <td style="padding: 8px 0; text-align: right; font-weight: bold;">${i.diagnostika.toFixed(2)} €</td>\n                    </tr>\n                `),"calouneni"===d.typServisu||"kombinace"===d.typServisu){const e=d.sedaky+d.operky+d.podrucky+d.panely,t=d.pocetProduktu||1,n=Math.min(t,e||1);if(e>0){let t;if(1===n)t=1===e?i.prvniDil:i.prvniDil+(e-1)*i.dalsiDil;else{const a=e-n;t=n*i.prvniDil+a*i.dalsiDil}if(s+=`\n                        <tr style="border-bottom: 1px solid #ddd;">\n                            <td style="padding: 8px 0;">Čalounické práce / Upholstery (${e} ${1===e?"díl / part":"dílů / parts"}${n>1?`, ${n} produkty / products`:""})</td>\n                            <td style="padding: 8px 0; text-align: right; font-weight: bold;">${t.toFixed(2)} €</td>\n                        </tr>\n                    `,1===n&&e>1)s+=`\n                            <tr>\n                                <td colspan="2" style="padding: 4px 0 8px 20px; font-size: 12px; color: #666;">\n                                    ↳ První díl / First part: ${i.prvniDil}€, další / additional: ${e-1}× ${i.dalsiDil}€\n                                </td>\n                            </tr>\n                        `;else if(n>1){const t=e-n;s+=`\n                            <tr>\n                                <td colspan="2" style="padding: 4px 0 8px 20px; font-size: 12px; color: #666;">\n                                    ↳ ${n}× první díl / first part: ${n}× ${i.prvniDil}€${t>0?`, další / additional: ${t}× ${i.dalsiDil}€`:""}\n                                </td>\n                            </tr>\n                        `}}}if("mechanika"===d.typServisu||"kombinace"===d.typServisu){"mechanika"===d.typServisu&&(s+=`\n                        <tr style="border-bottom: 1px solid #ddd;">\n                            <td style="padding: 8px 0;">Základní servisní sazba / Basic service fee</td>\n                            <td style="padding: 8px 0; text-align: right; font-weight: bold;">${i.zakladniSazba.toFixed(2)} €</td>\n                        </tr>\n                    `);const e=d.relax+d.vysuv;if(e>0){if(s+=`\n                        <tr style="border-bottom: 1px solid #ddd;">\n                            <td style="padding: 8px 0;">Mechanické části / Mechanical parts (${e}× mechanism)</td>\n                            <td style="padding: 8px 0; text-align: right; font-weight: bold;">${(e*i.mechanismusPriplatek).toFixed(2)} €</td>\n                        </tr>\n                    `,d.relax>0||d.vysuv>0){let e="";d.relax>0&&(e+=`Relax / Recliner: ${d.relax}× ${i.mechanismusPriplatek}€`),d.vysuv>0&&(e&&(e+=", "),e+=`Elektrické / Electric: ${d.vysuv}× ${i.mechanismusPriplatek}€`),s+=`\n                            <tr>\n                                <td colspan="2" style="padding: 4px 0 8px 20px; font-size: 12px; color: #666;">\n                                    ↳ ${e}\n                                </td>\n                            </tr>\n                        `}}}d.tezkyNabytek&&(s+=`\n                    <tr style="border-bottom: 1px solid #ddd;">\n                        <td style="padding: 8px 0;">Druhá osoba / Second person (>50kg)</td>\n                        <td style="padding: 8px 0; text-align: right; font-weight: bold;">${i.druhaOsoba.toFixed(2)} €</td>\n                    </tr>\n                `),d.material&&(s+=`\n                    <tr style="border-bottom: 1px solid #ddd;">\n                        <td style="padding: 8px 0;">Materiál od WGS / Material from WGS</td>\n                        <td style="padding: 8px 0; text-align: right; font-weight: bold;">${i.material.toFixed(2)} €</td>\n                    </tr>\n                `),d.vyzvednutiSklad&&(s+=`\n                    <tr style="border-bottom: 1px solid #ddd;">\n                        <td style="padding: 8px 0;">Vyzvednutí dílu / Part pickup</td>\n                        <td style="padding: 8px 0; text-align: right; font-weight: bold;">${i.vyzvednutiSklad.toFixed(2)} €</td>\n                    </tr>\n                `),s+=`\n                        <tr style="border-top: 3px solid #4a4a4a;">\n                            <td style="padding: 15px 0; font-size: 18px; font-weight: bold;">CELKOVÁ CENA / TOTAL PRICE</td>\n                            <td style="padding: 15px 0; text-align: right; font-size: 18px; font-weight: bold; color: #2a2a2a;">\n                                ${e.toFixed(2)} €\n                            </td>\n                        </tr>\n                    </table>\n                </div>\n\n                <div style="background: #f5f5f5; border-left: 4px solid #666; padding: 15px; margin: 30px 0; font-size: 12px; color: #666;">\n                    Ceny jsou uvedeny bez DPH. / Prices are excluding VAT.\n                </div>\n\n                <div style="text-align: center; margin-top: 50px; font-size: 11px; color: #999;">\n                    <p style="margin: 5px 0;"><strong>White Glove Service s.r.o.</strong> | www.wgs-service.cz</p>\n                    <p style="margin: 5px 0;">Do Dubče 364, Běchovice 190 11 | Tel: +420 725 965 826</p>\n                    <p style="margin: 5px 0;">Vygenerováno / Generated: ${(new Date).toLocaleString("cs-CZ")}</p>\n                </div>\n            `,t.innerHTML=s,document.body.appendChild(t),await new Promise(e=>setTimeout(e,100));const l=await html2canvas(t,{scale:3,backgroundColor:"#ffffff",useCORS:!0,logging:!1,imageTimeout:0,allowTaint:!0,letterRendering:!0}),{jsPDF:c}=window.jspdf,p=new c("p","mm","a4"),u=l.toDataURL("image/jpeg",.98),y=210,m=10,v=y-2*m,k=297-2*m,g=l.height/l.width;let h=v,f=h*g;f>k&&(f=k,h=f/g);const x=(y-h)/2,b=m;p.addImage(u,"JPEG",x,b,h,f),document.body.removeChild(t);const w=`kalkulace_${(new Date).getTime()}.pdf`;p.save(w)}catch(e){console.error("[Kalkulačka] Chyba při exportu PDF:",e),wgsToast.error(o("alert.pdfError"))}},window.nastavitKalkulackuRezim=function(e){a=e},window.zapocitatDoProtokolu=function(){let e=d.dopravne;if("diagnostika"===d.typServisu&&(e+=i.diagnostika),"calouneni"===d.typServisu||"kombinace"===d.typServisu){const t=d.sedaky+d.operky+d.podrucky+d.panely,n=d.pocetProduktu||1,a=Math.min(n,t||1);if(t>0){let n;if(1===a)n=1===t?i.prvniDil:i.prvniDil+(t-1)*i.dalsiDil;else{const e=t-a;n=a*i.prvniDil+e*i.dalsiDil}e+=n}}if("mechanika"===d.typServisu||"kombinace"===d.typServisu){"mechanika"===d.typServisu&&(e+=i.zakladniSazba);const t=d.relax+d.vysuv;t>0&&(e+=t*i.mechanismusPriplatek)}d.tezkyNabytek&&(e+=i.druhaOsoba),d.material&&(e+=i.material),d.vyzvednutiSklad&&(e+=i.vyzvednutiSklad);const t={celkovaCena:e,adresa:d.adresa,vzdalenost:d.vzdalenost,dopravne:d.dopravne,reklamaceBezDopravy:d.reklamaceBezDopravy,vyzvednutiSklad:d.vyzvednutiSklad,typServisu:d.typServisu,rozpis:{diagnostika:"diagnostika"===d.typServisu?i.diagnostika:0,calouneni:{pocetProduktu:d.pocetProduktu||1,sedaky:d.sedaky,operky:d.operky,podrucky:d.podrucky,panely:d.panely},mechanika:{relax:d.relax,vysuv:d.vysuv},doplnky:{tezkyNabytek:d.tezkyNabytek,material:d.material,vyzvednutiSklad:d.vyzvednutiSklad}}};void 0!==window.protokolKalkulacka&&"function"==typeof window.protokolKalkulacka.zpracovatVysledek?window.protokolKalkulacka.zpracovatVysledek(t):(console.error("[Kalkulačka] Funkce protokolKalkulacka.zpracovatVysledek není dostupná!"),wgsToast.error("Chyba: Nelze přenést data do protokolu."))}}(),void 0!==window.Utils&&window.Utils.registerAction&&(window.Utils.registerAction("nextStep",()=>{"function"==typeof window.nextStep&&window.nextStep()}),window.Utils.registerAction("previousStep",()=>{"function"==typeof window.previousStep&&window.previousStep()}),window.Utils.registerAction("incrementCounter",(e,t)=>{t.counter&&"function"==typeof window.incrementCounter&&window.incrementCounter(t.counter)}),window.Utils.registerAction("decrementCounter",(e,t)=>{t.counter&&"function"==typeof window.decrementCounter&&window.decrementCounter(t.counter)}),window.Utils.registerAction("exportovatCenikPDF",()=>{"function"==typeof window.exportovatCenikPDF&&window.exportovatCenikPDF()}),window.Utils.registerAction("resetovatKalkulacku",()=>{"function"==typeof window.resetovatKalkulacku&&window.resetovatKalkulacku()}),window.Utils.registerAction("zapocitatDoProtokolu",()=>{"function"==typeof window.zapocitatDoProtokolu&&window.zapocitatDoProtokolu()}));