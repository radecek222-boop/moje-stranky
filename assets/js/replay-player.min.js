!function(){"use strict";const t={config:{canvasId:"replay-canvas",timelineId:"replay-timeline",playPauseButtonId:"play-pause-btn",speedSelectId:"speed-select",currentTimeId:"current-time",totalTimeId:"total-time",defaultSpeed:1,speeds:[.5,1,2,4]},state:{frames:[],currentFrameIndex:0,isPlaying:!1,playbackSpeed:1,startTime:null,animationFrameId:null,canvas:null,ctx:null,cursorX:0,cursorY:0,sessionId:null,pageIndex:null},init:function(t,e){return this.state.sessionId=t,this.state.pageIndex=e,this.state.canvas=document.getElementById(this.config.canvasId),this.state.canvas?(this.state.ctx=this.state.canvas.getContext("2d"),this.loadReplayData(t,e),this.setupControls(),console.log("[Replay Player] Inicializováno pro session:",t,"page:",e),!0):(console.error("[Replay Player] Canvas nenalezen:",this.config.canvasId),!1)},loadReplayData:async function(t,e){const a=document.querySelector('[name="csrf_token"]').value,s=document.getElementById("loading-message");s&&(s.textContent="Načítám replay data...");try{const n=await fetch(`/api/analytics_replay.php?session_id=${encodeURIComponent(t)}&page_index=${e}&csrf_token=${encodeURIComponent(a)}`),i=await n.json();if("success"===i.status){this.state.frames=i.data.frames,this.state.canvas.width=i.data.viewport.width,this.state.canvas.height=i.data.viewport.height;const t=i.data.duration_ms,e=document.getElementById(this.config.totalTimeId);e&&(e.textContent=this.formatTime(t));const a=document.getElementById("page-info");a&&(a.textContent=`${i.data.page_url} (${i.data.total_frames} framů, ${this.formatTime(t)})`),console.log("[Replay Player] Data načtena:",this.state.frames.length,"framů"),s&&(s.style.display="none"),this.drawFrame(0)}else console.error("[Replay Player] Chyba:",i.message),s&&(s.textContent="Chyba: "+i.message,s.style.color="red")}catch(t){console.error("[Replay Player] Síťová chyba:",t),s&&(s.textContent="Síťová chyba: "+t.message,s.style.color="red")}},setupControls:function(){const t=document.getElementById(this.config.playPauseButtonId);t&&t.addEventListener("click",()=>{this.state.isPlaying?this.pause():this.play()});const e=document.getElementById(this.config.speedSelectId);e&&e.addEventListener("change",t=>{this.setSpeed(parseFloat(t.target.value))});const a=document.getElementById(this.config.timelineId);a&&a.addEventListener("input",t=>{const e=parseFloat(t.target.value);this.seekToPercent(e)})},play:function(){if(0===this.state.frames.length)return;this.state.isPlaying=!0,this.state.startTime=Date.now()-this.getCurrentTimestamp()/this.state.playbackSpeed,this.animatePlayback();const t=document.getElementById(this.config.playPauseButtonId);t&&(t.textContent="⏸ Pause")},pause:function(){this.state.isPlaying=!1,this.state.animationFrameId&&cancelAnimationFrame(this.state.animationFrameId);const t=document.getElementById(this.config.playPauseButtonId);t&&(t.textContent="▶ Play")},animatePlayback:function(){if(!this.state.isPlaying)return;const t=(Date.now()-this.state.startTime)*this.state.playbackSpeed,e=this.findFrameIndexByTimestamp(t);e>=this.state.frames.length?this.pause():(this.drawFrame(e),this.updateTimeline(),this.state.animationFrameId=requestAnimationFrame(this.animatePlayback.bind(this)))},drawFrame:function(t){if(t<0||t>=this.state.frames.length)return;const e=this.state.frames[t];switch(this.state.currentFrameIndex=t,this.state.ctx.clearRect(0,0,this.state.canvas.width,this.state.canvas.height),e.event_type){case"mousemove":this.state.cursorX=e.event_data.x||0,this.state.cursorY=e.event_data.y||0;break;case"click":this.drawClickAnimation(e.event_data.x||0,e.event_data.y||0),this.state.cursorX=e.event_data.x||0,this.state.cursorY=e.event_data.y||0;break;case"scroll":this.drawScrollIndicator(e.event_data.scroll_percent||0)}this.drawCursor(this.state.cursorX,this.state.cursorY)},drawCursor:function(t,e){const a=this.state.ctx;a.fillStyle="rgba(0, 0, 0, 0.2)",a.beginPath(),a.arc(t+2,e+2,8,0,2*Math.PI),a.fill(),a.fillStyle="#666",a.beginPath(),a.arc(t,e,8,0,2*Math.PI),a.fill(),a.fillStyle="#fff",a.beginPath(),a.arc(t,e,3,0,2*Math.PI),a.fill()},drawClickAnimation:function(t,e){const a=this.state.ctx;a.strokeStyle="#888",a.lineWidth=3;for(let s=1;s<=3;s++)a.globalAlpha=1-.3*s,a.beginPath(),a.arc(t,e,20*s,0,2*Math.PI),a.stroke();a.globalAlpha=1},drawScrollIndicator:function(t){const e=this.state.ctx,a=this.state.canvas.height,s=this.state.canvas.width-10-5;e.fillStyle="rgba(200, 200, 200, 0.3)",e.fillRect(s,0,10,a);const n=t/100*a;e.fillStyle="rgba(51, 51, 51, 0.7)",e.fillRect(s,0,10,n)},updateTimeline:function(){const t=this.state.frames[this.state.currentFrameIndex];if(!t)return;const e=t.timestamp_offset,a=this.state.frames[this.state.frames.length-1].timestamp_offset,s=a>0?e/a*100:0,n=document.getElementById(this.config.timelineId);n&&(n.value=s);const i=document.getElementById(this.config.currentTimeId);i&&(i.textContent=this.formatTime(e))},seekToPercent:function(t){if(0===this.state.frames.length)return;const e=t/100*this.state.frames[this.state.frames.length-1].timestamp_offset,a=this.findFrameIndexByTimestamp(e);this.drawFrame(a);const s=document.getElementById(this.config.currentTimeId);s&&(s.textContent=this.formatTime(e))},setSpeed:function(t){const e=this.state.isPlaying;e&&this.pause(),this.state.playbackSpeed=t,e&&this.play()},findFrameIndexByTimestamp:function(t){for(let e=0;e<this.state.frames.length;e++)if(this.state.frames[e].timestamp_offset>=t)return e;return this.state.frames.length-1},formatTime:function(t){const e=Math.floor(t/1e3);return`${Math.floor(e/60)}:${(e%60).toString().padStart(2,"0")}`},getCurrentTimestamp:function(){return this.state.currentFrameIndex>=this.state.frames.length?0:this.state.frames[this.state.currentFrameIndex].timestamp_offset}};window.ReplayPlayer=t}();
//# sourceMappingURL=replay-player.min.js.map