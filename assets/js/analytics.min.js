const ANALYTICS={currentUser:null,timePeriod:"week",data:{stats:{},visits:[],events:[]}};function inicializovatEventListeners(){document.querySelectorAll(".time-btn").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault();const n=t.getAttribute("data-timeperiod");logger.log("‚è∞ Zmƒõna obdob√≠ na:",n),nastavCasoveObdobi(n)})}),logger.log("Event listeners registrov√°ny")}async function checkAuth(){try{const t=await fetch("app/admin_session_check.php");if(t.ok){const e=await t.json();if(e.authenticated)return ANALYTICS.currentUser={name:e.username||"Admin",email:e.email||"admin@wgs.cz",role:e.role||"admin"},void(document.getElementById("userName").textContent=ANALYTICS.currentUser.name)}}catch(t){console.error("Session check error:",t)}window.location.href="login.php"}function nastavCasoveObdobi(t){logger.log("üìÖ Nastavuji ƒçasov√© obdob√≠:",t),ANALYTICS.timePeriod=t,document.querySelectorAll(".time-btn").forEach(e=>{e.classList.remove("active"),e.getAttribute("data-timeperiod")===t&&e.classList.add("active")}),zobrazitNacitani(),nactiData()}function zobrazitNacitani(){document.getElementById("total-visits").textContent="-",document.getElementById("unique-visitors").textContent="-",document.getElementById("avg-duration").textContent="-",document.getElementById("bounce-rate").textContent="-",document.getElementById("conversion-rate").textContent="-",document.getElementById("visits-change").textContent="Naƒç√≠t√°n√≠...",document.getElementById("unique-change").textContent="Naƒç√≠t√°n√≠...",document.getElementById("duration-change").textContent="Naƒç√≠t√°n√≠...",document.getElementById("bounce-change").textContent="Naƒç√≠t√°n√≠...",document.getElementById("conversion-change").textContent="Naƒç√≠t√°n√≠..."}async function nactiData(){logger.log("üì° Naƒç√≠t√°m analytics data pro obdob√≠:",ANALYTICS.timePeriod);try{const t=await fetch(`/api/analytics_api.php?period=${ANALYTICS.timePeriod}`);if(logger.log("[Stats] Response status:",t.status),!t.ok)return void logger.error("Response nen√≠ OK!");const e=await t.json();logger.log("üì¶ P≈ôijat√° data:",e),"success"===e.status?(ANALYTICS.data.stats=e.data.stats||{},ANALYTICS.data.topPages=e.data.topPages||[],ANALYTICS.data.referrers=e.data.referrers||[],ANALYTICS.data.browsersDevices=e.data.browsersDevices||{browsers:[],devices:[]},ANALYTICS.data.timeline=e.data.timeline||[],logger.log("Data √∫spƒõ≈°nƒõ naƒçtena"),aktualizovatUI()):logger.error("API error:",e.message)}catch(t){logger.error("Fetch error:",t)}}function aktualizovatUI(){const t=ANALYTICS.data.stats;if(!t)return void logger.error("≈Ω√°dn√° stats data");logger.log("üé® Aktualizuji UI s daty:",t),document.getElementById("total-visits").textContent=formatNumber(t.totalVisits||0),document.getElementById("unique-visitors").textContent=formatNumber(t.uniqueVisitors||0),document.getElementById("avg-duration").textContent=formatDuration(t.avgDuration||0),document.getElementById("bounce-rate").textContent=(t.bounceRate||0)+"%",document.getElementById("conversion-rate").textContent=(t.conversionRate||0).toFixed(1)+"%",document.getElementById("online-now").textContent=Math.floor(15*Math.random())+5;const e=getPeriodText();document.getElementById("visits-change").innerHTML=`Za ${e}`,document.getElementById("visits-change").className="stat-change",document.getElementById("unique-change").innerHTML=`Za ${e}`,document.getElementById("unique-change").className="stat-change",document.getElementById("duration-change").innerHTML=`Za ${e}`,document.getElementById("duration-change").className="stat-change",document.getElementById("bounce-change").innerHTML=`Za ${e}`,document.getElementById("bounce-change").className="stat-change",document.getElementById("conversion-change").innerHTML=`Za ${e}`,document.getElementById("conversion-change").className="stat-change",zobrazitTopStranky(),zobrazitReferrery(),zobrazitProhlizece(),zobrazitZarizeni(),vykreslitGraf(),logger.log("UI √∫spƒõ≈°nƒõ aktualizov√°no")}function getPeriodText(){switch(ANALYTICS.timePeriod){case"today":return"dnes";case"week":return"posledn√≠ch 7 dn√≠";case"month":return"posledn√≠ch 30 dn√≠";case"year":return"posledn√≠ch 365 dn√≠";default:return"zvolen√© obdob√≠"}}function formatNumber(t){return new Intl.NumberFormat("cs-CZ").format(t)}function formatDuration(t){return`${Math.floor(t/60)}:${(t%60).toString().padStart(2,"0")}`}function zobrazitTopStranky(){const t=document.querySelector("#top-pages-table tbody"),e=ANALYTICS.data.topPages||[];0!==e.length?t.innerHTML=e.map(t=>`\n        <tr style="border-bottom: 1px solid #e5e7eb;">\n            <td style="padding: 0.75rem;">\n                <div style="font-weight: 500; color: #1d1f2c;">${t.page_title||t.page_url}</div>\n                <div style="font-size: 0.75rem; color: #6b7280;">${t.page_url}</div>\n            </td>\n            <td style="padding: 0.75rem;">${formatNumber(t.visits)}</td>\n            <td style="padding: 0.75rem;">${formatNumber(t.unique_visitors)}</td>\n            <td style="padding: 0.75rem;">${formatDuration(Math.round(t.avg_duration))}</td>\n        </tr>\n    `).join(""):t.innerHTML='<tr><td colspan="4" style="text-align: center; padding: 2rem; color: #999;">≈Ω√°dn√° data k zobrazen√≠</td></tr>'}function zobrazitReferrery(){const t=document.querySelector("#referrers-table tbody"),e=ANALYTICS.data.referrers||[];0!==e.length?t.innerHTML=e.map(t=>`\n        <tr style="border-bottom: 1px solid #e5e7eb;">\n            <td style="padding: 0.75rem; font-weight: 500;">${t.referrer_source}</td>\n            <td style="padding: 0.75rem;">${formatNumber(t.visits)}</td>\n            <td style="padding: 0.75rem;">${formatNumber(t.unique_visitors)}</td>\n        </tr>\n    `).join(""):t.innerHTML='<tr><td colspan="3" style="text-align: center; padding: 2rem; color: #999;">≈Ω√°dn√° data k zobrazen√≠</td></tr>'}function zobrazitProhlizece(){const t=document.querySelector("#browsers-table tbody"),e=ANALYTICS.data.browsersDevices?.browsers||[];0!==e.length?t.innerHTML=e.map(t=>`\n            <tr style="border-bottom: 1px solid #e5e7eb;">\n                <td style="padding: 0.75rem; font-weight: 500;">${parsujUserAgent(t.user_agent)}</td>\n                <td style="padding: 0.75rem;">${formatNumber(t.visits)}</td>\n            </tr>\n        `).join(""):t.innerHTML='<tr><td colspan="2" style="text-align: center; padding: 2rem; color: #999;">≈Ω√°dn√° data k zobrazen√≠</td></tr>'}function zobrazitZarizeni(){const t=document.querySelector("#devices-table tbody"),e=ANALYTICS.data.browsersDevices?.devices||[];0!==e.length?t.innerHTML=e.map(t=>`\n        <tr style="border-bottom: 1px solid #e5e7eb;">\n            <td style="padding: 0.75rem; font-weight: 500;">${t.screen_resolution}</td>\n            <td style="padding: 0.75rem;">${formatNumber(t.visits)}</td>\n        </tr>\n    `).join(""):t.innerHTML='<tr><td colspan="2" style="text-align: center; padding: 2rem; color: #999;">≈Ω√°dn√° data k zobrazen√≠</td></tr>'}window.addEventListener("DOMContentLoaded",()=>{logger.log("[Start] Analytics dashboard inicialization..."),checkAuth(),nactiData(),inicializovatEventListeners()});let visitsChart=null;function vykreslitGraf(){const t=document.getElementById("visits-chart");if(!t)return;const e=ANALYTICS.data.timeline||[];if(0===e.length){const e=t.getContext("2d");return e.clearRect(0,0,t.width,t.height),e.font="14px Poppins",e.fillStyle="#999",e.textAlign="center",void e.fillText("≈Ω√°dn√° data k zobrazen√≠",t.width/2,t.height/2)}visitsChart&&visitsChart.destroy();const n=e.map(t=>t.time_period),o=e.map(t=>parseInt(t.visits)),a=e.map(t=>parseInt(t.unique_visitors)),r=t.getContext("2d");visitsChart=new Chart(r,{type:"line",data:{labels:n,datasets:[{label:"Celkem n√°v≈°tƒõv",data:o,borderColor:"#3b82f6",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.4,fill:!0},{label:"Unik√°tn√≠ n√°v≈°tƒõvn√≠ci",data:a,borderColor:"#10b981",backgroundColor:"rgba(16, 185, 129, 0.1)",tension:.4,fill:!0}]},options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{position:"top",labels:{font:{family:"Poppins",size:12}}}},scales:{y:{beginAtZero:!0,ticks:{font:{family:"Poppins"}}},x:{ticks:{font:{family:"Poppins",size:11},maxRotation:45,minRotation:45}}}}})}function parsujUserAgent(t){return t?t.includes("Chrome")?"Chrome":t.includes("Firefox")?"Firefox":t.includes("Safari")?"Safari":t.includes("Edge")?"Edge":t.includes("Opera")?"Opera":"Ostatn√≠":"Nezn√°m√Ω"}function exportAnalytics(t){"csv"===t?exportToCSV():"pdf"===t&&alert("PDF export - p≈ôipraveno pro budouc√≠ implementaci")}function exportToCSV(){const t=new Date;let e="\ufeffWHITE GLOVE SERVICE - WEB ANALYTICS\n";e+=`Datum exportu: ${t.toLocaleDateString("cs-CZ")} ${t.toLocaleTimeString("cs-CZ")}\n`,e+=`Obdob√≠: ${ANALYTICS.timePeriod}\n\n`,e+="HLAVN√ç METRIKY\n",e+="Metrika;Hodnota\n",e+=`Celkem n√°v≈°tƒõv;${ANALYTICS.data.stats.totalVisits||0}\n`,e+=`Unik√°tn√≠ n√°v≈°tƒõvn√≠ci;${ANALYTICS.data.stats.uniqueVisitors||0}\n`,e+=`Pr≈Ømƒõrn√° doba;${formatDuration(ANALYTICS.data.stats.avgDuration||0)}\n`,e+=`Bounce rate;${ANALYTICS.data.stats.bounceRate||0}%\n`,e+=`Konverze;${ANALYTICS.data.stats.conversionRate||0}%\n\n`;const n=new Blob([e],{type:"text/csv;charset=utf-8;"}),o=URL.createObjectURL(n),a=document.createElement("a");a.href=o,a.download=`WGS_Analytics_${t.toISOString().split("T")[0]}.csv`,a.click(),URL.revokeObjectURL(o)}function logout(){window.location.href="logout.php"}
//# sourceMappingURL=analytics.min.js.map