async function getCSRFToken(){if(window.csrfTokenCache)return window.csrfTokenCache;try{const e=await fetch("/app/controllers/get_csrf_token.php",{credentials:"same-origin"}),n=await e.json();return"success"===n.status&&n.token?(window.csrfTokenCache=n.token,n.token):null}catch(e){return console.error("CSRF Error:",e),null}}function showCsrfError(e){if(document.getElementById("csrf-warning"))return;const n=document.createElement("div");n.id="csrf-warning",n.className="csrf-error-notification",n.innerHTML=`\n        <strong>Bezpečnostní upozornění</strong>\n        <p>${e}</p>\n        <button data-action="reloadPage">Obnovit stránku</button>\n    `,n.style.cssText='\n        position: fixed;\n        top: 20px;\n        left: 50%;\n        transform: translateX(-50%);\n        z-index: 10003;\n        background: linear-gradient(135deg, #333 0%, #555 100%);\n        color: white;\n        padding: 20px 25px;\n        border-radius: 8px;\n        box-shadow: 0 6px 20px rgba(0,0,0,0.4);\n        max-width: 400px;\n        width: 90%;\n        text-align: center;\n        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;\n        animation: slideDown 0.3s ease-out;\n    ';const t=n.querySelector("strong");t&&(t.style.cssText="display: block; font-size: 1.1rem; margin-bottom: 8px;");const o=n.querySelector("p");o&&(o.style.cssText="margin: 10px 0 15px 0; font-size: 0.95rem; line-height: 1.4;");const r=n.querySelector("button");r&&(r.style.cssText="\n            background: white;\n            color: #d32f2f;\n            border: none;\n            padding: 10px 20px;\n            border-radius: 5px;\n            font-weight: 600;\n            cursor: pointer;\n            font-size: 0.9rem;\n            transition: all 0.2s;\n        ",r.onmouseover=()=>r.style.transform="scale(1.05)",r.onmouseout=()=>r.style.transform="scale(1)");const s=document.createElement("style");s.textContent="\n        @keyframes slideDown {\n            from {\n                opacity: 0;\n                transform: translateX(-50%) translateY(-20px);\n            }\n            to {\n                opacity: 1;\n                transform: translateX(-50%) translateY(0);\n            }\n        }\n    ",document.head.appendChild(s),document.body.appendChild(n),"undefined"!=typeof logger&&logger.error("CSRF warning displayed to user")}fetch("/app/controllers/get_csrf_token.php",{credentials:"same-origin"}).then(e=>e.json()).then(e=>{"success"===e.status?(window.csrfTokenCache=e.token,document.querySelectorAll("form").forEach(n=>{let t=n.querySelector('input[name="csrf_token"]');t||(t=document.createElement("input"),t.type="hidden",t.name="csrf_token",n.appendChild(t)),t.value=e.token}),"undefined"!=typeof logger&&logger.log("CSRF tokens injected")):(console.error("CSRF token fetch failed:",e),showCsrfError("Bezpečnostní token se nepodařilo načíst. Zkontrolujte připojení."))}).catch(e=>{console.error("CSRF Error:",e),showCsrfError("Bezpečnostní token se nepodařilo načíst. Obnovte stránku.")}),"undefined"!=typeof Utils&&Utils.registerAction&&Utils.registerAction("reloadPage",()=>{location.reload()});