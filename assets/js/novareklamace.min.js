const logger=window.logger||console,CONSTANTS={MAX_PHOTOS:10,MAX_IMAGE_WIDTH:1200,IMAGE_QUALITY:.85,AUTOCOMPLETE_DEBOUNCE:150,AUTOCOMPLETE_MIN_CHARS:2,ROUTE_DEBOUNCE:500,WARRANTY_YEARS:2,PSC_LENGTH:5,PHONE_MIN_LENGTH:9},WGS={photos:[],povereniPDF:null,map:null,companyLocation:window.WGS_COMPANY_LOCATION||{lat:50.080312092724114,lon:14.598113797415476},isLoggedIn:!1,calculateRouteTimeout:null,init(){logger.log("[Start] WGS init..."),this.checkLoginStatus(),this.initUserMode(),this.initCalculationDisplay(),this.initMobileMenu(),this.initMap(),this.initForm(),this.initPhotos(),this.initPovereniPDF(),this.initProvedeni(),this.initLanguage(),this.initCustomCalendar(),this.initTypZakaznika()},initTypZakaznika(){const e=document.getElementById("objednavkaICO"),t=document.getElementById("objednavkaFyzicka");e&&t&&(e.addEventListener("change",()=>{e.checked&&(t.checked=!1)}),t.addEventListener("change",()=>{t.checked&&(e.checked=!1)}),logger.log("[TypZakaznika] Inicializov√°ny vz√°jemnƒõ v√Ωluƒçn√© checkboxy"))},checkLoginStatus(){const e=localStorage.getItem("wgs_user_token")||sessionStorage.getItem("wgs_user_token");this.isLoggedIn=void 0!==window.WGS_USER_LOGGED_IN?window.WGS_USER_LOGGED_IN:!!e,logger.log("[User] Logged in:",this.isLoggedIn)},initMap(){"undefined"!=typeof WGSMap?(this.map=WGSMap.init("mapContainer",{center:[49.8,15.5],zoom:7,onInit:e=>{logger.log("Map initialized via WGSMap"),this.initAddressGeocoding()}}),this.map||logger.error("Map initialization failed")):logger.error("WGSMap module not loaded")},initAddressGeocoding(){const e=document.getElementById("ulice"),t=document.getElementById("mesto"),o=document.getElementById("psc"),n=(e,t)=>{WGSMap.removeMarker("customer"),WGSMap.addMarker("customer",[e,t],{draggable:!1}),WGSMap.flyTo([e,t],15),logger.log(`[Loc] Map updated to GPS: ${e}, ${t}`)};this.updateMapWithGPS=n;const a=async()=>{const a=e.value.trim(),s=t.value.trim(),r=o.value.trim();if(a.toLowerCase().includes("do dubƒçe")&&a.includes("364"))return void n(50.08026389885034,14.59812452579323);if(!s&&!r)return;const i=`${a}, ${s}, ${r}, Czech Republic`;try{const e=await WGSMap.geocode(i);if(e&&e.features&&e.features.length>0){const[t,o]=e.features[0].geometry.coordinates;n(o,t)}}catch(e){logger.error("Geocoding error:",e)}};this.geocodeAddress=a,e&&e.addEventListener("blur",a),t&&t.addEventListener("blur",a),o&&o.addEventListener("blur",a),this.initAutocomplete()},initAutocomplete(){const e=document.getElementById("ulice"),t=document.getElementById("mesto"),o=document.getElementById("autocompleteDropdownUlice"),n=document.getElementById("autocompleteDropdown");const a=(e,t)=>{if(!t)return r(e);const o=r(e),n=s(t),a=new RegExp(`(${n})`,"gi");return o.replace(a,"<strong>$1</strong>")},s=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),r=e=>{if(!e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML};if(e&&o){const t=WGSMap.debounce(async t=>{if(t.length<CONSTANTS.AUTOCOMPLETE_MIN_CHARS)o.classList.add("hidden");else try{const n=document.getElementById("mesto").value.trim(),s=document.getElementById("psc").value.trim();let r=t;n&&(r+=`, ${n}`),s&&(r+=`, ${s}`);const i=n||s?10:15,l=await WGSMap.autocomplete(r,{type:"street",limit:i,country:"CZ,SK"});if(l&&l.features&&l.features.length>0){o.innerHTML="",o.classList.remove("hidden");l.features.sort((e,t)=>{const o=(e.properties.housenumber?1:0)+(e.properties.postcode?1:0);return(t.properties.housenumber?1:0)+(t.properties.postcode?1:0)-o}).forEach(s=>{const r=document.createElement("div");r.style.padding="0.8rem",r.style.cursor="pointer",r.style.borderBottom="1px solid #eee",r.style.fontSize="0.9rem",r.style.transition="all 0.2s";const i=s.properties.street||s.properties.name||"",l=s.properties.housenumber||"",d=s.properties.city||"",c=s.properties.postcode||"",m=s.properties.state||"",u=s.properties.country||"",p=`${i} ${l}`.trim();let g="";g=c?`${d} (${c})`:d,!n&&m&&m!==d&&(g+=`, ${m}`),u&&"Czechia"!==u&&(g+=` ‚Ä¢ ${u}`),r.innerHTML=`\n                <div style="font-weight: 500; color: #333;">${a(p,t)}</div>\n                ${g?`<div style="font-size: 0.85rem; color: #666; margin-top: 0.2rem;">${g}</div>`:""}\n              `,r.addEventListener("mouseenter",()=>{r.style.background="#f0f7ff",r.style.transform="translateX(4px)"}),r.addEventListener("mouseleave",()=>{r.style.background="white",r.style.transform="translateX(0)"}),r.addEventListener("click",()=>{e.value=p,d&&(document.getElementById("mesto").value=d),c&&(document.getElementById("psc").value=c);const[t,n]=s.geometry.coordinates;this.updateMapWithGPS(n,t),o.classList.add("hidden"),this.toast("Adresa vyplnƒõna","success")}),o.appendChild(r)})}else o.classList.add("hidden")}catch(e){logger.error("Autocomplete error:",e),o.classList.add("hidden")}},CONSTANTS.AUTOCOMPLETE_DEBOUNCE);e.addEventListener("input",e=>{t(e.target.value.trim())})}if(t&&n){const e=WGSMap.debounce(async e=>{if(e.length<CONSTANTS.AUTOCOMPLETE_MIN_CHARS)n.classList.add("hidden");else try{const o=await WGSMap.autocomplete(e,{type:"city",limit:5,country:"CZ,SK"});if(o&&o.features&&o.features.length>0){n.innerHTML="",n.classList.remove("hidden");o.features.sort((e,t)=>{const o=e.properties.postcode?1:0;return(t.properties.postcode?1:0)-o}).forEach(o=>{const s=document.createElement("div");s.style.padding="0.8rem",s.style.cursor="pointer",s.style.borderBottom="1px solid #eee",s.style.fontSize="0.9rem",s.style.transition="all 0.2s";const r=o.properties.city||o.properties.name||"",i=o.properties.postcode||"";s.innerHTML=`\n                <div style="font-weight: 500; color: #333;">${a(r,e)}</div>\n                ${i?`<div style="font-size: 0.85rem; color: #666; margin-top: 0.2rem;">PSƒå: ${i}</div>`:""}\n              `,s.addEventListener("mouseenter",()=>{s.style.background="#f0f7ff",s.style.transform="translateX(4px)"}),s.addEventListener("mouseleave",()=>{s.style.background="white",s.style.transform="translateX(0)"}),s.addEventListener("click",()=>{if(t.value=r,i&&(document.getElementById("psc").value=i),n.classList.add("hidden"),this.toast("Mƒõsto vybr√°no","success"),o.geometry&&o.geometry.coordinates){const[e,t]=o.geometry.coordinates;this.updateMapWithGPS(t,e)}}),n.appendChild(s)})}else n.classList.add("hidden")}catch(e){logger.error("Autocomplete error:",e),n.classList.add("hidden")}},CONSTANTS.AUTOCOMPLETE_DEBOUNCE);t.addEventListener("input",t=>{e(t.target.value.trim())})}document.addEventListener("click",a=>{const s=o&&o.contains(a.target),r=n&&n.contains(a.target);o&&!s&&a.target!==e&&o.classList.add("hidden"),n&&!r&&a.target!==t&&n.classList.add("hidden")})},async calculateRoute(e,t){logger.log("V√Ωpoƒçet trasy vypnut (API nefunguje)")},renderRoute(e){const{coordinates:t,distance:o,duration:n,start:a}=e;WGSMap.drawRoute(t,{color:"#2563eb",weight:4,opacity:.7,layerId:"route",fitBounds:!0}),WGSMap.addMarker("company",[a.lat,a.lon],{icon:'<div style="background: #10b981; color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 3px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">üè¢</div>',iconClass:"custom-marker-start",iconSize:[30,30]});const s=(o/1e3).toFixed(1),r=Math.ceil(n/60);this.toast(`üöó Trasa: ${s} km, cca ${r} min`,"info"),logger.log(`Trasa vypoƒç√≠t√°na: ${s} km, ${r} min`),this.routeInfo={distance:s,duration:r}},checkAndUpdateMapFromAddress(){const e=document.getElementById("ulice");e&&e.value.trim()&&(logger.log("Checking pre-filled address..."),this.geocodeAddress&&this.geocodeAddress())},initUserMode(){const e=document.getElementById("modeInfo"),o=document.getElementById("calculatorBox"),n="true"===new URLSearchParams(window.location.search).get("from_calculator");if(this.isLoggedIn)o&&o.classList.add("hidden"),e&&(e.classList.remove("hidden"),e.style.borderLeftColor="#006600",e.style.background="#f0fff0",document.getElementById("modeTitle").textContent=t("mode_seller_title"),document.getElementById("modeDescription").textContent=t("mode_seller_desc")),logger.log("[List] Mode: Seller");else{const a=document.getElementById("cislo"),s=document.getElementById("datum_prodeje"),r=document.getElementById("datum_reklamace"),i=document.getElementById("doplnujici_info");o&&!n&&o.classList.remove("hidden"),a&&(a.removeAttribute("readonly"),a.value="",a.placeholder="ƒå√≠slo objedn√°vky/reklamace od prodejce (pokud m√°te)",a.style.backgroundColor="",a.style.cursor="text"),s&&(s.value="nevypl≈àuje se",s.readOnly=!0,s.style.backgroundColor="#f5f5f5",s.style.cursor="not-allowed",s.classList.add("disabled-field")),r&&(r.value="nevypl≈àuje se",r.readOnly=!0,r.style.backgroundColor="#f5f5f5",r.style.cursor="not-allowed",r.classList.add("disabled-field")),i&&(i.value="nevypl≈àuje se",i.readOnly=!0,i.style.backgroundColor="#f5f5f5",i.style.cursor="not-allowed"),e&&(e.classList.remove("hidden"),document.getElementById("modeTitle").textContent=t("mode_customer_title"),document.getElementById("modeDescription").textContent=t("mode_customer_desc")),logger.log("[List] Mode: Customer")}},initCalculationDisplay(){const e=new URLSearchParams(window.location.search);if("true"===e.get("from_calculator")){const t=document.getElementById("calculationBox");if(t){t.classList.remove("hidden");const o=e.get("calc_total");document.getElementById("calculationTotal").textContent=o}}},initMobileMenu(){const e=document.getElementById("hamburger"),t=document.getElementById("nav"),o=document.getElementById("menuOverlay");e&&t&&o?(logger.log("üì± Initializing mobile menu..."),e.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation(),e.classList.toggle("active"),t.classList.toggle("active"),o.classList.toggle("active"),window.scrollLock&&(t.classList.contains("active")?window.scrollLock.enable("novareklamace-menu"):window.scrollLock.disable("novareklamace-menu"))}),o.addEventListener("click",()=>{e.classList.remove("active"),t.classList.remove("active"),o.classList.remove("active"),window.scrollLock&&window.scrollLock.disable("novareklamace-menu")}),t.querySelectorAll("a").forEach(n=>{n.addEventListener("click",()=>{e.classList.remove("active"),t.classList.remove("active"),o.classList.remove("active"),window.scrollLock&&window.scrollLock.disable("novareklamace-menu")})}),logger.log("Mobile menu fully initialized")):logger.warn("initMobileMenu skipped - elements not found")},initForm(){document.getElementById("reklamaceForm").addEventListener("submit",async e=>{e.preventDefault(),await this.submitForm()});const e=document.getElementById("fakturace_firma"),o=document.getElementById("faktura_hint");e&&o&&e.addEventListener("change",e=>{const n=e.target.value;"CZ"===n?o.textContent=t("invoice_cz_hint"):"SK"===n&&(o.textContent=t("invoice_sk_hint"))});["jmeno","email","telefon","ulice","mesto","psc","popis_problemu"].forEach(e=>{const t=document.getElementById(e);t&&t.addEventListener("input",()=>{t.value.trim()&&(t.style.borderColor="",t.style.backgroundColor="")})})},validatePovinnaPole(){const e=[{id:"jmeno",label:"Jm√©no a p≈ô√≠jmen√≠"},{id:"email",label:"E-mail"},{id:"telefon",label:"Telefon"},{id:"ulice",label:"Ulice a ƒåP"},{id:"mesto",label:"Mƒõsto"},{id:"psc",label:"PSƒå"},{id:"popis_problemu",label:"Popis probl√©mu"}];this.isLoggedIn&&e.unshift({id:"cislo",label:"ƒå√≠slo zak√°zky"},{id:"datum_prodeje",label:"Datum prodeje"},{id:"datum_reklamace",label:"Datum reklamace"});const t=[];let o=null;return e.forEach(e=>{const t=document.getElementById(e.id);t&&(t.style.borderColor="",t.style.backgroundColor="")}),e.forEach(e=>{const n=document.getElementById(e.id);if(!n)return void logger.warn(`Pole ${e.id} nebylo nalezeno v DOM`);n.value.trim()||(t.push(e.label),n.style.borderColor="#dc3545",n.style.backgroundColor="#fff5f5",o||(o=n))}),o&&(o.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>o.focus(),500)),{valid:0===t.length,chybejici:t}},async submitForm(){const e=this.validatePovinnaPole();if(!e.valid)return void this.toast(`Vypl≈àte pros√≠m v≈°echna povinn√° pole: ${e.chybejici.join(", ")}`,"error");const o=document.getElementById("gdpr_consent");if(o&&!o.checked)return o.focus(),void this.toast("Pro odesl√°n√≠ je nutn√Ω souhlas se zpracov√°n√≠m osobn√≠ch √∫daj≈Ø.","error");const n=document.getElementById("telefon");if(n&&n.value.trim()){if(n.value.trim().replace(/\D/g,"").length<CONSTANTS.PHONE_MIN_LENGTH)return this.toast(`Neplatn√© telefonn√≠ ƒç√≠slo (minim√°lnƒõ ${CONSTANTS.PHONE_MIN_LENGTH} ƒç√≠slic)`,"error"),void n.focus()}this.toast("Odes√≠l√°m...","info");try{const e=await fetch("app/controllers/get_csrf_token.php"),n=await e.json(),a="success"===n.status?n.token:"",s=new FormData;s.append("action","create"),s.append("typ",this.isLoggedIn?"reklamace":"servis"),s.append("cislo",document.getElementById("cislo").value||""),s.append("datum_prodeje",document.getElementById("datum_prodeje").value||""),s.append("datum_reklamace",document.getElementById("datum_reklamace").value||""),s.append("jmeno",document.getElementById("jmeno").value||""),s.append("email",document.getElementById("email").value||"");const r=document.getElementById("objednavkaICO"),i=document.getElementById("objednavkaFyzicka");let l="";r?.checked?l="IƒåO":i?.checked&&(l="Fyzick√° osoba"),logger.log("[TypZakaznika] IƒåO checked:",r?.checked,", Fyzick√° checked:",i?.checked,", Odes√≠l√°m:",l),s.append("typ_zakaznika",l);const d=document.getElementById("phone-prefix")?.value||"+420",c=document.getElementById("telefon")?.value||"",m=c?`${d} ${c.trim()}`:"";s.append("telefon",m);const u=document.getElementById("ulice")?.value||"",p=document.getElementById("mesto")?.value||"",g=document.getElementById("psc")?.value||"",h=[u,p,g].filter(e=>e).join(", ");s.append("ulice",u),s.append("mesto",p),s.append("psc",g),s.append("adresa",h),s.append("model",document.getElementById("model")?.value||""),s.append("provedeni",document.getElementById("provedeni")?.value||""),s.append("barva",document.getElementById("barva")?.value||""),s.append("seriove_cislo",""),s.append("popis_problemu",document.getElementById("popis_problemu")?.value||""),s.append("doplnujici_info",document.getElementById("doplnujici_info")?.value||"");const y=document.getElementById("fakturace_firma")?.value||"CZ";s.append("fakturace_firma",y),o&&s.append("gdpr_consent",o.checked?"1":"0"),this.povereniPDF&&(s.append("povereni_pdf",this.povereniPDF),logger.log(`[Doc] P≈ôikl√°d√°m PDF povƒõ≈ôen√≠: ${this.povereniPDF.name}`)),s.append("csrf_token",a),s.append("action","create");const v=await fetch("app/controllers/save.php",{method:"POST",body:s});if(!v.ok)throw new Error(`HTTP error! status: ${v.status}`);const f=await v.json();if("success"!==f.status)throw new Error(f.message||"Chyba p≈ôi ukl√°d√°n√≠");{const e=f.reklamace_id||f.workflow_id||f.id,o=f.reference||(document.getElementById("cislo")?.value||"").trim();if(this.photos&&this.photos.length>0&&await this.uploadPhotos(e,a),this.povereniPDF){this.povereniPDF=null;const e=document.getElementById("povereniInput"),t=document.getElementById("povereniStatus");e&&(e.value=""),t&&(t.textContent="",t.style.color="#666"),logger.log("PDF povƒõ≈ôen√≠ vyƒçi≈°tƒõno po √∫spƒõ≈°n√©m ulo≈æen√≠")}this.toast("Po≈æadavek byl √∫spƒõ≈°nƒõ odesl√°n!","success"),setTimeout(()=>{if(this.isLoggedIn)window.location.href="seznam.php";else{const e=o?t("order_accepted_with_ref").replace("{reference}",o):t("order_accepted_no_ref");wgsToast.success(e,0),setTimeout(()=>{window.location.href="index.php"},3e3)}},1500)}}catch(e){logger.error("Chyba p≈ôi odes√≠l√°n√≠ formul√°≈ôe:",e),this.toast(t("submit_error")+": "+e.message,"error")}},async uploadPhotos(e,t){if(logger.log("[Start] uploadPhotos VOL√ÅNO!",e),this.photos&&0!==this.photos.length){logger.log("[Photo] Poƒçet fotek:",this.photos.length);try{const o=new FormData;o.append("reklamace_id",e),o.append("photo_type","problem"),o.append("csrf_token",t),this.photos.forEach((e,t)=>{o.append(`photo_${t}`,e.data),o.append(`filename_${t}`,`photo_${t+1}.jpg`)}),o.append("photo_count",this.photos.length);const n=await fetch("app/controllers/save_photos.php",{method:"POST",body:o});if(!n.ok)throw new Error("Chyba p≈ôi nahr√°v√°n√≠ fotek");const a=await n.json();if("success"!==a.status)throw new Error(a.error||"Nepoda≈ôilo se nahr√°t fotky");logger.log("Fotky √∫spƒõ≈°nƒõ nahr√°ny")}catch(e){logger.error("Chyba p≈ôi nahr√°v√°n√≠ fotek:",e)}}},initPhotos(){const e=document.getElementById("uploadPhotosBtn"),t=document.getElementById("photoInput");e&&t?(e.addEventListener("click",()=>t.click()),t.addEventListener("change",async e=>{const t=Array.from(e.target.files);if(this.photos.length+t.length>CONSTANTS.MAX_PHOTOS)this.toast(`Maxim√°lnƒõ ${CONSTANTS.MAX_PHOTOS} fotografi√≠`,"error");else{for(const e of t){const t=await this.compressImage(e),o=await this.toBase64(t);this.photos.push({data:o,file:t})}this.renderPhotos(),this.toast(`P≈ôid√°no ${t.length} fotek`,"success")}})):logger.warn("üì∑ Upload prvky nebyly nalezeny, initPhotos se p≈ôeskoƒç√≠")},compressImage:async e=>new Promise(t=>{const o=new FileReader;o.onload=o=>{const n=new Image;n.onload=()=>{const o=document.createElement("canvas"),a=Math.min(1,CONSTANTS.MAX_IMAGE_WIDTH/n.width);o.width=n.width*a,o.height=n.height*a;o.getContext("2d").drawImage(n,0,0,o.width,o.height),o.toBlob(o=>{t(new File([o],e.name,{type:"image/jpeg"}))},"image/jpeg",CONSTANTS.IMAGE_QUALITY)},n.src=o.target.result},o.readAsDataURL(e)}),toBase64:e=>new Promise((t,o)=>{const n=new FileReader;n.onload=()=>t(n.result),n.onerror=o,n.readAsDataURL(e)}),renderPhotos(){const e=document.getElementById("photoPreviewMain");e.innerHTML="",this.photos.forEach((t,o)=>{const n=document.createElement("div");n.className="photo-thumb",n.innerHTML=`<img src="${t.data}" alt="Photo ${o+1}"><button class="photo-remove" data-index="${o}">√ó</button>`,n.querySelector(".photo-remove").addEventListener("click",()=>{this.photos.splice(o,1),this.renderPhotos(),this.toast("Fotka odstranƒõna","info")}),e.appendChild(n)})},initPovereniPDF(){const e=document.getElementById("nahrajPovereniBtn"),o=document.getElementById("povereniInput"),n=document.getElementById("povereniStatus");e&&o&&n?(e.addEventListener("click",()=>o.click()),o.addEventListener("change",async e=>{const a=e.target.files[0];if(!a)return;if("application/pdf"!==a.type)return this.toast("Pouze PDF soubory jsou povoleny","error"),void(o.value="");if(a.size>10485760)return this.toast("Soubor je p≈ô√≠li≈° velk√Ω (max 10MB)","error"),void(o.value="");this.povereniPDF=a;const s=(a.size/1048576).toFixed(2);n.textContent=t("processing_file").replace("{filename}",a.name),n.style.color="#666",n.style.fontWeight="600",this.toast(t("processing_file").replace("{filename}","PDF povƒõ≈ôen√≠"),"info"),logger.log(`[Doc] PDF povƒõ≈ôen√≠ p≈ôipojeno: ${a.name}, velikost: ${s} MB`);try{await this.zpracujPovereniPDF(a),n.textContent=t("file_processed_success").replace("{filename}",a.name).replace("{size}",s),n.style.color="#333333",this.toast("Formul√°≈ô byl p≈ôedvyplnƒõn z PDF povƒõ≈ôen√≠","success")}catch(e){logger.error("Chyba p≈ôi zpracov√°n√≠ PDF:",e),n.textContent=t("file_processing_error").replace("{filename}",a.name).replace("{size}",s),n.style.color="#cc0000",this.toast("‚ö† PDF nahr√°no, ale nepoda≈ôilo se extrahovat data","error")}})):logger.warn("[Doc] PDF povƒõ≈ôen√≠ prvky nebyly nalezeny, initPovereniPDF se p≈ôeskoƒç√≠")},async zpracujPovereniPDF(e){try{await window.loadPDFJS()}catch(e){throw new Error("Nepoda≈ôilo se naƒç√≠st PDF.js library")}const t=await e.arrayBuffer(),o=await pdfjsLib.getDocument({data:t}).promise;logger.log(`[Doc] PDF m√° ${o.numPages} str√°nek`);let n="";for(let e=1;e<=o.numPages;e++){const t=await o.getPage(e);n+=(await t.getTextContent()).items.map(e=>e.str).join(" ")+"\n"}logger.log(`[Doc] Extrahovan√Ω text (${n.length} znak≈Ø):`,n.substring(0,200)+"...");const a=await fetch("app/controllers/get_csrf_token.php"),s=await a.json(),r="success"===s.status?s.token:"",i=new FormData;i.append("pdf_text",n),i.append("csrf_token",r);const l=await fetch("api/parse_povereni_pdf.php",{method:"POST",body:i});if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);const d=await l.json();if("success"!==d.status)throw new Error(d.message||"Chyba p≈ôi parsov√°n√≠ PDF");const c=d.data.data||d.data,m=d.data.config_name||"V√Ωchoz√≠ parser";logger.log(`Pou≈æita konfigurace: ${m}`),this.predvyplnFormularZPDF(c)},predvyplnFormularZPDF(e){logger.log("[Edit] P≈ôedvypl≈àuji formul√°≈ô daty z PDF:",e);const t=(e,t)=>{if(!t)return;const o=document.getElementById(e);o&&!o.value&&(o.value=t,logger.log(`Vyplnƒõno pole ${e}: ${t}`))};if(t("cislo",e.cislo_objednavky_reklamace||e.cislo),t("datum_prodeje",e.datum_prodeje),t("datum_reklamace",e.datum_reklamace),t("jmeno",e.jmeno),t("email",e.email),t("telefon",e.telefon),t("ulice",e.ulice),t("mesto",e.mesto),t("psc",e.psc),t("model",e.model),t("provedeni",e.provedeni),t("barva",e.barva),t("popis_problemu",e.popis_problemu),t("doplnujici_info",e.doplnujici_info),(e.mesto||e.psc||e.ulice)&&this.geocodeAddress&&setTimeout(()=>this.geocodeAddress(),500),e.datum_prodeje||e.datum_reklamace){const e=document.getElementById("datum_prodeje"),t=document.getElementById("datum_reklamace");e&&t&&this.checkWarranty&&setTimeout(()=>this.checkWarranty(),500)}},initProvedeni(){},toast(e,t="info"){const o=document.getElementById("toast");o.textContent=e,o.className="toast "+t,o.classList.add("show"),setTimeout(()=>o.classList.remove("show"),3e3)},initCustomCalendar(){const e=document.getElementById("calendarOverlay");if(!e)return;const o=document.getElementById("calendarGrid"),n=document.getElementById("calendarMonthYear");let a=new Date,s=null;const r=[t("january"),t("february"),t("march"),t("april"),t("may"),t("june"),t("july"),t("august"),t("september"),t("october"),t("november"),t("december")],i=[t("monday"),t("tuesday"),t("wednesday"),t("thursday"),t("friday"),t("saturday"),t("sunday")],l=this,d=()=>{const t=a.getFullYear(),d=a.getMonth();n.textContent=r[d]+" "+t,o.innerHTML="",i.forEach(e=>{const t=document.createElement("div");t.className="calendar-weekday",t.textContent=e,o.appendChild(t)});const c=new Date(t,d,1).getDay(),m=new Date(t,d+1,0).getDate(),u=0===c?6:c-1;for(let e=0;e<u;e++){const e=document.createElement("div");e.className="calendar-day disabled",o.appendChild(e)}for(let n=1;n<=m;n++){const a=document.createElement("div");a.className="calendar-day",a.textContent=n,a.addEventListener("click",()=>{const o=n.toString().padStart(2,"0")+"."+(d+1).toString().padStart(2,"0")+"."+t;s&&(s.value=o,"datum_reklamace"===s.id&&l.calculateWarranty()),window.calendarModal&&window.calendarModal.close?window.calendarModal.close():e.classList.remove("active")}),o.appendChild(a)}};["datum_prodeje","datum_reklamace"].forEach(t=>{const o=document.getElementById(t);if(o){const t=o.closest(".date-input-wrapper");t&&(t.style.cursor="pointer",t.addEventListener("click",()=>{o.readOnly&&!l.isLoggedIn||(s=o,a=new Date,d(),window.calendarModal&&window.calendarModal.open?window.calendarModal.open():e.classList.add("active"))}))}}),document.getElementById("prevMonth").addEventListener("click",()=>{a.setMonth(a.getMonth()-1),d()}),document.getElementById("nextMonth").addEventListener("click",()=>{a.setMonth(a.getMonth()+1),d()})},calculateWarranty(){if(!this.isLoggedIn)return;const e=document.getElementById("datum_prodeje").value,o=document.getElementById("datum_reklamace").value,n=document.getElementById("warrantyWarning");if(!e||!o||"nevypl≈àuje se"===e||"nevypl≈àuje se"===o)return void(n&&n.classList.add("hidden"));const a=e=>{const t=e.split(".");return new Date(t[2],t[1]-1,t[0])};try{const s=a(e),r=a(o),i=new Date(s);i.setFullYear(i.getFullYear()+CONSTANTS.WARRANTY_YEARS);const l=Math.ceil((i-r)/864e5);n&&(n.classList.remove("hidden"),l>0?(n.className="",n.innerHTML=t("warranty_valid").replace("{days}",l).replace("{date}",i.toLocaleDateString("cs-CZ"))):(n.className="expired",n.innerHTML=t("warranty_expired").replace("{days}",Math.abs(l)).replace("{date}",i.toLocaleDateString("cs-CZ"))))}catch(e){logger.error("Chyba p≈ôi v√Ωpoƒçtu z√°ruky:",e),n&&n.classList.add("hidden")}},initLanguage(){let e=localStorage.getItem("wgs-lang")||"cs";const t=t=>{e=t,localStorage.setItem("wgs-lang",t),document.documentElement.lang=t,document.querySelectorAll("[data-lang-cs]").forEach(e=>{const o=e.getAttribute("data-lang-"+t);o&&(o.includes("<br>")?e.innerHTML=o:e.textContent=o)}),document.querySelectorAll("[data-lang-cs-placeholder]").forEach(e=>{const o=e.getAttribute("data-lang-"+t+"-placeholder");o&&(e.placeholder=o)}),document.querySelectorAll(".lang-flag").forEach(e=>{e.classList.remove("active"),e.dataset.lang===t&&e.classList.add("active")});document.title={cs:"Objednat servis | WGS",en:"Order Service | WGS",it:"Ordinare Servizio | WGS"}[t]};"cs"!==e&&t(e),document.querySelectorAll(".lang-flag").forEach(e=>{e.addEventListener("click",()=>t(e.dataset.lang))})}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>WGS.init()):WGS.init(),document.addEventListener("DOMContentLoaded",()=>{document.addEventListener("click",e=>{const t=e.target.closest("[data-action]");if(!t)return;const o=t.getAttribute("data-action");"reload"!==o?"function"==typeof window[o]&&window[o]():location.reload()}),document.addEventListener("click",e=>{const t=e.target.closest("[data-navigate]")?.getAttribute("data-navigate");t&&("function"==typeof navigateTo?navigateTo(t):location.href=t)}),document.addEventListener("change",e=>{const t=e.target.closest("[data-onchange]");if(!t)return;const o=t.getAttribute("data-onchange"),n=t.getAttribute("data-onchange-value")||t.value;"function"==typeof window[o]&&window[o](n)})});