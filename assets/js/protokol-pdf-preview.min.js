let aktualniPdfBlob=null,aktualniPdfNazev="protokol.pdf";function otevritPdfPreview(e,o="protokol.pdf"){try{logger.log("[Doc] Otev√≠r√°m PDF preview modal..."),logger.log("[Doc] PDF Blob:",e),logger.log("[Doc] PDF Blob size:",e.size,"bytes"),logger.log("[Doc] PDF Blob type:",e.type),aktualniPdfBlob=e,aktualniPdfNazev=o;const t=URL.createObjectURL(e);logger.log("[Doc] PDF URL vytvo≈ôena:",t);const n=document.getElementById("pdfPreviewFrame");if(!n)return logger.error("iframe #pdfPreviewFrame nenalezen!"),void showNotif("error","Chyba: iframe nenalezen");logger.log("[Doc] Nastavuji iframe.src..."),n.removeAttribute("srcdoc"),n.src="";const r=n.closest(".pdf-preview-body");if(r&&(r.style.position="relative",r.innerHTML='\n        <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0;\n                    display: flex; align-items: center; justify-content: center;\n                    background: #f5f5f5; z-index: 1;">\n          <div style="text-align: center;">\n            <div style="width: 50px; height: 50px; border: 4px solid #ddd;\n                        border-top: 4px solid #333333; border-radius: 50%;\n                        animation: spin 1s linear infinite; margin: 0 auto 15px;"></div>\n            <p style="color: #666; font-size: 14px; margin: 0;">Naƒç√≠t√°m PDF...</p>\n          </div>\n        </div>\n        <iframe id="pdfPreviewFrame" class="pdf-preview-frame"></iframe>\n      ',!document.getElementById("pdf-spinner-style"))){const e=document.createElement("style");e.id="pdf-spinner-style",e.textContent="@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }",document.head.appendChild(e)}const i=document.getElementById("pdfPreviewFrame");i.src=t,logger.log("[Doc] iframe.src nastavena:",i.src),i.onload=()=>{logger.log("PDF √∫spƒõ≈°nƒõ naƒçten v iframe");const e=r?.querySelector('div[style*="position: absolute"]');e&&e.remove()},setTimeout(()=>{const e=r?.querySelector('div[style*="position: absolute"]');e&&(logger.warn("Loading skryt√Ω po timeoutu (3s)"),e.remove())},3e3);const l=document.getElementById("pdfShareBtn"),a=document.getElementById("pdfSendBtn");"send"===("undefined"!=typeof pdfPreviewContext?pdfPreviewContext:"export")?(l.style.display="none",a.style.display="flex",logger.log("üìß Re≈æim: Odesl√°n√≠ z√°kazn√≠kovi")):(l.style.display="flex",a.style.display="none",logger.log("üì§ Re≈æim: Export/Sd√≠len√≠"));const d=document.getElementById("pdfPreviewOverlay");if(!d)return logger.error("overlay #pdfPreviewOverlay nenalezen!"),void showNotif("error","Chyba: modal nenalezen");window.pdfPreviewModal&&window.pdfPreviewModal.open?window.pdfPreviewModal.open():d.classList.add("active"),logger.log("Modal zobrazen (Alpine.js API)"),setTimeout(()=>{n.contentDocument||n.contentWindow?logger.log("PDF preview √∫spƒõ≈°nƒõ zobrazen v iframe"):(logger.warn("iframe pravdƒõpodobnƒõ neobsahuje PDF - mo≈æn√° probl√©m s CORS nebo prohl√≠≈æeƒç"),logger.log("[Tip] Zkuste tlaƒç√≠tko Sd√≠let/St√°hnout pro zobrazen√≠ v nov√©m oknƒõ"))},1e3)}catch(o){if(logger.error("Chyba p≈ôi otev√≠r√°n√≠ PDF preview:",o),showNotif("error","Chyba p≈ôi zobrazen√≠ PDF: "+o.message),e){logger.log("[Tip] Fallback: Otev√≠r√°m PDF v nov√©m oknƒõ...");const o=URL.createObjectURL(e);window.open(o,"_blank")}}}function zavritPdfPreview(){logger.log("[Lock] Zav√≠r√°m PDF preview...");document.getElementById("pdfPreviewOverlay").classList.remove("active");const e=document.getElementById("pdfPreviewFrame");e&&(e.src&&(URL.revokeObjectURL(e.src),e.src=""),e.onload=null);const o=document.querySelector(".pdf-preview-body");if(o){const e=o.querySelector('div[style*="position: absolute"]');e&&e.remove()}aktualniPdfBlob=null,aktualniPdfNazev="protokol.pdf",logger.log("PDF preview zav≈ôen")}async function sdiletNeboStahnutPdf(){if(aktualniPdfBlob)try{if(logger.log("üì§ Zpracov√°v√°m sd√≠len√≠/sta≈æen√≠ PDF..."),navigator.share&&navigator.canShare){const e=new File([aktualniPdfBlob],aktualniPdfNazev,{type:"application/pdf"});if(navigator.canShare({files:[e]}))return logger.log("üì± Pou≈æ√≠v√°m Web Share API..."),await navigator.share({files:[e],title:"Servisn√≠ protokol WGS",text:"Servisn√≠ protokol White Glove Service"}),logger.log("PDF √∫spƒõ≈°nƒõ sd√≠len pomoc√≠ Web Share API"),void showNotif("success","PDF sd√≠len")}logger.log("[Save] Stahuji PDF...");const e=URL.createObjectURL(aktualniPdfBlob),o=document.createElement("a");o.href=e,o.download=aktualniPdfNazev,o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),setTimeout(()=>URL.revokeObjectURL(e),100),logger.log("PDF √∫spƒõ≈°nƒõ sta≈æen"),showNotif("success","PDF sta≈æen")}catch(e){if("AbortError"===e.name)return void logger.log("‚ÑπÔ∏è Sd√≠len√≠ PDF zru≈°eno u≈æivatelem");logger.error("Chyba p≈ôi sd√≠len√≠/stahov√°n√≠ PDF:",e),showNotif("error","Chyba p≈ôi zpracov√°n√≠ PDF")}else showNotif("error","PDF nen√≠ dostupn√©")}function initPdfPreview(){logger.log("[Fix] Inicializuji PDF preview...");const e=document.getElementById("pdfShareBtn");e&&e.addEventListener("click",sdiletNeboStahnutPdf);const o=document.getElementById("pdfSendBtn");o&&o.addEventListener("click",()=>{logger.log("üìß Potvrzuji odesl√°n√≠ z√°kazn√≠kovi..."),"function"==typeof potvrditAOdeslat?potvrditAOdeslat():(logger.error("Funkce potvrditAOdeslat nen√≠ dostupn√°"),showNotif("error","Chyba p≈ôi odes√≠l√°n√≠"))}),logger.log("PDF preview inicializov√°n (Alpine.js Step 42)")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initPdfPreview):initPdfPreview();
//# sourceMappingURL=protokol-pdf-preview.min.js.map