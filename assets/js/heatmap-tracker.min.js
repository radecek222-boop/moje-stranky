!function(){"use strict";const e={enabled:!0,apiUrl:window.location.origin+"/api/track_heatmap.php",batchInterval:5e3,maxBatchSize:50,scrollBuckets:[0,10,20,30,40,50,60,70,80,90,100]};let t=[],n=new Set,o=null,r=null;function c(n){const o=window.innerWidth,r=window.innerHeight,c=n.clientX,i=n.clientY+window.scrollY;t.push({x:+(c/o*100).toFixed(2),y:+(i/document.documentElement.scrollHeight*100).toFixed(2),viewport_width:o,viewport_height:r,timestamp:Date.now()}),t.length>=e.maxBatchSize&&s()}let i=null;function a(){clearTimeout(i),i=setTimeout(()=>{const t=window.scrollY,o=Math.max(document.documentElement.scrollHeight-window.innerHeight,0),r=o?t/o*100:0,c=e.scrollBuckets.reduce((e,t)=>Math.abs(t-r)<Math.abs(e-r)?t:e);n.add(c)},100)}async function s(){if(0===t.length&&0===n.size)return;if(!o)return;const c={page_url:window.location.href,device_type:r,clicks:t.splice(0),scrolls:Array.from(n),csrf_token:o};n.clear();try{const r=await fetch(e.apiUrl,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":o},body:JSON.stringify(c)}),i=await r.text();if(!r.ok)return console.error("[Heatmap Tracker] API HTTP error:",r.status,i.substring(0,200)),t.unshift(...c.clicks),void c.scrolls.forEach(e=>n.add(e));let a;try{a=JSON.parse(i)}catch(e){return void console.error("[Heatmap Tracker] JSON parse error:",e)}"success"!==a.status&&console.error("[Heatmap Tracker] API error:",a.message)}catch(e){console.error("[Heatmap Tracker] Network error:",e),t.unshift(...c.clicks),c.scrolls.forEach(e=>n.add(e))}}function l(){e.enabled&&(o=document.querySelector('meta[name="csrf-token"]')?.content||document.querySelector('input[name="csrf_token"]')?.value||window.csrfToken||null,o&&(r=function(){const e=window.innerWidth;return e>=1024?"desktop":e>=768?"tablet":"mobile"}(),document.addEventListener("click",c,!0),window.addEventListener("scroll",a,{passive:!0}),setInterval(s,e.batchInterval),window.addEventListener("beforeunload",()=>{if(t.length||n.size){const c={page_url:window.location.href,device_type:r,clicks:t,scrolls:Array.from(n),csrf_token:o};navigator.sendBeacon(e.apiUrl,new Blob([JSON.stringify(c)],{type:"application/json"}))}})))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",l):l()}();
//# sourceMappingURL=heatmap-tracker.min.js.map