console.log("[SEZNAM.JS] NACTEN - VERZE: 20251202-01 (Alpine.js detailModal)"),window.csrfTokenCache=window.csrfTokenCache||null;const originalFetch=window.fetch||fetch;async function getCSRFToken(){if(window.csrfTokenCache)return window.csrfTokenCache;try{const e=await originalFetch("/app/controllers/get_csrf_token.php"),t=await e.json();return window.csrfTokenCache=t.token,t.token}catch(e){return"undefined"!=typeof logger&&logger.error("Chyba z√≠sk√°n√≠ CSRF tokenu:",e),""}}function showToast(e,t="info"){const n=document.getElementById("wgs-toast");n&&n.remove();const o=document.createElement("div");o.id="wgs-toast",o.textContent=e,o.style.cssText=`\n    position: fixed;\n    top: 80px;\n    right: 20px;\n    background: ${"success"===t?"#333":"error"===t?"#666":"#333"};\n    color: white;\n    padding: 16px 24px;\n    border-radius: 4px;\n    box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n    z-index: 10000;\n    font-size: 14px;\n    font-weight: 600;\n    min-width: 250px;\n    max-width: 400px;\n    animation: slideIn 0.3s ease-out;\n  `;const a=document.createElement("style");a.textContent="\n    @keyframes slideIn {\n      from {\n        transform: translateX(400px);\n        opacity: 0;\n      }\n      to {\n        transform: translateX(0);\n        opacity: 1;\n      }\n    }\n    @keyframes slideOut {\n      from {\n        transform: translateX(0);\n        opacity: 1;\n      }\n      to {\n        transform: translateX(400px);\n        opacity: 0;\n      }\n    }\n  ",document.getElementById("wgs-toast-styles")||(a.id="wgs-toast-styles",document.head.appendChild(a)),document.body.appendChild(o),setTimeout(()=>{o.style.animation="slideOut 0.3s ease-in",setTimeout(()=>o.remove(),300)},3e3)}let WGS_DATA_CACHE=[],ACTIVE_FILTER="all",CURRENT_RECORD=null,SELECTED_DATE=null,SELECTED_TIME=null,CURRENT_PAGE=1,HAS_MORE_PAGES=!1,LOADING_MORE=!1;const PER_PAGE=50;let CAL_MONTH=(new Date).getMonth(),CAL_YEAR=(new Date).getFullYear(),SEARCH_QUERY="";const WGS_ADDRESS="Dubƒçe 364, Bƒõchovice 190 11, ƒåesk√° republika",WGS_COORDS={lat:50.0472,lng:14.5881};let DISTANCE_CACHE={};const Utils={getCustomerName:e=>e.jmeno||e.zakaznik||"Nezn√°m√Ω z√°kazn√≠k",getAddress:e=>{if(e.adresa)return e.adresa;const t=[e.ulice,e.mesto,e.psc].filter(e=>e);return t.length>0?t.join(", "):"‚Äî"},getProduct:e=>e.model||e.vyrobek||"‚Äî",getOrderId:(e,t=0)=>e.cislo||e.reklamacniCislo||e.id||"WGS-"+(t+1),isCompleted:e=>"HOTOVO"===e.stav||"done"===e.stav,escapeHtml:e=>{const t=document.createElement("div");return t.textContent=e,t.innerHTML},addCountryToAddress:e=>e?e.toLowerCase().includes("ƒçesk")?e:e+", ƒåesk√° republika":e,filterByUserRole:e=>CURRENT_USER&&"prodejce"===CURRENT_USER.role?e.filter(e=>String(e.zpracoval_id)===String(CURRENT_USER.id)):e},CacheManager={load:()=>{try{const e=localStorage.getItem("wgs_distance_cache");e&&(DISTANCE_CACHE=JSON.parse(e),logger.log("Naƒçteno",Object.keys(DISTANCE_CACHE).length,"vzd√°lenost√≠ z cache"))}catch(e){logger.error("Chyba p≈ôi naƒç√≠t√°n√≠ cache:",e)}},save:()=>{try{localStorage.setItem("wgs_distance_cache",JSON.stringify(DISTANCE_CACHE))}catch(e){logger.error("Chyba p≈ôi ukl√°d√°n√≠ cache:",e)}}},AUTO_REFRESH_INTERVAL=6e4;let autoRefreshTimer=null,lastRefreshTime=Date.now();function startAutoRefresh(){autoRefreshTimer&&clearInterval(autoRefreshTimer),autoRefreshTimer=setInterval(async()=>{"visible"===document.visibilityState&&(logger.log("[AutoRefresh] Automaticka aktualizace dat..."),await loadAll(ACTIVE_FILTER),lastRefreshTime=Date.now())},6e4),logger.log("[AutoRefresh] Spusten - interval 60s")}function stopAutoRefresh(){autoRefreshTimer&&(clearInterval(autoRefreshTimer),autoRefreshTimer=null,logger.log("[AutoRefresh] Zastaven"))}function initSearch(){const e=document.getElementById("searchInput"),t=document.getElementById("searchClear"),n=new URLSearchParams(window.location.search).get("search");n&&(e.value=n,SEARCH_QUERY=n.trim().toLowerCase(),t.classList.add("visible"),window.history.replaceState({},document.title,window.location.pathname)),e.addEventListener("input",e=>{SEARCH_QUERY=e.target.value.trim().toLowerCase(),t.classList.toggle("visible",SEARCH_QUERY.length>0),renderOrders(Utils.filterByUserRole(WGS_DATA_CACHE))}),e.addEventListener("keydown",e=>{"Escape"===e.key&&clearSearch()})}function clearSearch(){const e=document.getElementById("searchInput"),t=document.getElementById("searchClear");e.value="",SEARCH_QUERY="",t.classList.remove("visible"),renderOrders(Utils.filterByUserRole(WGS_DATA_CACHE))}function highlightText(e,t){if(!t||!e)return Utils.escapeHtml(e);const n=Utils.escapeHtml(e),o=escapeRegex(t),a=new RegExp(`(${o})`,"gi");return n.replace(a,'<span class="highlight">$1</span>')}function escapeRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function matchesSearch(e,t){if(!t)return!0;return[Utils.getCustomerName(e),e.telefon||"",e.email||"",Utils.getAddress(e),Utils.getProduct(e),Utils.getOrderId(e),e.popis_problemu||""].join(" ").toLowerCase().includes(t)}function initFilters(){document.querySelectorAll(".filter-btn").forEach(e=>{e.addEventListener("click",()=>{document.querySelectorAll(".filter-btn").forEach(e=>e.classList.remove("active")),e.classList.add("active"),ACTIVE_FILTER=e.dataset.filter,renderOrders(Utils.filterByUserRole(WGS_DATA_CACHE))})})}function updateCounts(e){if(!Array.isArray(e))return;const t=e.length,n=e.filter(e=>{const t=e.stav||"wait";return"ƒåEK√Å"===t||"wait"===t}).length,o=e.filter(e=>{const t=e.stav||"wait";return"DOMLUVEN√Å"===t||"open"===t}).length,a=e.filter(e=>{const t=e.stav||"wait";return"HOTOVO"===t||"done"===t}).length;document.getElementById("count-all").textContent=`(${t})`,document.getElementById("count-wait").textContent=`(${n})`,document.getElementById("count-open").textContent=`(${o})`,document.getElementById("count-done").textContent=`(${a})`}async function loadAll(e="all",n=!1){try{const t=n?CURRENT_PAGE+1:1,o=await fetch(`app/controllers/load.php?status=${e}&page=${t}&per_page=50`);if(!o.ok)throw new Error("Chyba naƒç√≠t√°n√≠");const a=await o.json();let i=[];"success"===a.status&&Array.isArray(a.data)?i=a.data:Array.isArray(a)&&(i=a),n?(WGS_DATA_CACHE=[...WGS_DATA_CACHE,...i],CURRENT_PAGE=t):(WGS_DATA_CACHE=i,CURRENT_PAGE=1),HAS_MORE_PAGES=50===i.length,LOADING_MORE=!1;let r=Utils.filterByUserRole(WGS_DATA_CACHE);updateCounts(r),renderOrders(r),updateLoadMoreButton(),lastRefreshTime=Date.now()}catch(e){logger.error("Chyba:",e),WGS_DATA_CACHE=[],document.getElementById("orderGrid").innerHTML=`\n      <div class="empty-state">\n        <div class="empty-state-text">${t("data_load_error")}</div>\n      </div>\n    `}}async function renderOrders(e=null){const n=document.getElementById("orderGrid"),o=document.getElementById("searchResultsInfo");e||(e=Utils.filterByUserRole(WGS_DATA_CACHE)),Array.isArray(e)||(e=[]);let a=e;if("all"!==ACTIVE_FILTER){const t={wait:["ƒåEK√Å","wait"],open:["DOMLUVEN√Å","open"],done:["HOTOVO","done"]};a=e.filter(e=>{const n=e.stav||"wait";return t[ACTIVE_FILTER]?.includes(n)})}const i=a.length;if(SEARCH_QUERY?(a=a.filter(e=>matchesSearch(e,SEARCH_QUERY)),a.length>0?(o.className="search-results-info",o.textContent=t("search_results_found").replace("{count}",a.length).replace("{total}",i).replace("{query}",SEARCH_QUERY)):(o.className="search-results-info no-results",o.textContent=t("no_search_results").replace("{query}",SEARCH_QUERY)),o.style.display="block"):o.style.display="none",0===a.length)return void(n.innerHTML=`\n      <div class="empty-state">\n        <div class="empty-state-text">${SEARCH_QUERY?t("no_results_found"):t("no_claims_to_display")}</div>\n      </div>\n    `);let r={};try{const e=await fetch("api/notes_api.php?action=get_unread_counts"),t=await e.json();"success"===t.status&&(r=t.unread_counts||{})}catch(e){logger.warn("Nepoda≈ôilo se naƒç√≠st unread counts:",e)}a.sort((e,t)=>{const n=new Date(e.created_at||e.datum_reklamace||e.timestamp||0);return new Date(t.created_at||t.datum_reklamace||t.timestamp||0)-n}),n.innerHTML=a.map((e,t)=>{const n=Utils.getCustomerName(e),o=Utils.getProduct(e),a=formatDate(e.created_at||e.datum_reklamace),i=getStatus(e.stav),d=Utils.getOrderId(e,t);let s=Utils.getAddress(e);if("‚Äî"!==s){const e=s.split(",").map(e=>e.trim());s=e.slice(0,2).join(", ")}let l="";"open"===i.class&&e.termin&&e.cas_navstevy&&(l=formatAppointment(e.termin,e.cas_navstevy));const c=e.id,p=r[c]||0,m=p>0,u=SEARCH_QUERY?highlightText(n,SEARCH_QUERY):n,g=SEARCH_QUERY?highlightText(s,SEARCH_QUERY):s,h=SEARCH_QUERY?highlightText(o,SEARCH_QUERY):o,y=SEARCH_QUERY?highlightText(d,SEARCH_QUERY):d;return`\n      <div class="order-box ${SEARCH_QUERY&&matchesSearch(e,SEARCH_QUERY)?"search-match":""} ${`status-bg-${i.class}`}" onclick='showDetail("${e.id}")'>\n        <div class="order-header">\n          <div class="order-number">${y}</div>\n          <div style="display: flex; gap: 0.4rem; align-items: center;">\n            <div class="order-notes-badge ${m?"has-unread pulse":""}" data-action="showNotes" data-id="${e.id}" title="${p>0?p+" nep≈ôeƒçten√©":"Pozn√°mky"}">\n              <span class="notes-icon">‚úé</span>${p>0?p:""}\n            </div>\n            <div class="order-status status-${i.class}"></div>\n          </div>\n        </div>\n        <div class="order-body">\n          <div class="order-customer">${u}</div>\n          <div class="order-detail-line">${g}</div>\n          <div class="order-detail-row">\n            <div class="order-detail-left">\n              <div class="order-detail-line">${h}</div>\n              <div class="order-detail-line" style="opacity: 0.6;">${a}</div>\n            </div>\n            <div class="order-detail-right">\n              ${l?`<span class="order-appointment">${l}</span>`:`<span class="order-status-text status-${i.class}">${i.text}</span>`}\n            </div>\n          </div>\n        </div>\n      </div>\n    `}).join("");const d=Object.values(r).reduce((e,t)=>e+t,0),s=document.getElementById("unreadNotesIndicator"),l=document.getElementById("unreadNotesCount");d>0?(l.textContent=d,s.style.display="block"):s.style.display="none",window.UNREAD_COUNTS_MAP=r}function filterUnreadNotes(){const e=window.UNREAD_COUNTS_MAP||{},t=WGS_DATA_CACHE.filter(t=>{const n=t.id;return e[n]>0});logger.log(`[Seznam] Filtrov√°n√≠ nep≈ôeƒçten√Ωch pozn√°mek: ${t.length} karet`);const n=document.getElementById("orderGrid");0!==t.length?(renderOrders(t),window.scrollTo({top:0,behavior:"smooth"})):n.innerHTML='\n      <div class="empty-state">\n        <div class="empty-state-text">≈Ω√°dn√© nep≈ôeƒçten√© pozn√°mky</div>\n      </div>\n    '}window.addEventListener("DOMContentLoaded",async()=>{CacheManager.load(),initFilters(),initSearch(),await loadAll(),startAutoRefresh(),document.addEventListener("visibilitychange",()=>{if("visible"===document.visibilityState){Date.now()-lastRefreshTime>3e4&&(logger.log("[AutoRefresh] Tab aktivni - nacitam nova data..."),loadAll(ACTIVE_FILTER))}}),setTimeout(()=>{window.WGSNotifikace&&"function"==typeof window.WGSNotifikace.zobrazitDialogPovoleni&&window.WGSNotifikace.zobrazitDialogPovoleni()},3e3)});const ModalManager={show:e=>{document.getElementById("modalContent").innerHTML=e,window.detailModal&&window.detailModal.open?window.detailModal.open():(window.scrollLock&&window.scrollLock.enable("detail-overlay"),document.body.classList.add("modal-open"),document.getElementById("detailOverlay").classList.add("active")),setTimeout(()=>{const e=document.querySelector("#detailOverlay .modal-content");e&&(e.scrollTop=0)},10)},close:()=>{if(window.detailModal&&window.detailModal.close)window.detailModal.close();else{document.getElementById("detailOverlay").classList.remove("active"),setTimeout(()=>{document.body.classList.remove("modal-open"),window.scrollLock&&window.scrollLock.disable("detail-overlay")},50)}CURRENT_RECORD=null,SELECTED_DATE=null,SELECTED_TIME=null},createHeader:(e,t)=>`\n      <div class="modal-header">\n        <h2 class="modal-title">${e}</h2>\n        ${t?`<p class="modal-subtitle">${t}</p>`:""}\n      </div>\n    `,createActions:e=>`\n      <div class="modal-actions">\n        ${e.join("")}\n      </div>\n    `};async function showDetail(e){let n;if("string"==typeof e){if(n=WGS_DATA_CACHE.find(t=>t.id==e||t.reklamace_id==e),!n)return void alert(t("record_not_found"))}else n=WGS_DATA_CACHE.find(t=>t.id==e.id||t.reklamace_id==e.reklamace_id)||e;CURRENT_RECORD=n;const o=Utils.getCustomerName(n),a=Utils.getAddress(n),i=n.termin?formatDate(n.termin):"‚Äî",r=n.cas_navstevy||"‚Äî",d=getStatus(n.stav);let s="";if(Utils.isCompleted(n)){const e=n.updated_at?formatDate(n.updated_at):"‚Äî",t=n.updated_at?new Date(n.updated_at):null;s=`\n      <div style="background: #f8f9fa; border: 1px solid #dee2e6; padding: 0.75rem; margin-bottom: 1rem; border-radius: 4px;">\n        <div style="text-align: center;">\n          <div style="font-size: 0.9rem; font-weight: 600; color: #1a1a1a; margin-bottom: 0.25rem;">Zak√°zka dokonƒçena</div>\n          <div style="font-size: 0.75rem; color: #666;">Tato zak√°zka byla ji≈æ vy≈ô√≠zena dne ${e} v ${t?`${t.getHours()}:${String(t.getMinutes()).padStart(2,"0")}`:"‚Äî"} hod</div>\n        </div>\n      </div>\n\n      <div style="display: flex; flex-direction: column; gap: 0.5rem;">\n        ${CURRENT_USER&&"prodejce"===CURRENT_USER.role?"":`\n          <button class="btn" style="width: 100%; padding: 0.5rem 0.75rem; min-height: 44px; background: #333; color: white; font-weight: 600; font-size: 0.9rem;" data-action="reopenOrder" data-id="${n.id}">\n            Znovu otev≈ô√≠t\n          </button>\n\n          <button class="btn" style="width: 100%; padding: 0.5rem 0.75rem; min-height: 44px; font-size: 0.9rem;" data-action="showContactMenu" data-id="${n.id}">Kontaktovat</button>\n        `}\n        <button class="btn" style="width: 100%; padding: 0.5rem 0.75rem; min-height: 44px; font-size: 0.9rem;" data-action="showCustomerDetail" data-id="${n.id}">Detail z√°kazn√≠ka</button>\n\n      <div style="width: 100%; margin-top: 0.25rem;">\n        ${n.original_reklamace_id?`\n          \x3c!-- Zak√°zka je KLON - zobrazit Historie z√°kazn√≠ka + PDF REPORT --\x3e\n          <button class="btn" style="background: #555; color: white; width: 100%; padding: 0.5rem 0.75rem; min-height: 44px; font-size: 0.9rem; margin-bottom: 0.5rem;"\n                  data-action="showHistoryPDF" data-original-id="${n.original_reklamace_id}">\n            Historie z√°kazn√≠ka\n          </button>\n          ${n.documents&&n.documents.length>0?`\n            <button class="btn" style="background: #333333; color: white; width: 100%; padding: 0.5rem 0.75rem; min-height: 44px; font-size: 0.9rem; font-weight: 600;"\n                    data-action="openPDF" data-url="${n.documents[0].file_path}" data-id="${n.id}">\n              [Doc] PDF REPORT\n            </button>\n          `:'\n            <div style="background: #f8f9fa; border: 1px dashed #dee2e6; border-radius: 4px; padding: 0.5rem; text-align: center; color: #666; font-size: 0.75rem;">\n              PDF report je≈°tƒõ nebyl vytvo≈ôen\n            </div>\n          '}\n        `:`\n          \x3c!-- P≈Øvodn√≠ zak√°zka - standardn√≠ PDF tlaƒç√≠tko --\x3e\n          ${n.documents&&n.documents.length>0?`\n            <button class="btn" style="background: #333333; color: white; width: 100%; padding: 0.5rem 0.75rem; min-height: 44px; font-size: 0.9rem; font-weight: 600;"\n                    data-action="openPDF" data-url="${n.documents[0].file_path}" data-id="${n.id}">\n              [Doc] PDF REPORT\n            </button>\n          `:'\n            <div style="background: #f8f9fa; border: 1px dashed #dee2e6; border-radius: 4px; padding: 0.5rem; text-align: center; color: #666; font-size: 0.75rem;">\n              PDF report je≈°tƒõ nebyl vytvo≈ôen\n            </div>\n          '}\n        `}\n      </div>\n\n        \x3c!-- Videot√©ka - archiv vide√≠ zak√°zky --\x3e\n        <button class="btn" style="background: #444; color: white; width: 100%; padding: 0.5rem 0.75rem; min-height: 44px; font-size: 0.9rem; margin-top: 0.5rem;"\n                data-action="showVideoteka" data-id="${n.id}">\n          Videot√©ka\n        </button>\n\n        <button class="btn btn-secondary" style="width: 100%; padding: 0.5rem 0.75rem; min-height: 44px; font-size: 0.9rem;" data-action="closeDetail">Zav≈ô√≠t</button>\n      </div>\n    `}else{s=`\n      <div style="display: flex; flex-direction: column; gap: 0.5rem;">\n        ${CURRENT_USER&&"prodejce"===CURRENT_USER.role?"":`\n          <button class="btn" style="width: 100%; padding: 0.5rem 0.75rem; min-height: 44px; font-size: 0.9rem; background: #1a1a1a; color: white;" data-action="startVisit" data-id="${n.id}">Zah√°jit n√°v≈°tƒõvu</button>\n\n          <button class="btn" style="width: 100%; padding: 0.5rem 0.75rem; min-height: 44px; font-size: 0.9rem; background: #1a1a1a; color: white;" data-action="showCalendar" data-id="${n.id}">Napl√°novat term√≠n</button>\n\n          <button class="btn" style="width: 100%; padding: 0.5rem 0.75rem; min-height: 44px; font-size: 0.9rem;" data-action="showContactMenu" data-id="${n.id}">Kontaktovat</button>\n        `}\n        <button class="btn" style="width: 100%; padding: 0.5rem 0.75rem; min-height: 44px; font-size: 0.9rem;" data-action="showCustomerDetail" data-id="${n.id}">Detail z√°kazn√≠ka</button>\n\n        ${n.original_reklamace_id?`\n          \x3c!-- Nedokonƒçen√° zak√°zka s histori√≠ - p≈ôidat Historie PDF --\x3e\n          <button class="btn" style="background: #555; color: white; width: 100%; padding: 0.5rem 0.75rem; min-height: 44px; font-size: 0.9rem;"\n                  data-action="showHistoryPDF" data-original-id="${n.original_reklamace_id}">\n            Historie PDF\n          </button>\n        `:""}\n\n        \x3c!-- Videot√©ka - archiv vide√≠ zak√°zky --\x3e\n        <button class="btn" style="background: #444; color: white; width: 100%; padding: 0.5rem 0.75rem; min-height: 44px; font-size: 0.9rem; margin-top: 0.5rem;"\n                data-action="showVideoteka" data-id="${n.id}">\n          Videot√©ka\n        </button>\n\n        <button class="btn btn-secondary" style="width: 100%; padding: 0.5rem 0.75rem; min-height: 44px; font-size: 0.9rem;" data-action="closeDetail">Zav≈ô√≠t</button>\n      </div>\n    `}const l=`\n    ${ModalManager.createHeader(o,`\n      <strong>Adresa:</strong> ${a}<br>\n      <strong>Term√≠n:</strong> ${i} ${"‚Äî"!==r?"v "+r:""}<br>\n      <strong>Stav:</strong> ${d.text}\n    `)}\n    \n    <div class="modal-body">\n      ${s}\n    </div>\n  `;ModalManager.show(l)}function closeDetail(){ModalManager.close()}async function reopenOrder(e){const n=WGS_DATA_CACHE.find(t=>t.id==e);if(!n)return void alert(t("record_not_found"));const o=Utils.getCustomerName(n),a=Utils.getProduct(n);if(window.confirm(t("confirm_reopen_order").replace("{customer}",o).replace("{product}",a)))try{const t=await getCSRFToken(),n=new FormData;n.append("action","reopen"),n.append("original_id",e),n.append("csrf_token",t);const o=await fetch("/app/controllers/save.php",{method:"POST",body:n}),a=await o.json();if(!o.ok)throw new Error(`HTTP ${o.status}: ${a.message||o.statusText}`);if("success"!==a.status)throw new Error(a.message||"Nepoda≈ôilo se vytvo≈ôit novou zak√°zku");{const e=a.new_id,t=a.new_workflow_id;logger.log(`Nov√° zak√°zka vytvo≈ôena: ${t} (ID: ${e})`),alert(`NOV√Å ZAK√ÅZKA VYTVO≈òENA\n\nƒå√≠slo: ${t}\nStav: NOV√Å (≈ælut√° karta)\n\nP≈Øvodn√≠ zak√°zka z≈Øst√°v√° dokonƒçen√°.\n\nNyn√≠ m≈Ø≈æete:\n‚Üí Napl√°novat term√≠n n√°v≈°tƒõvy\n‚Üí Zah√°jit n√°v≈°tƒõvu\n‚Üí Aktualizovat detail zak√°zky`),"function"==typeof loadAll&&await loadAll(ACTIVE_FILTER),showDetail(e)}}catch(e){logger.error("Chyba p≈ôi znovuotev≈ôen√≠ zak√°zky:",e),alert(t("error_reopening_order")+": "+e.message)}else logger.log("Znovuotev≈ôen√≠ zru≈°eno u≈æivatelem")}async function showHistoryPDF(e){if(e)try{logger.log(`üìö Naƒç√≠t√°m historii PDF z p≈Øvodn√≠ zak√°zky: ${e}`);const t=await fetch(`/api/get_original_documents.php?reklamace_id=${encodeURIComponent(e)}`);if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const n=await t.json();if("error"===n.status){if(n.message&&n.message.includes("nebyla nalezena"))return void alert("P≈Øvodn√≠ zak√°zka byla smaz√°na.\n\nHistorie PDF nen√≠ k dispozici.");throw new Error(n.message||"Nepoda≈ôilo se naƒç√≠st dokumenty")}if(!n.documents||0===n.documents.length)return void alert("Historie PDF nen√≠ k dispozici.\n\nP≈Øvodn√≠ zak√°zka je≈°tƒõ nem√° vytvo≈ôen√Ω PDF dokument.");const o=n.documents[0];logger.log(`Otev√≠r√°m PDF: ${o.file_path}`),zobrazPDFModal(o.file_path,e)}catch(e){logger.error("Chyba p≈ôi naƒç√≠t√°n√≠ historie PDF:",e),alert(`Nepoda≈ôilo se naƒç√≠st historii PDF:\n${e.message}`)}else alert("Chyb√≠ ID p≈Øvodn√≠ zak√°zky")}function normalizeCustomerData(e){const t={...e};if(!t.jmeno&&t.zakaznik&&(t.jmeno=t.zakaznik),!t.zakaznik&&t.jmeno&&(t.zakaznik=t.jmeno),!t.adresa&&(t.ulice||t.mesto||t.psc)){const e=[];t.ulice&&e.push(t.ulice),t.mesto&&e.push(t.mesto),t.psc&&e.push(t.psc),t.adresa=e.join(", ")}if(t.adresa&&(!t.ulice||!t.mesto)){const e=t.adresa.split(",").map(e=>e.trim());!t.ulice&&e[0]&&(t.ulice=e[0]),!t.mesto&&e[1]&&(t.mesto=e[1]),!t.psc&&e[2]&&(t.psc=e[2])}return t}window.reopenOrder=reopenOrder;let startVisitInProgress=!1;function startVisit(e){if(startVisitInProgress)return;startVisitInProgress=!0;const n=WGS_DATA_CACHE.find(t=>t.id==e);if(!n)return alert(t("record_not_found")),void(startVisitInProgress=!1);if(Utils.isCompleted(n))return alert(t("visit_already_completed")),void(startVisitInProgress=!1);const o=normalizeCustomerData(n);localStorage.setItem("currentCustomer",JSON.stringify(o)),localStorage.setItem("visitStartTime",(new Date).toISOString());const a="photoSections_"+o.id;localStorage.removeItem(a),logger.log("Normalizovan√° data ulo≈æena:",o),window.location.href="photocustomer.php?new=true"}async function saveData(e,n){try{const o=await getCSRFToken(),a=new FormData;Object.keys(e).forEach(t=>{a.append(t,e[t])}),a.append("action","update"),a.append("csrf_token",o);const i=await fetch("/app/controllers/save.php",{method:"POST",body:a}),r=await i.json();if(!i.ok)throw new Error(`HTTP ${i.status}: ${r.message||i.statusText}`);"success"===r.status?(Object.keys(e).forEach(t=>{const n=WGS_DATA_CACHE.find(t=>t.id==e.id);n&&"action"!==t&&(n[t]=e[t]),CURRENT_RECORD&&CURRENT_RECORD.id==e.id&&"action"!==t&&(CURRENT_RECORD[t]=e[t])}),alert(n),await loadAll(ACTIVE_FILTER),e.id?(closeDetail(),setTimeout(()=>showDetail(e.id),100)):closeDetail()):alert(t("error")+": "+(r.message||t("failed_to_save")))}catch(e){logger.error("Chyba p≈ôi ukl√°d√°n√≠:",e),alert(t("save_error")+": "+e.message)}}function showLoading(e=null){e||(e=t("loading"));const n=document.getElementById("loadingOverlay"),o=document.getElementById("loadingText");n&&o&&(o.textContent=e,n.classList.add("show"))}function hideLoading(){const e=document.getElementById("loadingOverlay");e&&e.classList.remove("show")}function showCalendar(e){const t=WGS_DATA_CACHE.find(t=>t.id==e);if(!t)return;CURRENT_RECORD=t,SELECTED_DATE=null,SELECTED_TIME=null;const n=`\n    <div class="modal-header">\n      <div id="selectedDateDisplay" style="color: var(--c-grey); font-size: 0.9rem; font-weight: 600; text-align: center;">Zat√≠m nevybr√°no</div>\n      <button class="modal-close" onclick="ModalManager.close()">‚úï</button>\n    </div>\n    \n    <div class="modal-body" style="max-height: 80vh; overflow-y: auto; padding: 1rem;">\n      <div class="calendar-container">\n        <div id="calGrid"></div>\n        <div id="distanceInfo"></div>\n        <div id="dayBookings"></div>\n        <div id="timeGrid"></div>\n      </div>\n    </div>\n    \n    ${ModalManager.createActions(['<button class="btn btn-secondary" onclick="showDetail(CURRENT_RECORD)">Zpƒõt</button>','<button class="btn btn-success" onclick="saveSelectedDate()">Ulo≈æit term√≠n</button>'])}\n  `;ModalManager.show(n);const o=new Date;CAL_MONTH=o.getMonth(),CAL_YEAR=o.getFullYear(),renderCalendar(CAL_MONTH,CAL_YEAR)}function previousMonth(){const e=new Date,n=e.getMonth(),o=e.getFullYear();let a=CAL_MONTH-1,i=CAL_YEAR;a<0&&(a=11,i--),i<o||i===o&&a<n?alert(t("cannot_show_past_months")):(CAL_MONTH=a,CAL_YEAR=i,renderCalendar(CAL_MONTH,CAL_YEAR))}function nextMonth(e){e&&e.stopPropagation(),CAL_MONTH++,CAL_MONTH>11&&(CAL_MONTH=0,CAL_YEAR++),renderCalendar(CAL_MONTH,CAL_YEAR)}function renderCalendar(e,n){const o=document.getElementById("calGrid");o.innerHTML="";const a=document.createElement("div");a.className="calendar-controls",a.innerHTML=`\n    <button class="calendar-nav-btn" onclick="previousMonth()">‚óÄ P≈ôedchoz√≠</button>\n    <span class="calendar-month-title">${["Leden","√önor","B≈ôezen","Duben","Kvƒõten","ƒåerven","ƒåervenec","Srpen","Z√°≈ô√≠","≈ò√≠jen","Listopad","Prosinec"][e]} ${n}</span>\n    <button class="calendar-nav-btn" onclick="event.stopPropagation(); nextMonth(event)">Dal≈°√≠ ‚ñ∂</button>\n  `,o.appendChild(a);const i=document.createElement("div");i.className="calendar-weekdays",i.innerHTML=`<div>${t("monday")}</div><div>${t("tuesday")}</div><div>${t("wednesday")}</div><div>${t("thursday")}</div><div>${t("friday")}</div><div>${t("saturday")}</div><div>${t("sunday")}</div>`,o.appendChild(i);const r=document.createElement("div");r.className="calendar-days";const d=new Date(n,e,1),s=new Date(n,e+1,0).getDate(),l=(d.getDay()+6)%7,c=new Set;WGS_DATA_CACHE.forEach(t=>{if(t.termin&&t.id!==CURRENT_RECORD?.id){const o=t.termin.split(".");if(3===o.length){const t=parseInt(o[0]),a=parseInt(o[1]),i=parseInt(o[2]);a===e+1&&i===n&&c.add(t)}}});for(let e=0;e<l;e++){const e=document.createElement("div");e.className="cal-day empty",r.appendChild(e)}const p=new Date;p.setHours(0,0,0,0);for(let o=1;o<=s;o++){const a=document.createElement("div");a.className="cal-day";const i=new Date(n,e,o);i.setHours(0,0,0,0);const d=i<p;d?(a.classList.add("disabled"),a.title="Nelze vybrat minul√© datum",a.style.opacity="0.3",a.style.cursor="not-allowed",a.style.backgroundColor="#f0f0f0"):c.has(o)&&(a.classList.add("occupied"),a.title="Tento den m√° ji≈æ nƒõjak√© term√≠ny"),a.textContent=o,a.onclick=()=>{if(d)return void alert(t("cannot_select_past_date"));SELECTED_DATE=`${o}.${e+1}.${n}`,document.querySelectorAll(".cal-day").forEach(e=>e.classList.remove("selected")),a.classList.add("selected");let i=`Vybran√Ω den: ${SELECTED_DATE}`;document.getElementById("selectedDateDisplay").textContent=i,renderTimeGrid()},r.appendChild(a)}o.appendChild(r)}async function fetchCsrfToken(){if("function"==typeof getCSRFToken)try{const e=await getCSRFToken();if(e)return e}catch(e){logger?.warn?.("CSRF token z getCSRFToken selhal:",e)}if("function"==typeof getCSRFTokenFromMeta){const e=getCSRFTokenFromMeta();if(e)return e}const e=document.querySelector('meta[name="csrf-token"]');if(e){const t=e.getAttribute("content");if(t)return window.csrfTokenCache=t,t}throw new Error("CSRF token nen√≠ k dispozici. Obnovte str√°nku a zkuste to znovu.")}async function getDistance(e,t){const n=`${e}|${t}`;if(DISTANCE_CACHE[n])return DISTANCE_CACHE[n];try{const o=new AbortController,a=setTimeout(()=>o.abort(),5e3),i=await fetchCsrfToken(),r=await fetch("/app/controllers/get_distance.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({origin:e,destination:t,csrf_token:i}),signal:o.signal});if(clearTimeout(a),r.ok){const e=await r.json();if(("success"===e.status||!0===e.success)&&e.distance){const t={km:(e.distance.value/1e3).toFixed(1),text:e.distance.text,duration:e.duration?e.duration.text:null};return DISTANCE_CACHE[n]=t,CacheManager.save(),t}}}catch(e){"AbortError"===e.name?logger.log("Request timeout"):logger.error("Chyba p≈ôi v√Ωpoƒçtu vzd√°lenosti:",e)}return null}async function getDistancesBatch(e){const t=e.map(e=>getDistance(e.from,e.to));return await Promise.all(t)}async function showDayBookingsWithDistances(e){const t=document.getElementById("distanceInfo"),n=document.getElementById("dayBookings");t&&(t.innerHTML=""),n&&(n.innerHTML="")}function showBookingDetail(e){let n;if("string"==typeof e||"number"==typeof e){if(n=WGS_DATA_CACHE.find(t=>t.id==e||t.reklamace_id==e),!n)return void alert(t("record_not_found"))}else n=e;const o=Utils.getCustomerName(n),a=Utils.getAddress(n),i=Utils.getProduct(n),r=n.popis_problemu||"‚Äî",d=`\n    ${ModalManager.createHeader("Detail obsazen√©ho term√≠nu",'<p style="color: var(--c-error); font-weight: 600;">Tento term√≠n je ji≈æ obsazen</p>')}\n    \n    <div class="modal-body">\n      <div style="padding: 1.5rem; background: rgba(139, 0, 0, 0.05); border: 2px solid var(--c-error); margin-bottom: 1.5rem;">\n        <div class="info-grid" style="font-family: 'Poppins', sans-serif;">\n          <div class="info-label">Z√°kazn√≠k:</div>\n          <div class="info-value"><strong>${o}</strong></div>\n          \n          <div class="info-label">Term√≠n:</div>\n          <div class="info-value"><strong>${formatDate(n.termin||"")} v ${n.cas_navstevy||"‚Äî"}</strong></div>\n          \n          <div class="info-label">Adresa:</div>\n          <div class="info-value">${a}</div>\n          \n          <div class="info-label">Produkt:</div>\n          <div class="info-value">${i}</div>\n          \n          <div class="info-label">Popis:</div>\n          <div class="info-value" style="line-height: 1.6;">${r}</div>\n        </div>\n      </div>\n    </div>\n    \n    ${ModalManager.createActions(['<button class="btn btn-secondary" onclick="showCalendar(\''+CURRENT_RECORD.id+"')\">Zpƒõt na kalend√°≈ô</button>"])}\n  `;ModalManager.show(d)}function renderTimeGrid(){const e=document.getElementById("timeGrid");e.innerHTML="";const t={};WGS_DATA_CACHE.forEach(e=>{if(e.termin===SELECTED_DATE&&e.cas_navstevy&&e.id!==CURRENT_RECORD?.id){const n=Utils.getCustomerName(e);t[e.cas_navstevy]={zakaznik:n,model:Utils.getProduct(e)}}});for(let n=8;n<=19;n++)for(const o of[0,30]){const a=`${String(n).padStart(2,"0")}:${0===o?"00":"30"}`,i=document.createElement("div");i.className="time-slot",t[a]&&(i.classList.add("occupied"),i.title=`${t[a].zakaznik} ‚Äî ${t[a].model}`),i.textContent=a,i.onclick=()=>{SELECTED_TIME=a,document.querySelectorAll(".time-slot").forEach(e=>e.classList.remove("selected")),i.classList.add("selected");let e=`Vybran√Ω term√≠n: ${SELECTED_DATE} ‚Äî ${SELECTED_TIME}`;t[a]&&(e+=` KOLIZE: ${t[a].zakaznik}`),document.getElementById("selectedDateDisplay").textContent=e},e.appendChild(i)}}async function saveSelectedDate(){if(!SELECTED_DATE||!SELECTED_TIME)return void alert(t("select_date_and_time"));if(!CURRENT_RECORD)return void alert(t("no_record_to_save"));Array.isArray(WGS_DATA_CACHE)||(WGS_DATA_CACHE=[]);const e=WGS_DATA_CACHE.find(e=>e.termin===SELECTED_DATE&&e.cas_navstevy===SELECTED_TIME&&e.id!==CURRENT_RECORD.id);if(e){const n=Utils.getCustomerName(e);if(!window.confirm(t("confirm_appointment_collision").replace("{date}",SELECTED_DATE).replace("{time}",SELECTED_TIME).replace("{customer}",n)))return}showLoading(t("saving_appointment"));const n=performance.now();logger.log("‚è±Ô∏è START ukl√°d√°n√≠ term√≠nu...");try{const e=performance.now(),o=await getCSRFToken(),a=performance.now();logger.log(`‚è±Ô∏è CSRF token z√≠sk√°n za ${(a-e).toFixed(0)}ms`);const i=new FormData;i.append("action","update"),i.append("id",CURRENT_RECORD.id),i.append("termin",SELECTED_DATE),i.append("cas_navstevy",SELECTED_TIME),i.append("stav","DOMLUVEN√Å"),i.append("csrf_token",o),showLoading(t("saving_appointment_to_db"));const r=performance.now();logger.log("‚è±Ô∏è Odes√≠l√°m POST request na save.php...");const d=await fetch("/app/controllers/save.php",{method:"POST",body:i}),s=performance.now();logger.log(`‚è±Ô∏è POST request dokonƒçen za ${(s-r).toFixed(0)}ms`);const l=await d.json();if(!d.ok)throw new Error(`HTTP ${d.status}: ${l.message||d.statusText}`);if("success"===l.status){const e=performance.now();logger.log(`‚è±Ô∏è SUCCESS block started: ${(e-n).toFixed(0)}ms od zaƒç√°tku`);const o=performance.now();CURRENT_RECORD.termin=SELECTED_DATE,CURRENT_RECORD.cas_navstevy=SELECTED_TIME,CURRENT_RECORD.stav="DOMLUVEN√Å";const a=performance.now();logger.log(`‚è±Ô∏è CURRENT_RECORD update: ${(a-o).toFixed(0)}ms`);const i=performance.now(),r=WGS_DATA_CACHE.find(e=>e.id===CURRENT_RECORD.id);r&&(r.termin=SELECTED_DATE,r.cas_navstevy=SELECTED_TIME,r.stav="DOMLUVEN√Å");const d=performance.now();logger.log(`‚è±Ô∏è Cache update: ${(d-i).toFixed(0)}ms`);const s=performance.now();hideLoading();const l=performance.now();logger.log(`‚è±Ô∏è hideLoading(): ${(l-s).toFixed(0)}ms`);const c=performance.now();logger.log(`‚è±Ô∏è TƒöSNƒö P≈òED ALERT: ${(c-n).toFixed(0)}ms od zaƒç√°tku`),alert(t("appointment_saved_success").replace("{date}",SELECTED_DATE).replace("{time}",SELECTED_TIME));const p=performance.now();logger.log(`‚è±Ô∏è alert() dokonƒçen: ${(p-c).toFixed(0)}ms`);const m=performance.now();sendAppointmentConfirmation(CURRENT_RECORD,SELECTED_DATE,SELECTED_TIME).catch(e=>logger.warn("‚ö† Email se nepoda≈ôilo odeslat:",e.message));const u=performance.now();logger.log(`‚è±Ô∏è sendAppointmentConfirmation() launch: ${(u-m).toFixed(0)}ms`);const g=performance.now();logger.log("‚è±Ô∏è Aktualizuji detail...");const h=CURRENT_RECORD.id,y=performance.now();closeDetail();const f=performance.now();logger.log(`‚è±Ô∏è closeDetail(): ${(f-y).toFixed(0)}ms`);const v=performance.now();setTimeout(()=>showDetail(h),100);const b=performance.now();logger.log(`‚è±Ô∏è setTimeout() scheduled: ${(b-v).toFixed(0)}ms`);const w=performance.now();logger.log(`‚è±Ô∏è Detail aktualizov√°n za ${(w-g).toFixed(0)}ms`);const x=performance.now();logger.log(`‚è±Ô∏è CELKOV√ù ƒåAS: ${(x-n).toFixed(0)}ms (${((x-n)/1e3).toFixed(1)}s)`)}else hideLoading(),alert(t("error")+": "+(l.message||t("failed_to_save")))}catch(e){hideLoading(),logger.error("Chyba p≈ôi ukl√°d√°n√≠:",e),alert(t("save_error")+": "+e.message);const o=performance.now();logger.log(`‚è±Ô∏è ƒåas do chyby: ${(o-n).toFixed(0)}ms`)}}function showContactMenu(e){const t=CURRENT_RECORD.telefon||"",n=CURRENT_RECORD.email||"",o=Utils.getCustomerName(CURRENT_RECORD),a=Utils.getAddress(CURRENT_RECORD),i=`\n    ${ModalManager.createHeader(o,"Kontaktovat z√°kazn√≠ka")}\n    \n    <div class="modal-body">\n      <div class="info-grid" style="margin-bottom: 1rem;">\n        <div class="info-label">Telefon:</div>\n        <div class="info-value"><strong>${t||"Neuvedeno"}</strong></div>\n        \n        <div class="info-label">Email:</div>\n        <div class="info-value"><strong>${n||"Neuvedeno"}</strong></div>\n        \n        <div class="info-label">Adresa:</div>\n        <div class="info-value"><strong>${a||"Neuvedeno"}</strong></div>\n      </div>\n      \n      <div class="modal-section">\n        <h3 class="section-title">Rychl√© akce</h3>\n        <div style="display: flex; flex-direction: column; gap: 0.5rem;">\n          ${t?`<a href="tel:${t}" class="btn" style="width: 100%; min-height: 48px; padding: 0.75rem 1rem; font-size: 0.9rem; text-decoration: none; display: flex; align-items: center; justify-content: center; background: #1a1a1a; color: white; box-sizing: border-box;">Zavolat</a>`:""}\n          <button class="btn" style="width: 100%; min-height: 48px; padding: 0.75rem 1rem; font-size: 0.9rem; background: #1a1a1a; color: white; box-sizing: border-box;" onclick="closeDetail(); setTimeout(() => showCalendar('${e}'), 100)">Term√≠n n√°v≈°tƒõvy</button>\n          ${t?`<button class="btn" style="width: 100%; min-height: 48px; padding: 0.75rem 1rem; font-size: 0.9rem; background: #444; color: white; box-sizing: border-box;" onclick="sendContactAttemptEmail('${e}', '${t}')">Odeslat SMS</button>`:""}\n          ${a&&"‚Äî"!==a?`<a href="https://waze.com/ul?q=${encodeURIComponent(a)}&navigate=yes" class="btn" style="width: 100%; min-height: 48px; padding: 0.75rem 1rem; font-size: 0.9rem; text-decoration: none; display: flex; align-items: center; justify-content: center; background: #444; color: white; box-sizing: border-box;" target="_blank">Navigovat (Waze)</a>`:""}\n        </div>\n      </div>\n    </div>\n    \n    ${ModalManager.createActions(['<button class="btn btn-secondary" onclick="showDetail(CURRENT_RECORD)">Zpƒõt</button>'])}\n  `;ModalManager.show(i)}function toggleMap(){const e=document.getElementById("mapContent"),t=document.getElementById("mapToggleIcon");e.classList.contains("active")?(e.classList.remove("active"),t.classList.remove("active")):(e.classList.add("active"),t.classList.add("active"),e.dataset.loaded||(e.dataset.loaded="true",loadMapAndRoute()))}async function loadMapAndRoute(){const e=document.getElementById("mapContainer");if(!CURRENT_RECORD)return;let n=Utils.getAddress(CURRENT_RECORD);if(n&&"‚Äî"!==n){n=Utils.addCountryToAddress(n);try{const t=encodeURIComponent(WGS_ADDRESS),o=encodeURIComponent(n);e.innerHTML=`\n      <div style="background: var(--c-bg); padding: 1rem; text-align: center; border: 1px solid var(--c-border);">\n        <div style="font-size: 0.8rem; color: var(--c-grey); margin-bottom: 0.8rem; line-height: 1.4;">\n          <strong>Z:</strong> WGS<br>\n          <strong>Do:</strong> ${n}<br>\n          <strong>Vzd√°lenost:</strong> <span id="mapDistance">Naƒç√≠t√°m...</span><br>\n          <strong>ƒåas:</strong> <span id="mapDuration">‚Äî</span>\n        </div>\n        <div style="display: flex; gap: 0.5rem; justify-content: center;">\n          <a href="https://www.google.com/maps/dir/?api=1&origin=${t}&destination=${o}&travelmode=driving"\n             class="btn" target="_blank" style="text-decoration: none; padding: 0.5rem 1rem; font-size: 0.75rem;">\n            Google Maps\n          </a>\n          <a href="https://waze.com/ul?q=${o}&navigate=yes"\n             class="btn" target="_blank" style="text-decoration: none; padding: 0.5rem 1rem; font-size: 0.75rem;">\n            Waze\n          </a>\n        </div>\n      </div>\n    `,document.getElementById("mapDistance").textContent="‚Äî",document.getElementById("mapDuration").textContent="‚Äî"}catch(t){logger.error("Chyba p≈ôi naƒç√≠t√°n√≠ mapy:",t),e.innerHTML=`\n      <div class="map-error">\n        Nepoda≈ôilo se naƒç√≠st mapu<br>\n        <small>${t.message}</small>\n      </div>\n    `}}else e.innerHTML=`<div class="map-error">${t("customer_address_not_available")}</div>`}async function showCustomerDetail(e){const t=Utils.getCustomerName(CURRENT_RECORD),n=CURRENT_RECORD.telefon||"",o=CURRENT_RECORD.email||"",a=Utils.getAddress(CURRENT_RECORD),i=Utils.getProduct(CURRENT_RECORD),r=CURRENT_RECORD.popis_problemu||"",d=CURRENT_RECORD.cislo||"",s=CURRENT_RECORD.reklamace_id||"",l=CURRENT_RECORD.created_by_name||CURRENT_RECORD.prodejce||"",c=CURRENT_RECORD.datum_prodeje||"",p=CURRENT_RECORD.datum_reklamace||"",m=CURRENT_RECORD.provedeni||"",u=CURRENT_RECORD.barva||"",g=CURRENT_RECORD.doplnujici_info||"",h=CURRENT_RECORD.fakturace_firma||"CZ",y=await loadPhotosFromDB(s);let f=y.length>0?y:[];if(0===f.length){const t="photoSections_"+e,n=localStorage.getItem(t);if(n)try{const e=JSON.parse(n);Object.values(e).forEach(e=>{e.photos&&Array.isArray(e.photos)&&(f=f.concat(e.photos))})}catch(e){logger.error("Chyba p≈ôi naƒç√≠t√°n√≠ fotek:",e)}}const v=`\n    ${ModalManager.createHeader("Detail z√°kazn√≠ka",t)}\n\n    <div class="modal-body" style="max-height: 70vh; overflow-y: auto; padding: 1rem;">\n\n      \x3c!-- KOMPAKTN√ç INFO BLOK --\x3e\n      <div style="background: #f8f9fa; border: 1px solid #e0e0e0; border-radius: 4px; padding: 0.75rem; margin-bottom: 1rem;">\n        <div style="display: grid; grid-template-columns: auto 1fr; gap: 0.5rem; font-size: 0.9rem;">\n          <span style="color: #666; font-weight: 600;">ƒå√≠slo objedn√°vky:</span>\n          <input type="text" style="border: 1px solid #ddd; padding: 0.25rem 0.5rem; border-radius: 3px; font-size: 0.9rem; background: white;" value="${Utils.escapeHtml(s)}" readonly>\n\n          <span style="color: #666; font-weight: 600;">Zadavatel:</span>\n          <input type="text" style="border: 1px solid #ddd; padding: 0.25rem 0.5rem; border-radius: 3px; font-size: 0.9rem; background: #f8f9fa;" value="${Utils.escapeHtml(l)}" readonly placeholder="Prodejce/U≈æivatel">\n\n          <span style="color: #666; font-weight: 600;">ƒå√≠slo reklamace:</span>\n          <input type="text" id="edit_cislo" style="border: 1px solid #ddd; padding: 0.25rem 0.5rem; border-radius: 3px; font-size: 0.9rem;" value="${Utils.escapeHtml(d)}">\n\n          <span style="color: #666; font-weight: 600;">Fakturace:</span>\n          <span style="color: #1a1a1a; font-weight: 600; padding: 0.25rem 0;">${"SK"===h.toUpperCase()?"Slovensko (SK)":"ƒåesk√° republika (CZ)"}</span>\n\n          <span style="color: #666; font-weight: 600;">Datum prodeje:</span>\n          <input type="text" id="edit_datum_prodeje" style="border: 1px solid #ddd; padding: 0.25rem 0.5rem; border-radius: 3px; font-size: 0.9rem;" value="${Utils.escapeHtml(c)}" placeholder="DD.MM.RRRR">\n\n          <span style="color: #666; font-weight: 600;">Datum reklamace:</span>\n          <input type="text" id="edit_datum_reklamace" style="border: 1px solid #ddd; padding: 0.25rem 0.5rem; border-radius: 3px; font-size: 0.9rem;" value="${Utils.escapeHtml(p)}" placeholder="DD.MM.RRRR">\n\n          <span style="color: #666; font-weight: 600;">Jm√©no:</span>\n          <input type="text" id="edit_jmeno" style="border: 1px solid #ddd; padding: 0.25rem 0.5rem; border-radius: 3px; font-size: 0.9rem;" value="${t}">\n\n          <span style="color: #666; font-weight: 600;">Telefon:</span>\n          <input type="tel" id="edit_telefon" style="border: 1px solid #ddd; padding: 0.25rem 0.5rem; border-radius: 3px; font-size: 0.9rem;" value="${n}">\n\n          <span style="color: #666; font-weight: 600;">Email:</span>\n          <input type="email" id="edit_email" style="border: 1px solid #ddd; padding: 0.25rem 0.5rem; border-radius: 3px; font-size: 0.9rem;" value="${o}">\n\n          <span style="color: #666; font-weight: 600;">Adresa:</span>\n          <input type="text" id="edit_adresa" style="border: 1px solid #ddd; padding: 0.25rem 0.5rem; border-radius: 3px; font-size: 0.9rem;" value="${a}">\n\n          <span style="color: #666; font-weight: 600;">Model:</span>\n          <input type="text" id="edit_model" style="border: 1px solid #ddd; padding: 0.25rem 0.5rem; border-radius: 3px; font-size: 0.9rem;" value="${i}">\n\n          <span style="color: #666; font-weight: 600;">Proveden√≠:</span>\n          <input type="text" id="edit_provedeni" style="border: 1px solid #ddd; padding: 0.25rem 0.5rem; border-radius: 3px; font-size: 0.9rem;" value="${Utils.escapeHtml(m)}" placeholder="L√°tka / K≈Ø≈æe">\n\n          <span style="color: #666; font-weight: 600;">Barva:</span>\n          <input type="text" id="edit_barva" style="border: 1px solid #ddd; padding: 0.25rem 0.5rem; border-radius: 3px; font-size: 0.9rem;" value="${Utils.escapeHtml(u)}">\n        </div>\n      </div>\n\n      \x3c!-- DOPL≈áUJ√çC√ç INFORMACE OD PRODEJCE --\x3e\n      <div style="margin-bottom: 1rem;">\n        <label style="display: block; color: #666; font-weight: 600; font-size: 0.8rem; margin-bottom: 0.25rem;">Dopl≈àuj√≠c√≠ informace od prodejce:</label>\n        <textarea id="edit_doplnujici_info"\n                  style="width: 100%; border: 1px solid #ddd; padding: 0.5rem; border-radius: 3px; font-size: 0.9rem; min-height: 60px; background: white; resize: vertical; font-family: inherit;"\n                  placeholder="Zadejte dopl≈àuj√≠c√≠ informace od prodejce">${Utils.escapeHtml(g)}</textarea>\n      </div>\n\n      \x3c!-- POPIS PROBL√âMU OD Z√ÅKAZN√çKA --\x3e\n      <div style="margin-bottom: 2rem;">\n        <label style="display: block; color: #666; font-weight: 600; font-size: 0.8rem; margin-bottom: 0.25rem;">Popis probl√©mu od z√°kazn√≠ka:</label>\n        <textarea id="edit_popis_problemu"\n                  style="width: 100%; border: 1px solid #ddd; padding: 0.5rem; border-radius: 3px; font-size: 0.9rem; min-height: 80px; background: white; resize: vertical; font-family: inherit;"\n                  placeholder="Zadejte popis probl√©mu od z√°kazn√≠ka">${Utils.escapeHtml(r)}</textarea>\n      </div>\n\n      \x3c!-- FOTOGRAFIE --\x3e\n      ${f.length>0?`\n        <div style="margin-bottom: 1rem;">\n          <label style="display: block; color: #666; font-weight: 600; font-size: 0.8rem; margin-bottom: 0.5rem;">Fotografie (${f.length}):</label>\n          <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 0.5rem;">\n            ${f.map((e,t)=>{const n="object"==typeof e?e.photo_path:e,o="object"==typeof e?e.id:null,a=n.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/'/g,"\\'");return`\n                <div class="foto-wrapper" style="position: relative;">\n                  <img src='${n}'\n                       style='width: 100%; aspect-ratio: 1; object-fit: cover; border: 1px solid #ddd; cursor: pointer; border-radius: 3px;'\n                       alt='Fotka ${t+1}'\n                       data-action="showPhotoFullscreen"\n                       data-url="${a}">\n                  ${o?`\n                    <button class="foto-delete-btn"\n                            data-action="smazatFotku"\n                            data-photo-id="${o}"\n                            data-url="${a}"\n                            title="Smazat fotku">\n                      √ó\n                    </button>\n                  `:""}\n                </div>\n              `}).join("")}\n          </div>\n        </div>\n      `:""}\n\n      \x3c!-- PDF DOKUMENTY --\x3e\n      ${(()=>{const e=CURRENT_RECORD.documents||[],t=e.find(e=>"complete_report"===e.document_type),n=e.length>0?e[0]:null,o=t||n;return o?`\n          <div style="margin-bottom: 1rem;">\n            <label style="display: block; color: #666; font-weight: 600; font-size: 0.8rem; margin-bottom: 0.5rem;">PDF Report:</label>\n            <button data-action="openPDF"\n                    data-url="${o.file_path.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}"\n                    style="width: 100%; padding: 0.75rem; background: #333333; color: white; border: none; border-radius: 4px; font-size: 0.9rem; cursor: pointer; font-weight: 600;">\n              Otev≈ô√≠t PDF Report\n            </button>\n          </div>\n        `:'\n            <div style="padding: 0.75rem; text-align: center; background: #f8f9fa; border: 1px dashed #dee2e6; border-radius: 4px; margin-bottom: 1rem;">\n              <p style="margin: 0; color: #6c757d; font-size: 0.8rem;">PDF report je≈°tƒõ nebyl vytvo≈ôen</p>\n            </div>\n          '})()}\n\n      ${CURRENT_USER.is_admin?`\n        <div style="border-top: 1px solid #e0e0e0; padding-top: 1rem; margin-top: 1rem;">\n          <button data-action="deleteReklamace"\n                  data-id="${e}"\n                  style="width: 100%; padding: 0.5rem; background: #666; color: white; border: none; border-radius: 3px; font-size: 0.9rem; cursor: pointer; font-weight: 600;">\n            Smazat reklamaci\n          </button>\n          <p style="font-size: 0.7rem; color: #999; margin-top: 0.25rem; text-align: center;">Sma≈æe v≈°e vƒçetnƒõ fotek a PDF</p>\n        </div>\n      `:""}\n\n    </div>\n\n    ${ModalManager.createActions(['<button class="btn btn-secondary" data-action="showDetail" data-id="'+e+'">Zpƒõt</button>','<button class="btn" style="background: #1a1a1a; color: white;" data-action="saveAllCustomerData" data-id="'+e+'">Ulo≈æit zmƒõny</button>'])}\n  `;ModalManager.show(v)}function zobrazPDFModal(e,t){const n=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,o=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),a=window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone,i=document.createElement("div");i.id="pdfModalOverlay",i.style.cssText="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 10003; display: flex; flex-direction: column; align-items: center; justify-content: center;";const r=document.createElement("div");r.style.cssText="width: 95%; height: calc(100% - 80px); max-width: 900px; background: white; border-radius: 8px; overflow: hidden; display: flex; flex-direction: column;";const d=document.createElement("div");let s;if(d.style.cssText="padding: 12px 16px; background: #333; color: white; font-weight: 600; font-size: 0.95rem; display: flex; justify-content: space-between; align-items: center;",d.innerHTML='<span>PDF Report</span><span style="font-size: 0.8rem; opacity: 0.7;">ID: '+(t||"-")+"</span>",n||o&&a){s=document.createElement("div"),s.style.cssText="flex: 1; width: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #f5f5f5; padding: 2rem;";const t=document.createElement("object");t.data=e,t.type="application/pdf",t.style.cssText="width: 100%; height: 100%; border: none;";const n=document.createElement("div");n.style.cssText="text-align: center; padding: 2rem;",n.innerHTML=`\n      <p style="color: #666; margin-bottom: 1rem;">N√°hled PDF nen√≠ k dispozici na tomto za≈ô√≠zen√≠.</p>\n      <button onclick="window.open('${e}', '_blank')"\n              style="padding: 12px 24px; background: #333; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 1rem; font-weight: 600;">\n        Otev≈ô√≠t PDF v nov√©m oknƒõ\n      </button>\n    `,t.appendChild(n),s.appendChild(t)}else s=document.createElement("iframe"),s.src=e,s.style.cssText="flex: 1; width: 100%; border: none;";r.appendChild(d),r.appendChild(s);const l=document.createElement("div");l.style.cssText="display: flex; gap: 12px; margin-top: 16px; padding: 0 16px; flex-wrap: wrap; justify-content: center;";const c=document.createElement("button");c.textContent="Ulo≈æit",c.style.cssText="padding: 12px 24px; font-size: 0.95rem; font-weight: 600; background: #555; color: white; border: none; border-radius: 6px; cursor: pointer; min-width: 110px; touch-action: manipulation;",c.onclick=()=>{const n=document.createElement("a");n.href=e,n.download=`PDF_Report_${t||"dokument"}.pdf`,n.click()};const p=document.createElement("button");p.textContent="Sd√≠let",p.style.cssText="padding: 12px 24px; font-size: 0.95rem; font-weight: 600; background: #333; color: white; border: none; border-radius: 6px; cursor: pointer; min-width: 110px; touch-action: manipulation;";const m=document.createElement("button");m.textContent="Zav≈ô√≠t",m.style.cssText="padding: 12px 24px; font-size: 0.95rem; font-weight: 600; background: #666; color: white; border: none; border-radius: 6px; cursor: pointer; min-width: 110px; touch-action: manipulation;",m.onclick=()=>i.remove(),p.onclick=async()=>{try{if(!navigator.share&&!navigator.canShare)return void alert('Sd√≠len√≠ nen√≠ podporov√°no v tomto prohl√≠≈æeƒçi.\n\nPou≈æijte tlaƒç√≠tko "Ulo≈æit" a pak sd√≠lejte soubor ruƒçnƒõ.');p.disabled=!0,p.textContent="Naƒç√≠t√°m...";const n=await fetch(e),o=await n.blob(),a=`PDF_Report_${t||"dokument"}.pdf`,i=new File([o],a,{type:"application/pdf"}),r={title:`PDF Report - ${t||"WGS"}`,text:`PDF dokument zak√°zky ${t||""}`,files:[i]};if(navigator.canShare&&!navigator.canShare(r))throw new Error("Sd√≠len√≠ soubor≈Ø nen√≠ podporov√°no");await navigator.share(r)}catch(e){"AbortError"!==e.name&&alert("Chyba p≈ôi sd√≠len√≠: "+e.message)}finally{p.disabled=!1,p.textContent="Sd√≠let"}},l.appendChild(c),l.appendChild(p),l.appendChild(m),i.appendChild(r),i.appendChild(l),i.onclick=e=>{e.target===i&&i.remove()};const u=e=>{"Escape"===e.key&&(i.remove(),document.removeEventListener("keydown",u))};document.addEventListener("keydown",u),document.body.appendChild(i)}function showPhotoFullscreen(e){const t=document.createElement("div");t.style.cssText="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 9999; display: flex; align-items: center; justify-content: center; cursor: pointer;",t.onclick=()=>t.remove();const n=document.createElement("img");n.alt="Zvƒõt≈°en√° fotka reklamace",n.src=e,n.style.cssText="max-width: 95%; max-height: 95%; object-fit: contain;",t.appendChild(n),document.body.appendChild(t)}function showTextOverlay(e){if(!CURRENT_RECORD)return;const n="popis_problemu"===e?"Popis probl√©mu":"Dopl≈àuj√≠c√≠ informace",o=CURRENT_RECORD[e]||"",a=document.createElement("div");a.style.cssText="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999; display: flex; align-items: center; justify-content: center; padding: 2rem;";const i=document.createElement("div");i.style.cssText="background: white; padding: 1.5rem; border-radius: 6px; max-width: 700px; width: 100%; max-height: 85vh; display: flex; flex-direction: column;",i.onclick=e=>e.stopPropagation();const r=document.createElement("div");r.style.cssText="font-weight: 600; font-size: 1rem; color: #1a1a1a; margin-bottom: 1rem; padding-bottom: 0.75rem; border-bottom: 1px solid #dee2e6;",r.textContent=n;const d=document.createElement("div");d.style.cssText="flex: 1; overflow-y: auto; margin-bottom: 1rem;";const s=document.createElement("textarea");s.style.cssText="width: 100%; min-height: 300px; border: 1px solid #ddd; padding: 0.75rem; border-radius: 4px; font-size: 0.9rem; line-height: 1.6; font-family: inherit; resize: vertical;",s.value=o,s.placeholder="Zadejte text...",d.appendChild(s);const l=document.createElement("div");l.style.cssText="display: flex; gap: 0.5rem; padding-top: 1rem; border-top: 1px solid #dee2e6;";const c=document.createElement("button");c.style.cssText="flex: 1; padding: 0.5rem 1rem; background: #1a1a1a; color: white; border: none; border-radius: 4px; font-size: 0.9rem; cursor: pointer; font-weight: 600;",c.textContent=t("save_changes"),c.onclick=async()=>{const n=s.value;try{const o=await getCSRFToken(),i=new FormData;i.append("action","update"),i.append("id",CURRENT_RECORD.id),i.append(e,n),i.append("csrf_token",o);const r=await fetch("/app/controllers/save.php",{method:"POST",body:i}),d=await r.json();if("success"===d.status){CURRENT_RECORD[e]=n;const o=WGS_DATA_CACHE.find(e=>e.id==CURRENT_RECORD.id);o&&(o[e]=n),a.remove(),showCustomerDetail(CURRENT_RECORD.id),alert(t("text_saved_successfully"))}else alert(t("save_error")+": "+d.message)}catch(e){alert(t("save_error")+": "+e.message)}};const p=document.createElement("button");p.style.cssText="flex: 1; padding: 0.5rem 1rem; background: #666; color: white; border: none; border-radius: 4px; font-size: 0.9rem; cursor: pointer;",p.textContent=t("cancel"),p.onclick=()=>a.remove(),l.appendChild(c),l.appendChild(p),i.appendChild(r),i.appendChild(d),i.appendChild(l),a.appendChild(i),document.body.appendChild(a),a.onclick=e=>{e.target===a&&a.remove()},setTimeout(()=>s.focus(),100)}async function saveAllCustomerData(e){const t={action:"update",id:e,cislo:document.getElementById("edit_cislo").value,datum_prodeje:document.getElementById("edit_datum_prodeje").value,datum_reklamace:document.getElementById("edit_datum_reklamace").value,jmeno:document.getElementById("edit_jmeno").value,telefon:document.getElementById("edit_telefon").value,email:document.getElementById("edit_email").value,adresa:document.getElementById("edit_adresa").value,model:document.getElementById("edit_model").value,provedeni:document.getElementById("edit_provedeni").value,barva:document.getElementById("edit_barva").value,doplnujici_info:document.getElementById("edit_doplnujici_info").value,popis_problemu:document.getElementById("edit_popis_problemu").value};await saveData(t,"V≈°echny √∫daje byly aktualizov√°ny")}async function sendAppointmentConfirmation(e,t,n){const o=Utils.getCustomerName(e),a=e.telefon||"",i=e.email||"",r=Utils.getOrderId(e),d=Utils.getAddress(e)||"",s=e.nazev_produktu||e.produkt||e.popis_produktu||"",l=e.technik_jmeno||e.assigned_technician||"",c=e.technik_email||"",p=e.technik_telefon||"";try{const e=await getCSRFToken(),m=await fetch("app/notification_sender.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({notification_id:"appointment_confirmed",csrf_token:e,data:{customer_name:o,customer_email:i,customer_phone:a,seller_email:"admin@wgs-service.cz",date:t,time:n,order_id:r,address:d,product:s,technician_name:l,technician_email:c,technician_phone:p}})}),u=await m.json();!0===u.success?(logger.log("Potvrzen√≠ term√≠nu odesl√°no z√°kazn√≠kovi"),u.sent&&logger.log("  Email odesl√°n na:",u.to||i),u.sms_sent&&logger.log("  SMS odesl√°na na:",a)):logger.error("‚ö† Chyba p≈ôi odes√≠l√°n√≠ potvrzen√≠:",u.error||u.message)}catch(e){logger.error("Chyba p≈ôi odes√≠l√°n√≠ potvrzen√≠:",e)}}async function getNotes(e){try{const t=WGS_DATA_CACHE.find(t=>t.id==e||t.reklamace_id==e);if(!t)return[];const n=t.reklamace_id||t.id,o=await fetch(`api/notes_api.php?action=get&reklamace_id=${encodeURIComponent(n)}`),a=await o.json();return("success"===a.status||!0===a.success)&&a.notes||[]}catch(e){return logger.error("Chyba p≈ôi naƒç√≠t√°n√≠ pozn√°mek:",e),[]}}async function addNote(e,t,n=null){try{const o=WGS_DATA_CACHE.find(t=>t.id==e||t.reklamace_id==e);if(!o)throw new Error("Reklamace nenalezena");const a=await getCSRFToken(),i=o.reklamace_id||o.id,r=new FormData;if(r.append("action","add"),r.append("reklamace_id",i),r.append("text",t.trim()),r.append("csrf_token",a),logger.log("[Audio] audioBlob status:",n?"existuje":"null",n?n.size+" bytes":""),n){let e="webm";n.type.includes("mp4")?e="m4a":n.type.includes("ogg")?e="ogg":n.type.includes("mp3")||n.type.includes("mpeg")?e="mp3":n.type.includes("wav")&&(e="wav"),r.append("audio",n,`nahravka.${e}`),logger.log("[Audio] Odesilam nahravku:",Math.round(n.size/1024),"KB, type:",n.type)}logger.log("[Notes] Odesilam poznamku na API...");const d=await fetch("api/notes_api.php",{method:"POST",body:r});logger.log("[Notes] API odpoved status:",d.status);const s=await d.json();if(logger.log("[Notes] API odpoved data:",JSON.stringify(s)),"success"===s.status||!0===s.success)return{success:!0,note_id:s.note_id};throw new Error(s.error||s.message||"Chyba pri pridavani poznamky")}catch(e){throw logger.error("Chyba pri pridavani poznamky:",e),e}}async function deleteNote(e,t){if(confirm("Opravdu chcete smazat tuto poznamku?"))try{const t=await getCSRFToken(),n=new FormData;n.append("action","delete"),n.append("note_id",e),n.append("csrf_token",t);const o=await fetch("api/notes_api.php",{method:"POST",body:n}),a=await o.json();if("success"===a.status){const t=document.querySelector(`[data-note-id="${e}"]`);t&&t.remove();const n=document.querySelector(".notes-container");n&&0===n.querySelectorAll(".note-item").length&&(n.innerHTML='<div class="empty-notes">Zatim zadne poznamky</div>'),await loadAll(ACTIVE_FILTER)}else alert("Chyba: "+(a.error||a.message||"Neznama chyba"))}catch(e){logger.error("Chyba pri mazani poznamky:",e),alert("Chyba pri mazani poznamky: "+e.message)}}async function markNotesAsRead(e){try{const t=WGS_DATA_CACHE.find(t=>t.id==e||t.reklamace_id==e);if(!t)return;const n=await getCSRFToken(),o=t.reklamace_id||t.id,a=new FormData;a.append("action","mark_read"),a.append("reklamace_id",o),a.append("csrf_token",n),await fetch("api/notes_api.php",{method:"POST",body:a})}catch(e){logger.error("Chyba p≈ôi oznaƒçov√°n√≠ pozn√°mek:",e)}}async function showNotes(e){let n;if("string"==typeof e||"number"==typeof e){if(n=WGS_DATA_CACHE.find(t=>t.id==e||t.reklamace_id==e),!n)return void alert(t("record_not_found"))}else n=e;CURRENT_RECORD=n;const o=Utils.getCustomerName(n),a=`\n    ${ModalManager.createHeader("Pozn√°mky",o)}\n    <div class="modal-body" style="text-align: center; padding: 3rem;">\n      <div class="loading">Naƒç√≠t√°n√≠ pozn√°mek...</div>\n    </div>\n  `;ModalManager.show(a);const i=await getNotes(n.id);i.sort((e,t)=>new Date(t.timestamp)-new Date(e.timestamp));const r=`\n    ${ModalManager.createHeader("Pozn√°mky",o)}\n\n    <div class="modal-body">\n      <div class="notes-container">\n        ${i.length>0?i.map(e=>{const t=CURRENT_USER&&(CURRENT_USER.is_admin||e.author===CURRENT_USER.email),o=e.has_audio&&e.audio_url,a="[Hlasov√° pozn√°mka]"===e.text||"[Hlasova poznamka]"===e.text;return`\n              <div class="note-item ${e.read?"":"unread"} ${o?"has-audio":""}" data-note-id="${e.id}">\n                <div class="note-header">\n                  <span class="note-author">${e.author_name||e.author}</span>\n                  <span class="note-time">${formatDateTime(e.timestamp)}</span>\n                  ${t?`<button class="note-delete-btn" data-action="deleteNote" data-note-id="${e.id}" data-order-id="${n.id}" title="Smazat poznamku">x</button>`:""}\n                </div>\n                ${a?"":`<div class="note-text">${Utils.escapeHtml(e.text)}</div>`}\n                ${o?`\n                <div class="note-audio">\n                  <audio controls preload="metadata" class="note-audio-player">\n                    <source src="${e.audio_url}" type="audio/mp4">\n                    <source src="${e.audio_url}" type="audio/webm">\n                    <source src="${e.audio_url}" type="audio/mpeg">\n                    Vas prohlizec nepodporuje prehravani audia.\n                  </audio>\n                </div>\n                `:""}\n              </div>\n            `}).join(""):'<div class="empty-notes">Zatim zadne poznamky</div>'}\n      </div>\n\n      <div class="note-input-area">\n        <textarea\n          class="note-textarea"\n          id="newNoteText"\n          placeholder="Napiste poznamku..."\n        ></textarea>\n        <div class="note-audio-controls">\n          <button type="button" class="btn-record" id="btnStartRecord" data-action="startRecording" data-id="${n.id}" title="Nahrat hlasovou zpravu">\n            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">\n              <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>\n              <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>\n            </svg>\n          </button>\n          <div class="recording-indicator" id="recordingIndicator" style="display: none;">\n            <span class="recording-dot"></span>\n            <span class="recording-time" id="recordingTime">0:00</span>\n            <button type="button" class="btn-stop-record" id="btnStopRecord" data-action="stopRecording" data-id="${n.id}">Stop</button>\n          </div>\n          <div class="audio-preview" id="audioPreview" style="display: none;">\n            <audio id="audioPreviewPlayer" controls></audio>\n            <button type="button" class="btn-delete-audio" id="btnDeleteAudio" data-action="deleteAudioPreview" title="Smazat nahravku">x</button>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    ${ModalManager.createActions(['<button class="btn btn-secondary" data-action="closeNotesModal">Zavrit</button>','<button class="btn btn-success" data-action="saveNewNote" data-id="'+n.id+'">Pridat poznamku</button>'])}\n  `;ModalManager.show(r),setTimeout(()=>{document.querySelectorAll(".note-audio-player").forEach(e=>{e.onerror=function(){logger.log("[Audio] Chyba pri nacitani ulozene nahravky");const t=e.closest(".note-audio");t&&(t.innerHTML='<span style="color: var(--c-grey); font-size: 0.75rem;">Audio nelze nacist</span>')}})},100),setTimeout(async()=>{await markNotesAsRead(n.id),await loadAll(ACTIVE_FILTER),window.WGSNotifikace&&window.WGSNotifikace.aktualizovat()},1e3)}async function saveNewNote(e){const n=document.getElementById("newNoteText").value.trim(),o=window.wgsAudioRecorder?window.wgsAudioRecorder.audioBlob:null;if(n||o)try{await addNote(e,n,o),window.wgsAudioRecorder&&(window.wgsAudioRecorder.audioBlob=null,window.wgsAudioRecorder.audioChunks=[]),closeNotesModal(),await loadAll(ACTIVE_FILTER),window.WGSNotifikace&&window.WGSNotifikace.aktualizovat()}catch(e){alert(t("note_save_error")+": "+e.message)}else alert(t("write_note_text"))}function closeNotesModal(){window.wgsAudioRecorder&&window.wgsAudioRecorder.isRecording&&stopRecording(),"function"==typeof releaseMicrophone&&releaseMicrophone(),closeDetail(),renderOrders()}async function checkMicrophonePermission(){try{if(navigator.permissions&&navigator.permissions.query){const e=await navigator.permissions.query({name:"microphone"});return logger.log("[Audio] Stav opravneni mikrofonu:",e.state),"granted"===e.state?(window.wgsAudioRecorder.permissionGranted=!0,"granted"):"denied"===e.state?"denied":"prompt"}}catch(e){logger.log("[Audio] Permissions API neni podporovano, zkusim primo")}return"unknown"}async function startRecording(e){logger.log("[Audio] Spoustim nahravani...");try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Vas prohlizec nepodporuje nahravani zvuku");const e=await checkMicrophonePermission();if("denied"===e)throw new Error("Pristup k mikrofonu byl trvale odepren. Povolte ho v nastaveni prohlizece.");if(!window.wgsAudioRecorder.permissionGranted&&"granted"!==e){localStorage.getItem("wgs_mic_explained")||(alert("Pro nahravani hlasovych poznamek potrebujeme pristup k mikrofonu. Po kliknuti na OK vas prohlizec pozada o povoleni."),localStorage.setItem("wgs_mic_explained","1"))}const t=await navigator.mediaDevices.getUserMedia({audio:!0});window.wgsAudioRecorder.stream=t,window.wgsAudioRecorder.permissionGranted=!0;const n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||/iPad|iPhone|iPod/.test(navigator.userAgent);let o="audio/webm";n?(MediaRecorder.isTypeSupported("audio/mp4")?o="audio/mp4":MediaRecorder.isTypeSupported("audio/aac")&&(o="audio/aac"),logger.log("[Audio] Safari detekovan, preferuji MP4")):MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?o="audio/webm;codecs=opus":MediaRecorder.isTypeSupported("audio/webm")?o="audio/webm":MediaRecorder.isTypeSupported("audio/mp4")?o="audio/mp4":MediaRecorder.isTypeSupported("audio/ogg")&&(o="audio/ogg"),logger.log("[Audio] Pouzivam format:",o);const a=window.wgsAudioRecorder;a.mimeType=o,a.mediaRecorder=new MediaRecorder(t,{mimeType:o}),a.audioChunks=[],a.isRecording=!0,a.recordingStartTime=Date.now(),a.mediaRecorder.ondataavailable=e=>{e.data.size>0&&(a.audioChunks.push(e.data),logger.log("[Audio] Data chunk:",e.data.size,"bytes"))},a.mediaRecorder.onstop=()=>{if(logger.log("[Audio] Nahravani ukonceno, chunks:",a.audioChunks.length),0===a.audioChunks.length)return logger.error("[Audio] Zadna data nebyla nahrana"),alert("Nahravka je prazdna. Zkuste to prosim znovu."),document.getElementById("btnStartRecord").style.display="block",void(document.getElementById("recordingIndicator").style.display="none");const e=a.mimeType||"audio/webm";a.audioBlob=new Blob(a.audioChunks,{type:e}),a.isRecording=!1,logger.log("[Audio] Blob vytvoren:",a.audioBlob.size,"bytes, type:",e),releaseMicrophone(),showAudioPreview(a.audioBlob)},a.mediaRecorder.start(1e3),document.getElementById("btnStartRecord").style.display="none",document.getElementById("recordingIndicator").style.display="flex",a.recordingTimer=setInterval(()=>{const e=Math.floor((Date.now()-a.recordingStartTime)/1e3),t=Math.floor(e/60),n=e%60;document.getElementById("recordingTime").textContent=`${t}:${n.toString().padStart(2,"0")}`},1e3),logger.log("[Audio] Nahravani spusteno")}catch(e){logger.error("[Audio] Chyba pri nahravani:",e),releaseMicrophone(),"NotAllowedError"===e.name||"PermissionDeniedError"===e.name?alert("Pristup k mikrofonu byl odepren. Povolte pristup v nastaveni prohlizece."):alert("Chyba pri nahravani: "+e.message)}}function stopRecording(){logger.log("[Audio] Zastavuji nahravani...");const e=window.wgsAudioRecorder;if(e.mediaRecorder&&e.isRecording){if("recording"===e.mediaRecorder.state)try{e.mediaRecorder.requestData()}catch(e){logger.log("[Audio] requestData neni podporovano:",e.message)}e.mediaRecorder.stop()}e.recordingTimer&&(clearInterval(e.recordingTimer),e.recordingTimer=null);const t=document.getElementById("recordingIndicator"),n=document.getElementById("btnStartRecord");t&&(t.style.display="none"),n&&(n.style.display="block")}function releaseMicrophone(){const e=window.wgsAudioRecorder;e.stream&&(e.stream.getTracks().forEach(e=>{e.stop(),logger.log("[Audio] Track zastaven:",e.kind)}),e.stream=null),e.mediaRecorder&&(e.mediaRecorder=null),e.isRecording=!1,e.audioChunks=[],logger.log("[Audio] Mikrofon a MediaRecorder uvolneny")}function showAudioPreview(e){const t=URL.createObjectURL(e),n=document.getElementById("audioPreviewPlayer"),o=document.getElementById("audioPreview");n.onerror=null,n.oncanplay=null;let a=!1;n.onerror=function(e){a||(a=!0,logger.log("[Audio] Chyba pri nacitani nahravky:",e),o.style.display="none",document.getElementById("btnStartRecord").style.display="block",n.src&&(URL.revokeObjectURL(n.src),n.src=""),logger.error("[Audio] Nahravka se nepodarila nacist"))},n.src=t,o.style.display="flex",logger.log("[Audio] Nahled zobrazen, velikost:",Math.round(e.size/1024),"KB")}function deleteAudioPreview(){const e=window.wgsAudioRecorder;e.audioBlob=null,e.audioChunks=[];const t=document.getElementById("audioPreviewPlayer"),n=document.getElementById("audioPreview");t.src&&(URL.revokeObjectURL(t.src),t.src=""),n.style.display="none",document.getElementById("btnStartRecord").style.display="block",logger.log("[Audio] Nahled smazan")}function formatDateTime(e){const t=new Date(e),n=new Date-t;if(n<6e4)return"Pr√°vƒõ teƒè";if(n<36e5){return`P≈ôed ${Math.floor(n/6e4)} min`}if(n<864e5){return`P≈ôed ${Math.floor(n/36e5)} h`}return t.toLocaleDateString("cs-CZ",{day:"numeric",month:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})}function getStatus(e){return{"ƒåEK√Å":{class:"wait",text:"NOV√Å"},wait:{class:"wait",text:"NOV√Å"},"DOMLUVEN√Å":{class:"open",text:"DOMLUVEN√Å"},open:{class:"open",text:"DOMLUVEN√Å"},HOTOVO:{class:"done",text:"HOTOVO"},done:{class:"done",text:"HOTOVO"}}[e]||{class:"wait",text:"NOV√Å"}}function formatDate(e){if(!e)return"‚Äî";const t=new Date(e);return isNaN(t)?e:t.toLocaleDateString("cs-CZ")}function formatAppointment(e,t){if(!e||!t)return"";const n=e.split(".");if(3!==n.length)return`${e} ${t}`;const o=parseInt(n[0]),a=parseInt(n[1]),i=parseInt(n[2]);return`${["ne","po","√∫t","st","ƒçt","p√°","so"][new Date(i,a-1,o).getDay()]} ${o}.${a}.-${t}`}function showDeleteConfirmModal(e){return new Promise(t=>{const n=document.createElement("div");n.style.cssText="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);z-index:10003;display:flex;align-items:center;justify-content:center;";const o=document.createElement("div");o.style.cssText="background:white;padding:30px;border-radius:8px;max-width:450px;width:90%;text-align:center;box-shadow:0 10px 40px rgba(0,0,0,0.5);",o.innerHTML=`\n      <h2 style="margin:0 0 20px 0;color:#666;font-size:1.3rem;font-weight:700;">Smazat reklamaci?</h2>\n      <p style="margin:0 0 15px 0;color:#555;line-height:1.6;font-size:1rem;">\n        Opravdu chcete <strong>TRVALE SMAZAT</strong> reklamaci<br>\n        <strong style="color:#666;font-size:1.1rem;">${e}</strong>?\n      </p>\n      <p style="margin:0 0 25px 0;color:#666;font-size:0.9rem;font-weight:600;">\n        Tato akce sma≈æe V≈†E vƒçetnƒõ fotek a PDF!<br>\n        Tuto akci NELZE vr√°tit zpƒõt!\n      </p>\n      <div style="display:flex;flex-direction:column;gap:12px;">\n        <button id="deleteConfirmYes" style="padding:14px 28px;background:#666;color:white;border:none;border-radius:6px;cursor:pointer;font-size:1rem;font-weight:700;">\n          Ano, pokraƒçovat ‚Üí\n        </button>\n        <button id="deleteConfirmNo" style="padding:14px 28px;background:#999;color:white;border:none;border-radius:6px;cursor:pointer;font-size:1rem;font-weight:600;">\n          Zru≈°it\n        </button>\n      </div>\n    `,n.appendChild(o),document.body.appendChild(n),document.getElementById("deleteConfirmNo").onclick=()=>{document.body.removeChild(n),t(!1)},document.getElementById("deleteConfirmYes").onclick=()=>{document.body.removeChild(n),t(!0)}})}function showDeleteInputModal(e){return new Promise(t=>{const n=document.createElement("div");n.style.cssText="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);z-index:10003;display:flex;align-items:center;justify-content:center;";const o=document.createElement("div");o.style.cssText="background:white;padding:30px;border-radius:8px;max-width:450px;width:90%;text-align:center;box-shadow:0 10px 40px rgba(0,0,0,0.5);",o.innerHTML=`\n      <h2 style="margin:0 0 20px 0;color:#666;font-size:1.3rem;font-weight:700;">Posledn√≠ ovƒõ≈ôen√≠</h2>\n      <p style="margin:0 0 15px 0;color:#555;line-height:1.6;font-size:1rem;">\n        Pro potvrzen√≠ smaz√°n√≠ zadejte p≈ôesnƒõ ƒç√≠slo reklamace:\n      </p>\n      <p style="margin:0 0 15px 0;color:#666;font-size:1.2rem;font-weight:700;">\n        ${e}\n      </p>\n      <input type="text" id="deleteInputField"\n             placeholder="Zadejte ƒç√≠slo reklamace"\n             style="width:100%;padding:12px;border:2px solid #666;border-radius:6px;font-size:1rem;text-align:center;margin-bottom:20px;">\n      <div style="display:flex;flex-direction:column;gap:12px;">\n        <button id="deleteInputConfirm" style="padding:14px 28px;background:#666;color:white;border:none;border-radius:6px;cursor:pointer;font-size:1rem;font-weight:700;">\n          SMAZAT NAV≈ΩDY\n        </button>\n        <button id="deleteInputCancel" style="padding:14px 28px;background:#999;color:white;border:none;border-radius:6px;cursor:pointer;font-size:1rem;font-weight:600;">\n          Zru≈°it\n        </button>\n      </div>\n    `,n.appendChild(o),document.body.appendChild(n);const a=document.getElementById("deleteInputField");a.focus(),document.getElementById("deleteInputCancel").onclick=()=>{document.body.removeChild(n),t("")},document.getElementById("deleteInputConfirm").onclick=()=>{const e=a.value.trim();document.body.removeChild(n),t(e)},a.addEventListener("keypress",e=>{if("Enter"===e.key){const e=a.value.trim();document.body.removeChild(n),t(e)}})})}async function deleteReklamace(e){logger.log("[deleteReklamace] Zobrazuji 1. confirmation modal");const n=CURRENT_RECORD.reklamace_id||CURRENT_RECORD.id||e;if(!await showDeleteConfirmModal(n))return void logger.log("Maz√°n√≠ zru≈°eno (1. krok)");if(await showDeleteInputModal(n)!==n){logger.log("Maz√°n√≠ zru≈°eno - ≈°patn√© ƒç√≠slo (2. krok)");const e=document.createElement("div");return e.style.cssText="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);z-index:10003;display:flex;align-items:center;justify-content:center;",e.innerHTML='\n      <div style="background:white;padding:30px;border-radius:8px;max-width:400px;width:90%;text-align:center;">\n        <h2 style="margin:0 0 20px 0;color:#666;">Nespr√°vn√© ƒç√≠slo!</h2>\n        <p style="margin:0 0 25px 0;color:#555;">Zadali jste nespr√°vn√© ƒç√≠slo reklamace.<br>Maz√°n√≠ bylo zru≈°eno.</p>\n        <button onclick="this.closest(\'div\').parentElement.remove()" style="padding:12px 24px;background:#999;color:white;border:none;border-radius:6px;cursor:pointer;font-weight:600;">\n          OK\n        </button>\n      </div>\n    ',void document.body.appendChild(e)}logger.log("üóëÔ∏è Maz√°n√≠ reklamace:",e);try{const n=await getCSRFToken(),o=await fetch("api/delete_reklamace.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reklamace_id:e,csrf_token:n})}),a=await o.json();if(!o.ok)throw new Error(`HTTP ${o.status}: ${a.message||a.error||o.statusText}`);if(a.success||"success"===a.status)logger.log("Smaz√°no!"),alert(t("claim_deleted_successfully")),closeDetail(),setTimeout(()=>location.reload(),500);else{const e=a.message||a.error||t("delete_failed");logger.error("Chyba:",e),alert(t("error")+": "+e)}}catch(e){logger.error("Chyba p≈ôi maz√°n√≠:",e),alert(t("delete_error")+": "+e.message)}}async function smazatFotku(e,t){return logger.log("[smazatFotku] Vytv√°≈ô√≠m confirmation modal pro ID:",e),new Promise(n=>{const o=document.createElement("div");o.id="deleteFotoModal",o.style.cssText="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);z-index:10003;display:flex;align-items:center;justify-content:center;";const a=document.createElement("div");a.style.cssText="background:white;padding:30px;border-radius:8px;max-width:400px;width:90%;text-align:center;box-shadow:0 10px 40px rgba(0,0,0,0.5);",a.innerHTML='\n      <h2 style="margin:0 0 20px 0;color:#333;font-size:1.2rem;font-weight:700;">Smazat fotku?</h2>\n      <p style="margin:0 0 25px 0;color:#555;line-height:1.6;font-size:1rem;">\n        Opravdu chcete smazat tuto fotografii?<br><br>\n        <strong>Tato akce je nevratn√°!</strong>\n      </p>\n      <div style="display:flex;flex-direction:column;gap:12px;">\n        <button id="deleteFotoYes" style="padding:14px 28px;background:#666;color:white;border:none;border-radius:6px;cursor:pointer;font-size:1rem;font-weight:700;">\n          Ano, smazat\n        </button>\n        <button id="deleteFotoNo" style="padding:14px 28px;background:#999;color:white;border:none;border-radius:6px;cursor:pointer;font-size:1rem;font-weight:600;">\n          Zru≈°it\n        </button>\n      </div>\n    ',o.appendChild(a),document.body.appendChild(o),document.getElementById("deleteFotoNo").onclick=()=>{logger.log("[smazatFotku] U≈æivatel zru≈°il"),document.body.removeChild(o),n(!1)},document.getElementById("deleteFotoYes").onclick=async()=>{logger.log("[smazatFotku] U≈æivatel potvrdil, maz√°m..."),document.body.removeChild(o),await pokracovatSmazaniFotky(e,t),n(!0)}})}async function pokracovatSmazaniFotky(e,n){logger.log("üóëÔ∏è Maz√°n√≠ fotky ID:",e);try{const o=await getCSRFToken(),a=new FormData;a.append("photo_id",e),a.append("csrf_token",o);const i=await fetch("api/delete_photo.php",{method:"POST",body:a}),r=await i.json();if(!i.ok)throw new Error(`HTTP ${i.status}: ${r.message||r.error||i.statusText}`);if("success"===r.status){logger.log("Fotka smaz√°na!");const e=document.querySelectorAll(".foto-wrapper img");for(const t of e)if(t.src.includes(n.replace(/\\/g,""))){t.closest(".foto-wrapper").remove();break}const o=document.querySelector('[style*="Fotografie"]');if(o){const e=document.querySelectorAll(".foto-wrapper").length;if(o.textContent=`Fotografie (${e})`,0===e){const e=o.closest("div").querySelector('[style*="grid"]');e&&(e.innerHTML=`<p style="color: var(--c-grey); text-align: center; padding: 1rem; font-size: 0.9rem;">${t("no_photos")}</p>`)}}alert(t("photo_deleted_successfully"))}else{const e=r.message||r.error||t("delete_failed");logger.error("Chyba:",e),alert(t("error")+": "+e)}}catch(e){logger.error("Chyba p≈ôi maz√°n√≠ fotky:",e),alert(t("photo_delete_error")+": "+e.message)}}async function loadPhotosFromDB(e){try{const t=await fetch(`api/get_photos_api.php?reklamace_id=${e}`);if(!t.ok)return[];const n=await t.json();return n.success&&n.photos?n.photos.map(e=>({id:e.id,photo_path:e.photo_path,section_name:e.section_name})):[]}catch(e){return logger.error("Chyba naƒç√≠t√°n√≠ fotek:",e),[]}}async function loadMoreOrders(){if(LOADING_MORE||!HAS_MORE_PAGES)return;LOADING_MORE=!0;const e=document.getElementById("loadMoreBtn");e&&(e.disabled=!0,e.textContent=t("loading")),await loadAll(ACTIVE_FILTER,!0)}function updateLoadMoreButton(){let e=document.getElementById("loadMoreBtn");if(!e){const n=document.getElementById("orderGrid");n&&n.parentElement&&(e=document.createElement("button"),e.id="loadMoreBtn",e.className="load-more-btn",e.textContent=t("load_more_orders"),e.onclick=loadMoreOrders,n.parentElement.appendChild(e))}e&&(e.style.display=HAS_MORE_PAGES?"block":"none",e.disabled=LOADING_MORE,e.textContent=LOADING_MORE?t("loading"):t("load_more_page").replace("{page}",CURRENT_PAGE+1))}async function sendContactAttemptEmail(e,t){try{if(!WGS_DATA_CACHE.find(t=>t.id==e||t.reklamace_id==e))return void showToast("Z√°znam nenalezen","error");showLoading("Odes√≠l√°m email z√°kazn√≠kovi... Pros√≠m ƒçekejte");const n=await getCSRFToken(),o=await fetch("/api/send_contact_attempt_email.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reklamace_id:e,csrf_token:n})}),a=await o.json();if(hideLoading(),a.success){logger.log("Email o pokusu o kontakt odesl√°n z√°kazn√≠kovi"),closeDetail(),showToast("Email odesl√°n z√°kazn√≠kovi","success");const e=a.sms_text||"Dobr√Ω den, pokusili jsme se V√°s kontaktovat. Zavolejte pros√≠m zpƒõt na +420 725 965 826. Dƒõkujeme, WGS Service";setTimeout(()=>{const n=encodeURIComponent(e);window.location.href=`sms:${t}?body=${n}`},2e3)}else logger.error("‚ö† Chyba p≈ôi odes√≠l√°n√≠ emailu:",a.error||a.message),showToast(a.error||"Chyba p≈ôi odes√≠l√°n√≠ emailu","error")}catch(e){logger.error("Chyba p≈ôi odes√≠l√°n√≠ kontaktn√≠ho emailu:",e),showToast("Nepoda≈ôilo se odeslat email","error"),hideLoading()}}async function zobrazVideotekaArchiv(e){logger.log(`[Videot√©ka] Otev√≠r√°m archiv pro zak√°zku ID: ${e}`);if(document.getElementById("videotekaOverlay"))return void logger.log("[Videot√©ka] Overlay u≈æ existuje, ignoruji");const t=document.createElement("div");t.id="videotekaOverlay",t.style.cssText="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 10004; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 1rem;";const n=document.createElement("div");n.style.cssText="width: 95%; max-width: 900px; height: 90%; background: #222; border-radius: 8px; overflow: hidden; display: flex; flex-direction: column;";const o=window.innerWidth<600,a=document.createElement("div");a.style.cssText=o?"padding: 12px 16px; background: #333; color: white; font-weight: 600; display: flex; flex-direction: column; align-items: center; text-align: center; gap: 2px; border-bottom: 2px solid #444;":"padding: 16px 20px; background: #333; color: white; font-weight: 600; font-size: 1rem; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #444;",a.innerHTML="<span>Naƒç√≠t√°n√≠...</span>";const i=document.createElement("div");i.id="videotekaContent",i.style.cssText="flex: 1; overflow-y: auto; padding: 16px; background: #1a1a1a; display: flex; flex-direction: column; gap: 12px; align-content: start; position: relative; transition: background 0.2s ease;";const r=document.createElement("div");r.id="videotekaDropOverlay",r.style.cssText="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(45, 80, 22, 0.3); border: 3px dashed #2D5016; display: none; align-items: center; justify-content: center; z-index: 10; pointer-events: none;",r.innerHTML='<div style="color: white; font-size: 1.2rem; font-weight: 600; text-align: center; padding: 2rem;">Pus≈•te video pro nahr√°n√≠</div>';let d=0;i.addEventListener("dragenter",e=>{e.preventDefault(),e.stopPropagation(),d++,r.style.display="flex",i.style.background="#252525"}),i.addEventListener("dragleave",e=>{e.preventDefault(),e.stopPropagation(),d--,0===d&&(r.style.display="none",i.style.background="#1a1a1a")}),i.addEventListener("dragover",e=>{e.preventDefault(),e.stopPropagation()}),i.addEventListener("drop",async n=>{n.preventDefault(),n.stopPropagation(),d=0,r.style.display="none",i.style.background="#1a1a1a";const o=n.dataTransfer.files;if(o.length>0){const n=o[0];n.type.startsWith("video/")?(logger.log(`[Videot√©ka] Drag & drop: ${n.name} (${(n.size/1024/1024).toFixed(2)} MB)`),await nahratVideoDragDrop(n,e,t)):showToast("Lze nahr√°t pouze video soubory","error")}});try{const t=await fetch(`/api/video_api.php?action=list_videos&claim_id=${e}`),n=await t.json();if("success"===n.status){const t=n.customer_name||"Nezn√°m√Ω z√°kazn√≠k",r=n.reklamace_cislo||e;if(a.innerHTML=o?`\n          <span style="font-size: 0.95rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%;">${t}</span>\n          <span style="font-size: 0.75rem; opacity: 0.6;">${r}</span>\n        `:`<span>${t}</span><span style="font-size: 0.85rem; opacity: 0.7;">${r}</span>`,n.videos&&n.videos.length>0)n.videos.forEach(t=>{const n=vytvorVideoKartu(t,e);i.appendChild(n)});else{i.style.display="flex",i.style.alignItems="center",i.style.justifyContent="center";const e=document.createElement("div");e.style.cssText="text-align: center; padding: 3rem; color: #999;",e.innerHTML='\n          <div style="font-size: 0.85rem; opacity: 0.7; margin-bottom: 1rem;">≈Ω√°dn√° videa v archivu</div>\n          <div style="font-size: 1.05rem; font-weight: 500; margin-bottom: 0.5rem;">P≈ôet√°hnƒõte video sem</div>\n          <div style="font-size: 0.85rem; opacity: 0.7;">nebo pou≈æijte tlaƒç√≠tko n√≠≈æe</div>\n        ',i.appendChild(e)}}}catch(e){logger.error("[Videot√©ka] Chyba p≈ôi naƒç√≠t√°n√≠ vide√≠:",e),a.innerHTML="<span>Chyba</span>",i.innerHTML=`\n      <div style="text-align: center; padding: 3rem; color: #f44;">\n        <div style="font-size: 1rem; margin-bottom: 0.5rem;">Chyba p≈ôi naƒç√≠t√°n√≠ vide√≠</div>\n        <div style="font-size: 0.85rem; opacity: 0.7;">${e.message}</div>\n      </div>\n    `}const s=document.createElement("div");s.style.cssText="padding: 16px 20px; background: #333; border-top: 2px solid #444; display: flex; gap: 12px; flex-wrap: wrap; justify-content: center;";const l=document.createElement("button");l.textContent="Nahr√°t video",l.style.cssText="padding: 12px 24px; font-size: 0.95rem; font-weight: 600; background: #2D5016; color: white; border: none; border-radius: 6px; cursor: pointer; min-width: 140px; touch-action: manipulation;",l.onclick=()=>otevritNahravaniVidea(e,t);const c=document.createElement("button");c.textContent="Zav≈ô√≠t",c.style.cssText="padding: 12px 24px; font-size: 0.95rem; font-weight: 600; background: #666; color: white; border: none; border-radius: 6px; cursor: pointer; min-width: 140px; touch-action: manipulation;",c.onclick=()=>t.remove(),s.appendChild(l),s.appendChild(c),i.appendChild(r),n.appendChild(a),n.appendChild(i),n.appendChild(s),t.appendChild(n),t.onclick=e=>{e.target===t&&t.remove()};const p=e=>{"Escape"===e.key&&(t.remove(),document.removeEventListener("keydown",p))};document.addEventListener("keydown",p),document.body.appendChild(t)}function generujNahledVidea(e,t,n){return new Promise(o=>{const a=document.createElement("video");a.crossOrigin="anonymous",a.muted=!0,a.preload="metadata";const i=setTimeout(()=>{a.src="",o(null)},5e3);a.onloadedmetadata=()=>{const e=Math.min(1,.1*a.duration);a.currentTime=e},a.onseeked=()=>{clearTimeout(i);try{const e=document.createElement("canvas");e.width=2*t,e.height=2*n;e.getContext("2d").drawImage(a,0,0,e.width,e.height);const i=e.toDataURL("image/jpeg",.7);a.src="",o(i)}catch(e){a.src="",o(null)}},a.onerror=()=>{clearTimeout(i),o(null)},a.src=e})}function vytvorVideoKartu(e,t){const n=window.innerWidth<600,o=document.createElement("div");o.style.cssText=`\n    background: #2a2a2a;\n    border-radius: 6px;\n    padding: ${n?"8px":"12px"};\n    display: flex;\n    flex-direction: row;\n    align-items: flex-start;\n    gap: ${n?"8px":"12px"};\n    border: 1px solid #444;\n    width: 100%;\n    box-sizing: border-box;\n  `;const a=document.createElement("div"),i=n?100:120,r=n?60:68;a.style.cssText=`\n    flex-shrink: 0;\n    width: ${i}px;\n    height: ${r}px;\n    background: #1a1a1a;\n    border-radius: 4px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    border: 1px solid #555;\n    cursor: pointer;\n    overflow: hidden;\n    position: relative;\n  `,a.innerHTML=`<span style="font-size: ${n?"1.5rem":"2rem"}; opacity: 0.5; color: #fff;">‚ñ∂</span>`,a.onclick=()=>prehratVideo(e.video_path,e.video_name),generujNahledVidea(e.video_path,i,r).then(e=>{e&&(a.innerHTML=`\n        <img src="${e}" style="width: 100%; height: 100%; object-fit: cover;">\n        <span style="position: absolute; font-size: ${n?"1.2rem":"1.5rem"}; color: #fff; text-shadow: 0 1px 3px rgba(0,0,0,0.8); opacity: 0.9;">‚ñ∂</span>\n      `)}).catch(()=>{});const d=document.createElement("div");d.style.cssText="flex: 1; display: flex; flex-direction: column; justify-content: center; gap: 2px; min-width: 0;",d.title=e.video_name;const s=document.createElement("div");if(s.style.cssText=`font-weight: 500; font-size: ${n?"0.7rem":"0.9rem"}; color: ${n?"#aaa":"#fff"};`,e.uploader_email){const t=e.uploader_email.split("@")[0];s.textContent=t,s.title=e.uploader_email}else s.textContent="Admin",s.style.color="#888";const l=document.createElement("div");l.style.cssText=`display: flex; gap: ${n?"6px":"8px"}; flex-wrap: wrap; align-items: center;`;const c=document.createElement("span");c.style.cssText=`font-size: ${n?"0.6rem":"0.7rem"}; color: #666;`,c.textContent=`${(e.file_size/1024/1024).toFixed(1)} MB`;const p=document.createElement("span");p.style.cssText=`font-size: ${n?"0.6rem":"0.7rem"}; color: #666;`;const m=e.uploaded_at?new Date(e.uploaded_at).toLocaleString("cs-CZ",n?{day:"2-digit",month:"2-digit"}:{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"‚Äî";p.textContent=m,l.appendChild(c),l.appendChild(p),d.appendChild(s),d.appendChild(l);const u=document.createElement("div");u.style.cssText=n?`display: flex; flex-direction: column; gap: 4px; flex-shrink: 0; height: ${r}px; max-height: ${r}px; overflow: hidden; box-sizing: border-box;`:"display: flex; flex-direction: row; align-items: center; gap: 6px; flex-shrink: 0;";const g="height: 28px !important; min-height: 28px !important; max-height: 28px !important; width: 36px; padding: 0; margin: 0; border-radius: 3px; cursor: pointer; touch-action: manipulation; display: flex; align-items: center; justify-content: center; border: 1px solid #555; box-sizing: border-box;",h=document.createElement("button");n?(h.innerHTML='<i class="fas fa-download"></i>',h.title="St√°hnout video",h.style.cssText=g+" background: #444; color: #ccc; font-size: 0.75rem;"):(h.textContent="St√°hnout",h.style.cssText="min-height: 36px; padding: 0.4rem 0.8rem; font-size: 0.8rem; border: 1px solid #555; border-radius: 4px; cursor: pointer; touch-action: manipulation; white-space: nowrap; background: #444; color: white;"),h.onclick=()=>{const t=document.createElement("a");t.href=e.video_path,t.download=e.video_name||"video.mp4",t.click()};const y=document.createElement("button");return y.innerHTML="&#10005;",y.title="Smazat video",y.style.cssText=n?g+" background: #442222; color: #c66; font-size: 0.85rem; font-weight: bold;":"min-height: 36px; width: 36px; padding: 0; font-size: 1.1rem; font-weight: bold; background: #553333; color: #c66; border: 1px solid #664444; border-radius: 4px; cursor: pointer; touch-action: manipulation; display: flex; align-items: center; justify-content: center;",y.onclick=async()=>{if(confirm(`Opravdu smazat video "${e.video_name}"?`))try{const t=new FormData;t.append("action","delete_video"),t.append("video_id",e.id),t.append("csrf_token",document.querySelector('input[name="csrf_token"]')?.value||"");const n=await fetch("/api/video_api.php",{method:"POST",body:t}),a=await n.json();if("success"!==a.status)throw new Error(a.message||"Chyba p≈ôi maz√°n√≠");showToast("Video bylo smaz√°no","success"),o.remove()}catch(e){logger.error("[Videot√©ka] Chyba p≈ôi maz√°n√≠ videa:",e),showToast("Chyba p≈ôi maz√°n√≠ videa: "+e.message,"error")}},u.appendChild(h),u.appendChild(y),o.appendChild(a),o.appendChild(d),o.appendChild(u),o}function prehratVideo(e,t){const n=document.createElement("div");n.style.cssText="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 10005; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 1rem;";const o=document.createElement("video");o.src=e,o.controls=!0,o.autoplay=!0,o.style.cssText="max-width: 95%; max-height: 85vh; border-radius: 8px;";const a=document.createElement("div");a.style.cssText="color: white; font-size: 1rem; margin-top: 16px; text-align: center;",a.textContent=t||"Video";const i=document.createElement("button");i.textContent="Zav≈ô√≠t",i.style.cssText="margin-top: 16px; padding: 10px 24px; background: #666; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem;",i.onclick=()=>{o.pause(),n.remove()},n.appendChild(o),n.appendChild(a),n.appendChild(i),n.onclick=e=>{e.target===n&&(o.pause(),n.remove())};const r=e=>{"Escape"===e.key&&(o.pause(),n.remove(),document.removeEventListener("keydown",r))};document.addEventListener("keydown",r),document.body.appendChild(n)}function otevritNahravaniVidea(e,t){logger.log(`[Videot√©ka] Otev√≠r√°m upload pro zak√°zku ID: ${e}`);const n=document.createElement("div");n.style.cssText="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 10006; display: flex; align-items: center; justify-content: center; padding: 1rem;";const o=document.createElement("div");o.style.cssText="background: #2a2a2a; border-radius: 8px; padding: 24px; max-width: 500px; width: 100%; border: 2px solid #444;";const a=document.createElement("h3");a.style.cssText="color: white; margin: 0 0 20px 0; font-size: 1.1rem;",a.textContent="Nahr√°t video";const i=document.createElement("input");i.type="file",i.id="video",i.name="video",i.accept="video/*",i.style.cssText="display: block; width: 100%; padding: 12px; background: #1a1a1a; color: white; border: 1px solid #555; border-radius: 4px; margin-bottom: 16px; font-size: 0.9rem;";const r=document.createElement("div");r.style.cssText="background: #1a1a1a; padding: 12px; border-radius: 4px; margin-bottom: 16px; color: #999; font-size: 0.85rem; border: 1px solid #555;",r.innerHTML='\n    <div style="margin-bottom: 6px;">‚ÑπÔ∏è <strong>Informace o nahr√°v√°n√≠:</strong></div>\n    <div style="margin-left: 24px;">\n      <div>‚Ä¢ Maxim√°ln√≠ velikost: 500 MB</div>\n      <div>‚Ä¢ Podporovan√© form√°ty: MP4, MOV, AVI, WebM</div>\n      <div>‚Ä¢ Video nad 500 MB bude automaticky komprimov√°no</div>\n    </div>\n  ';const d=document.createElement("div");d.style.cssText="display: none; margin-bottom: 16px;";const s=document.createElement("div");s.style.cssText="width: 100%; height: 24px; background: #1a1a1a; border-radius: 4px; overflow: hidden; border: 1px solid #555;";const l=document.createElement("div");l.style.cssText="height: 100%; background: #2D5016; width: 0%; transition: width 0.3s ease; display: flex; align-items: center; justify-content: center; color: white; font-size: 0.8rem; font-weight: 600;",s.appendChild(l),d.appendChild(s);const c=document.createElement("div");c.style.cssText="text-align: center; color: #999; font-size: 0.85rem; margin-top: 8px; display: none;",d.appendChild(c);const p=document.createElement("div");p.style.cssText="display: flex; gap: 12px; justify-content: flex-end;";const m=document.createElement("button");m.textContent="Zru≈°it",m.style.cssText="padding: 10px 20px; background: #666; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.9rem;",m.onclick=()=>n.remove();const u=document.createElement("button");u.textContent="Nahr√°t",u.style.cssText="padding: 10px 20px; background: #2D5016; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.9rem; font-weight: 600;",u.onclick=async()=>{const o=i.files[0];if(!o)return void alert("Vyberte video soubor");const a=o.size>524288e3;u.disabled=!0,m.disabled=!0,d.style.display="block",c.style.display="block";try{let i=o;if(a){c.textContent="Komprimuji video...",l.style.width="10%",l.textContent="10%";try{if("undefined"==typeof MediaRecorder)throw new Error("MediaRecorder nen√≠ podporov√°n");i=await komprimovatVideo(o,e=>{const t=Math.round(10+40*e);l.style.width=t+"%",l.textContent=t+"%"}),logger.log(`[Videot√©ka] Video komprimov√°no: ${o.size} ‚Üí ${i.size} byt≈Ø`)}catch(e){if(logger.warn(`[Videot√©ka] Komprese selhala, pou≈æ√≠v√°m origin√°l: ${e.message}`),i=o,c.textContent="Komprese nedostupn√°, nahr√°v√°m origin√°l...",o.size>524288e3)throw showToast("Video je p≈ô√≠li≈° velk√© (max 500 MB). Komprese selhala.","error"),new Error("Video p≈ô√≠li≈° velk√© a komprese nen√≠ dostupn√°")}}c.textContent="Nahr√°v√°m video...",l.style.width="50%",l.textContent="50%";const r=new FormData;r.append("action","upload_video"),r.append("claim_id",e),r.append("video",i,i.name||o.name),r.append("csrf_token",document.querySelector('input[name="csrf_token"]')?.value||"");const d=await fetch("/api/video_api.php",{method:"POST",body:r});l.style.width="90%",l.textContent="90%";const s=await d.json();if("success"!==s.status)throw new Error(s.message||"Chyba p≈ôi nahr√°v√°n√≠");l.style.width="100%",l.textContent="100%",c.textContent="Hotovo!",l.style.background="#2D5016",showToast("Video bylo √∫spƒõ≈°nƒõ nahr√°no","success"),setTimeout(()=>{n.remove(),t.remove(),zobrazVideotekaArchiv(e)},1e3)}catch(e){logger.error("[Videot√©ka] Chyba p≈ôi uploadu:",e),l.style.background="#c33",c.textContent="Chyba: "+e.message,u.disabled=!1,m.disabled=!1,showToast("Chyba p≈ôi nahr√°v√°n√≠ videa: "+e.message,"error")}},p.appendChild(m),p.appendChild(u),o.appendChild(a),o.appendChild(r),o.appendChild(i),o.appendChild(d),o.appendChild(p),n.appendChild(o);const g=e=>{"Escape"!==e.key||u.disabled||(n.remove(),document.removeEventListener("keydown",g))};document.addEventListener("keydown",g),document.body.appendChild(n)}async function nahratVideoDragDrop(e,t,n){logger.log(`[Videot√©ka] Zahajuji drag & drop upload: ${e.name}`);const o=document.createElement("div");o.style.cssText="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 10007; display: flex; align-items: center; justify-content: center; padding: 1rem;";const a=document.createElement("div");a.style.cssText="background: #2a2a2a; border-radius: 8px; padding: 24px; max-width: 400px; width: 100%; border: 2px solid #444; text-align: center;";const i=document.createElement("div");i.style.cssText="color: white; font-size: 1rem; font-weight: 600; margin-bottom: 16px;",i.textContent="Nahr√°v√°n√≠ videa...";const r=document.createElement("div");r.style.cssText="width: 100%; height: 24px; background: #1a1a1a; border-radius: 4px; overflow: hidden; border: 1px solid #555;";const d=document.createElement("div");d.style.cssText="height: 100%; background: #2D5016; width: 0%; transition: width 0.3s ease; display: flex; align-items: center; justify-content: center; color: white; font-size: 0.8rem; font-weight: 600;",d.textContent="0%";const s=document.createElement("div");s.style.cssText="color: #999; font-size: 0.85rem; margin-top: 12px;",s.textContent=e.name,r.appendChild(d),a.appendChild(i),a.appendChild(r),a.appendChild(s),o.appendChild(a),document.body.appendChild(o);try{const a=524288e3;let i=e;e.size>a&&(s.textContent="Komprimuji video...",d.style.width="10%",d.textContent="10%",i=await komprimovatVideo(e,e=>{const t=Math.round(10+40*e);d.style.width=t+"%",d.textContent=t+"%"}),logger.log(`[Videot√©ka] Video komprimov√°no: ${e.size} ‚Üí ${i.size} byt≈Ø`)),s.textContent="Odes√≠l√°m na server...",d.style.width="50%",d.textContent="50%";const r=new FormData;r.append("action","upload_video"),r.append("claim_id",t),r.append("video",i,i.name||e.name),r.append("csrf_token",document.querySelector('input[name="csrf_token"]')?.value||"");const l=await fetch("/api/video_api.php",{method:"POST",body:r});d.style.width="90%",d.textContent="90%";const c=await l.json();if("success"!==c.status)throw new Error(c.message||"Chyba p≈ôi nahr√°v√°n√≠");d.style.width="100%",d.textContent="100%",s.textContent="Hotovo!",d.style.background="#2D5016",showToast("Video bylo √∫spƒõ≈°nƒõ nahr√°no","success"),setTimeout(()=>{o.remove(),n.remove(),zobrazVideotekaArchiv(t)},1e3)}catch(e){logger.error("[Videot√©ka] Chyba p≈ôi drag & drop uploadu:",e),d.style.background="#c33",d.style.width="100%",s.textContent="Chyba: "+e.message,showToast("Chyba p≈ôi nahr√°v√°n√≠ videa: "+e.message,"error"),setTimeout(()=>{o.remove()},3e3)}}async function komprimovatVideo(e,t){return new Promise((n,o)=>{try{const a=document.createElement("video");a.preload="metadata",a.muted=!0,a.playsInline=!0,a.onloadedmetadata=()=>{const i=a.videoWidth,r=a.videoHeight;let d=i,s=r;if(i>1920||r>1080){const e=Math.min(1920/i,1080/r);d=Math.round(i*e),s=Math.round(r*e)}const l=document.createElement("canvas");l.width=d,l.height=s;const c=l.getContext("2d"),p=l.captureStream(30),m=["video/webm;codecs=vp9","video/webm;codecs=vp8","video/webm","video/mp4"];let u="";for(const e of m)if(MediaRecorder.isTypeSupported(e)){u=e;break}if(!u)return void o(new Error("≈Ω√°dn√Ω video kodek nen√≠ podporov√°n"));logger.log(`[Videot√©ka] Pou≈æ√≠v√°m kodek: ${u}`);const g={mimeType:u,videoBitsPerSecond:25e5};let h;try{h=new MediaRecorder(p,g)}catch(e){h=new MediaRecorder(p,{mimeType:u})}const y=[];h.ondataavailable=e=>{e.data.size>0&&y.push(e.data)},h.onstop=()=>{const t=new Blob(y,{type:u}),o=u.includes("mp4")?"mp4":"webm";t.name=e.name.replace(/\.[^.]+$/,"")+"_compressed."+o,n(t)},h.onerror=e=>{o(new Error("Chyba p≈ôi kompresi videa: "+(e.error?.message||"nezn√°m√°")))},h.start(1e3),a.play().catch(e=>{o(new Error("Nelze p≈ôehr√°t video pro kompresi: "+e.message))});const f=()=>{if(a.paused||a.ended)setTimeout(()=>h.stop(),100);else{if(c.drawImage(a,0,0,d,s),t){const e=a.currentTime/a.duration;t(e)}requestAnimationFrame(f)}};a.onplay=()=>{f()},a.onerror=()=>{o(new Error("Chyba p≈ôi naƒç√≠t√°n√≠ videa pro kompresi"))}},a.onerror=()=>{o(new Error("Video soubor nelze naƒç√≠st"))},a.src=URL.createObjectURL(e)}catch(e){o(e)}})}window.wgsAudioRecorder={mediaRecorder:null,audioChunks:[],audioBlob:null,isRecording:!1,recordingStartTime:null,recordingTimer:null,permissionGranted:!1,stream:null},document.addEventListener("DOMContentLoaded",()=>{document.addEventListener("click",e=>{const t=e.target.closest("[data-navigate]")?.getAttribute("data-navigate");t&&("function"==typeof navigateTo?navigateTo(t):location.href=t)}),document.addEventListener("change",e=>{const t=e.target.closest("[data-onchange]");if(!t)return;const n=t.getAttribute("data-onchange"),o=t.getAttribute("data-onchange-value")||t.value;"function"==typeof window[n]&&window[n](o)})}),document.addEventListener("click",e=>{const t=e.target.closest("[data-action]");if(!t)return;const n=t.getAttribute("data-action"),o=t.getAttribute("data-id"),a=t.getAttribute("data-url");switch(logger.log(`[Seznam] Tlaƒç√≠tko kliknuto: ${n}`,{id:o,url:a}),n){case"reopenOrder":o&&reopenOrder(o);break;case"showContactMenu":o&&showContactMenu(o);break;case"showCustomerDetail":o&&showCustomerDetail(o);break;case"showDetail":CURRENT_RECORD&&showDetail(CURRENT_RECORD);break;case"openPDF":a&&zobrazPDFModal(a,o);break;case"showHistoryPDF":const i=t.getAttribute("data-original-id");i&&showHistoryPDF(i);break;case"showPhotoFullscreen":a&&showPhotoFullscreen(a);break;case"smazatFotku":const r=t.getAttribute("data-photo-id");r&&a&&(e.stopPropagation(),smazatFotku(r,a));break;case"deleteReklamace":o&&deleteReklamace(o);break;case"saveAllCustomerData":o&&saveAllCustomerData(o);break;case"closeDetail":closeDetail();break;case"showNotes":o&&"function"==typeof showNotes&&(e.stopPropagation(),showNotes(o));break;case"filterUnreadNotes":"function"==typeof filterUnreadNotes&&filterUnreadNotes();break;case"closeNotesModal":"function"==typeof closeNotesModal&&closeNotesModal();break;case"saveNewNote":o&&"function"==typeof saveNewNote&&saveNewNote(o);break;case"deleteNote":const d=t.getAttribute("data-note-id"),s=t.getAttribute("data-order-id");d&&"function"==typeof deleteNote&&(e.stopPropagation(),deleteNote(d,s));break;case"startRecording":o&&"function"==typeof startRecording&&(e.stopPropagation(),startRecording(o));break;case"stopRecording":"function"==typeof stopRecording&&(e.stopPropagation(),stopRecording());break;case"deleteAudioPreview":"function"==typeof deleteAudioPreview&&(e.stopPropagation(),deleteAudioPreview());break;case"showVideoteka":o&&"function"==typeof zobrazVideotekaArchiv&&(e.stopPropagation(),zobrazVideotekaArchiv(o));break;default:logger.warn(`[Seznam] Nezn√°m√° akce: ${n}`)}});