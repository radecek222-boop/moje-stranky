!function(){"use strict";let e=[],t=null;function n(e,t){if(!e)return e;const n=`pricing.${t}.${e}`,i=window.t?window.t(n):null;return i&&i!==n?i:e}async function i(){try{const t=await fetch("/api/pricing_api.php?action=list"),n=await t.json();"success"===n.status?(e=n.by_category,o(n.by_category)):(console.error("[Ceník] Chyba:",n.message),document.getElementById("loading-indicator").innerHTML=`<p style="color: red;">${window.t("pricingGrid.loading.error")}</p>`)}catch(e){console.error("[Ceník] Síťová chyba:",e),document.getElementById("loading-indicator").innerHTML=`<p style="color: red;">${window.t("pricingGrid.loading.networkError")}</p>`}}function o(e){const t=document.getElementById("pricing-grid");document.getElementById("loading-indicator").style.display="none",t.style.display="grid",t.innerHTML="";Object.keys(e).sort().forEach(i=>{const o=e[i],a=document.createElement("div");a.className="pricing-category";const r=document.createElement("div");r.className="category-header";const d=window.ziskejAktualniJazyk?window.ziskejAktualniJazyk():"cs",c=o[0];let l=i;c&&("en"===d&&c.category_en?l=c.category_en:"it"===d&&c.category_it&&(l=c.category_it)),r.textContent=l;const s=document.createElement("div");s.className="category-items",o.forEach(e=>{const t=function(e){const t=document.createElement("div");t.className="pricing-item",t.dataset.id=e.id;const i=window.ziskejAktualniJazyk?window.ziskejAktualniJazyk():"cs",o=document.createElement("div");o.className="item-header";const a=document.createElement("div");if(a.className="item-name","cs"===i)a.textContent=e.service_name||"";else if("en"===i){let t=e.service_name_en;t&&t!==e.service_name||(t=n(e.service_name,"service")),a.textContent=t||e.service_name||""}else if("it"===i){let t=e.service_name_it;t&&t!==e.service_name||(t=n(e.service_name,"service")),a.textContent=t||e.service_name||""}const r=document.createElement("div");r.className="item-price";const d={cs:"Od",en:"From",it:"Da"};e.price_from&&e.price_to?r.innerHTML=`${e.price_from} - ${e.price_to} ${e.price_unit}`:e.price_from?(r.className+=" range",r.innerHTML=`${d[i]||"Od"} ${e.price_from} ${e.price_unit}`):e.price_to&&(r.innerHTML=`${e.price_to} ${e.price_unit}`);o.appendChild(a),o.appendChild(r),t.appendChild(o);let c="";if("cs"===i)c=e.description||"";else if("en"===i){let t=e.description_en;t&&t!==e.description||(t=n(e.description,"desc")),c=t||e.description||""}else if("it"===i){let t=e.description_it;t&&t!==e.description||(t=n(e.description,"desc")),c=t||e.description||""}if(c){const e=document.createElement("div");e.className="item-description",e.innerHTML=(l=c)?l.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>"):"",t.appendChild(e)}var l;if(window.isAdmin){const n=document.createElement("button");n.className="item-edit-btn",n.textContent=window.t("pricingGrid.btn.edit"),n.onclick=()=>upravitPolozku(e),t.appendChild(n)}return t}(e);s.appendChild(t)}),a.appendChild(r),a.appendChild(s),t.appendChild(a)})}window.addEventListener("DOMContentLoaded",()=>{i()}),window.upravitPolozku=function(e){t=e;const n=window.ziskejAktualniJazyk?window.ziskejAktualniJazyk():"cs";document.getElementById("modal-title").textContent=window.t("pricingGrid.modal.titleEdit"),document.getElementById("item-id").value=e.id,document.getElementById("edit-lang").value=n;const i=document.querySelector(".language-info span");i&&(i.textContent=window.t("pricingGrid.info.editingLanguage")),"cs"===n?(document.getElementById("service-name").value=e.service_name||"",document.getElementById("description").value=e.description||"",document.getElementById("category").value=e.category||""):"en"===n?(document.getElementById("service-name").value=e.service_name_en||e.service_name||"",document.getElementById("description").value=e.description_en||e.description||"",document.getElementById("category").value=e.category_en||e.category||""):"it"===n&&(document.getElementById("service-name").value=e.service_name_it||e.service_name||"",document.getElementById("description").value=e.description_it||e.description||"",document.getElementById("category").value=e.category_it||e.category||""),document.getElementById("price-from").value=e.price_from||"",document.getElementById("price-to").value=e.price_to||"",document.getElementById("price-unit").value=e.price_unit,document.getElementById("is-active").checked=1==e.is_active,document.getElementById("delete-btn").style.display="inline-block",document.getElementById("edit-modal").style.display="flex"},window.pridatPolozku=function(){t=null;const e=window.ziskejAktualniJazyk?window.ziskejAktualniJazyk():"cs";document.getElementById("modal-title").textContent=window.t("pricingGrid.modal.titleAdd"),document.getElementById("edit-form").reset(),document.getElementById("item-id").value="",document.getElementById("edit-lang").value=e,document.getElementById("is-active").checked=!0;const n=document.querySelector(".language-info span");n&&(n.textContent=window.t("pricingGrid.info.editingLanguage")),document.getElementById("delete-btn").style.display="none",document.getElementById("edit-modal").style.display="flex"},window.ulozitPolozku=async function(e){e.preventDefault();const t=e.target,n=new FormData(t);n.append("csrf_token",window.csrfToken);const o=n.get("id"),a=o?"update":"create";n.append("action",a),n.get("is_active")||n.append("is_active","0");try{const e=await fetch("/api/pricing_api.php",{method:"POST",body:n}),t=await e.json();"success"===t.status?(alert(o?window.t("pricingGrid.alert.updated"):window.t("pricingGrid.alert.created")),zavritModal(),i()):alert(window.t("pricingGrid.alert.error")+": "+t.message)}catch(e){console.error("[Ceník] Chyba při ukládání:",e),alert(window.t("pricingGrid.alert.saveError"))}},window.smazatPolozku=async function(){if(!t)return;if(!confirm(window.t("pricingGrid.alert.deleteConfirm")))return;const e=new FormData;e.append("action","delete"),e.append("id",t.id),e.append("csrf_token",window.csrfToken);try{const t=await fetch("/api/pricing_api.php",{method:"POST",body:e}),n=await t.json();"success"===n.status?(alert(window.t("pricingGrid.alert.deleted")),zavritModal(),i()):alert(window.t("pricingGrid.alert.error")+": "+n.message)}catch(e){console.error("[Ceník] Chyba při mazání:",e),alert(window.t("pricingGrid.alert.deleteError"))}},window.zavritModal=function(){document.getElementById("edit-modal").style.display="none",t=null},window.addEventListener("click",e=>{const t=document.getElementById("edit-modal");e.target===t&&zavritModal()});const a=window.prepniJazyk;a&&(window.prepniJazyk=function(t){a(t),e&&Object.keys(e).length>0&&o(e)}),window.exportovatCenikDoPDF=async function(){try{if(void 0===window.jspdf||"undefined"==typeof html2canvas)return void alert("Knihovny pro PDF export se ještě načítají. Zkuste to prosím za chvíli.");const t=window.ziskejAktualniJazyk?window.ziskejAktualniJazyk():"cs";console.log(`[Ceník] Generuji PDF v jazyce: ${t}`);const n={cs:{title:"Ceník služeb - White Glove Service",noteTitle:"Poznámka:",noteText:"Všechny ceny jsou uvedeny za práci BEZ materiálu. Materiál se účtuje zvlášť. Konečná cena může být ovlivněna složitostí opravy, dostupností materiálu a vzdáleností od naší dílny.",fromPrefix:"Od",byAgreement:"Dle dohody",footerQuestion:"Máte dotazy k cenám?",footerContact:"Neváhejte nás kontaktovat pro nezávaznou cenovou nabídku.",generated:"Generováno",tel:"Tel:",email:"Email:"},en:{title:"Price List - White Glove Service",noteTitle:"Note:",noteText:"All prices are for labor ONLY, excluding materials. Materials are charged separately. Final price may be affected by repair complexity, material availability, and distance from our workshop.",fromPrefix:"From",byAgreement:"By agreement",footerQuestion:"Questions about pricing?",footerContact:"Feel free to contact us for a non-binding quote.",generated:"Generated",tel:"Tel:",email:"Email:"},it:{title:"Listino Prezzi - White Glove Service",noteTitle:"Nota:",noteText:"Tutti i prezzi sono solo per il lavoro SENZA materiali. I materiali vengono fatturati separatamente. Il prezzo finale può essere influenzato dalla complessità della riparazione, dalla disponibilità dei materiali e dalla distanza dal nostro laboratorio.",fromPrefix:"Da",byAgreement:"Secondo accordo",footerQuestion:"Domande sui prezzi?",footerContact:"Non esitare a contattarci per un preventivo non vincolante.",generated:"Generato",tel:"Tel:",email:"Email:"}},i=n[t]||n.cs,o=document.createElement("div");o.id="pdf-cenik-wrapper-temp",o.style.cssText="\n                position: fixed;\n                left: -9999px;\n                top: 0;\n                width: 800px;\n                background: white;\n                padding: 20px;\n                font-family: 'Poppins', sans-serif;\n            ";const a=document.createElement("div");a.style.cssText="\n                text-align: center;\n                border-bottom: 3px solid #000;\n                padding-bottom: 15px;\n                margin-bottom: 30px;\n            ",a.innerHTML='\n                <div style="font-size: 24px; font-weight: 700; color: #000; margin-bottom: 10px;">\n                    WHITE GLOVE SERVICE\n                </div>\n                <div style="font-size: 12px; color: #333; line-height: 1.6;">\n                    Do Dubče 364, Běchovice 190 11 · +420 725 965 826 · reklamace@wgs-service.cz · IČO 09769684\n                </div>\n                <div style="font-size: 11px; color: #333; margin-top: 5px; font-weight: 600;">\n                    www.wgs-service.cz\n                </div>\n            ',o.appendChild(a);const r=document.createElement("h1");r.style.cssText="\n                font-size: 22px;\n                font-weight: 700;\n                color: #000;\n                margin: 20px 0;\n                text-align: center;\n            ",r.textContent=i.title,o.appendChild(r);const d=document.createElement("div");if(d.style.cssText="\n                background: #fff9f0;\n                border-left: 4px solid #ff9900;\n                padding: 12px 15px;\n                margin: 15px 0 25px 0;\n                font-size: 11px;\n                color: #333;\n                line-height: 1.5;\n            ",d.innerHTML=`\n                <strong>${i.noteTitle}</strong> ${i.noteText}\n            `,o.appendChild(d),!e||0===Object.keys(e).length)return void alert("Ceník není načten. Zkuste to prosím znovu.");Object.keys(e).sort().forEach(n=>{const a=e[n][0];let r=n;"en"===t&&a.category_en?r=a.category_en:"it"===t&&a.category_it&&(r=a.category_it);const d=document.createElement("div");d.style.cssText="\n                    background: #4a4a4a;\n                    color: white;\n                    padding: 10px 15px;\n                    font-size: 14px;\n                    font-weight: 600;\n                    margin-top: 25px;\n                    margin-bottom: 10px;\n                    border-radius: 5px 5px 0 0;\n                ",d.textContent=r,o.appendChild(d);const c=document.createElement("div");c.style.cssText="\n                    background: white;\n                    border: 1px solid #ddd;\n                    border-top: none;\n                    border-radius: 0 0 5px 5px;\n                    margin-bottom: 5px;\n                ",e[n].forEach((o,a)=>{const r=document.createElement("div");r.style.cssText=`\n                        padding: 12px 15px;\n                        ${a<e[n].length-1?"border-bottom: 1px solid #eee;":""}\n                    `;const d=document.createElement("div");d.style.cssText="\n                        display: flex;\n                        justify-content: space-between;\n                        align-items: baseline;\n                        margin-bottom: 5px;\n                    ";const l=document.createElement("div");l.style.cssText="\n                        font-size: 14px;\n                        font-weight: 600;\n                        color: #2a2a2a;\n                        flex: 1;\n                    ";let s=o.service_name;"en"===t&&o.service_name_en?s=o.service_name_en:"it"===t&&o.service_name_it&&(s=o.service_name_it),l.textContent=s;const p=document.createElement("div");p.style.cssText="\n                        font-size: 16px;\n                        font-weight: 700;\n                        color: #4a4a4a;\n                        white-space: nowrap;\n                        margin-left: 20px;\n                    ",o.price_from&&o.price_to?p.textContent=`${o.price_from} - ${o.price_to} ${o.price_unit}`:o.price_from?p.textContent=`${i.fromPrefix} ${o.price_from} ${o.price_unit}`:o.price_to?p.textContent=`${o.price_to} ${o.price_unit}`:p.textContent=i.byAgreement,d.appendChild(l),d.appendChild(p),r.appendChild(d);let m=o.description;if("en"===t&&o.description_en?m=o.description_en:"it"===t&&o.description_it&&(m=o.description_it),m){const e=document.createElement("div");e.style.cssText="\n                            font-size: 11px;\n                            color: #666;\n                            line-height: 1.5;\n                            margin-top: 5px;\n                        ",e.textContent=m,r.appendChild(e)}c.appendChild(r)}),o.appendChild(c)});const c=document.createElement("div");c.style.cssText="\n                margin-top: 40px;\n                padding-top: 20px;\n                border-top: 2px solid #ddd;\n                text-align: center;\n                font-size: 11px;\n                color: #333;\n            ",c.innerHTML=`\n                <div style="font-weight: 600; margin-bottom: 10px;">${i.footerQuestion}</div>\n                <div>${i.footerContact}</div>\n                <div style="margin-top: 10px;">\n                    <strong>${i.tel}</strong> +420 725 965 826 ·\n                    <strong>${i.email}</strong> reklamace@wgs-service.cz\n                </div>\n                <div style="margin-top: 15px; font-size: 10px; color: #999;">\n                    www.wgs-service.cz · ${i.generated} ${(new Date).toLocaleDateString("cs-CZ")}\n                </div>\n            `,o.appendChild(c),document.body.appendChild(o),await new Promise(e=>setTimeout(e,200)),console.log("[Ceník] Renderuji pomocí html2canvas...");const l=await html2canvas(o,{scale:2,backgroundColor:"#ffffff",useCORS:!0,logging:!1,imageTimeout:0,allowTaint:!0,letterRendering:!0}),s=l.toDataURL("image/jpeg",.95),{jsPDF:p}=window.jspdf,m=new p("p","mm","a4"),u=10,g=210-2*u,w=297-2*u,y=l.height/l.width;let v=g,f=v*y;f>w&&(f=w,v=f/y,console.log(`[Ceník] Obsah zmenšen na ${Math.round(v)}x${Math.round(f)}mm pro vložení na jednu A4`));const x=u+(g-v)/2;m.addImage(s,"JPEG",x,u,v,f),document.body.removeChild(o);const k=(new Date).toLocaleDateString("cs-CZ").replace(/\./g,"-"),h=t.toUpperCase();m.save(`WGS-Cenik-${h}-${k}.pdf`),console.log(`[Ceník] PDF úspěšně vygenerováno a staženo (jazyk: ${h})`)}catch(e){console.error("[Ceník] Chyba při generování PDF:",e),alert("Chyba při generování PDF: "+e.message)}},window.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("edit-form");e&&e.addEventListener("submit",function(e){e.preventDefault(),window.ulozitPolozku(e)})})}(),void 0!==window.Utils&&window.Utils.registerAction&&(window.Utils.registerAction("pridatPolozku",()=>{"function"==typeof window.pridatPolozku&&window.pridatPolozku()}),window.Utils.registerAction("exportovatCenikDoPDF",()=>{"function"==typeof window.exportovatCenikDoPDF&&window.exportovatCenikDoPDF()}),window.Utils.registerAction("zavritModal",()=>{"function"==typeof window.zavritModal&&window.zavritModal()}),window.Utils.registerAction("smazatPolozku",()=>{"function"==typeof window.smazatPolozku&&window.smazatPolozku()}));
//# sourceMappingURL=cenik.min.js.map