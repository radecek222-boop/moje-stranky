!function(){"use strict";const e={canvas:null,ctx:null,config:{radius:30,blur:20,maxIntensity:100,gradient:{0:"rgba(0, 0, 255, 0)",.2:"rgba(0, 255, 255, 0.5)",.4:"rgba(0, 255, 0, 0.7)",.6:"rgba(255, 255, 0, 0.8)",.8:"rgba(255, 128, 0, 0.9)",1:"rgba(255, 0, 0, 1)"}},init:function(e){return this.canvas=document.getElementById(e),this.canvas?(this.ctx=this.canvas.getContext("2d"),console.log("[Heatmap Renderer] Inicializováno"),!0):(console.error("[Heatmap Renderer] Canvas nenalezen:",e),!1)},renderClickHeatmap:function(e){if(!this.ctx)return void console.error("[Heatmap Renderer] Canvas není inicializován");if(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),!e.points||0===e.points.length)return void console.warn("[Heatmap Renderer] Žádné click body k zobrazení");console.log("[Heatmap Renderer] Renderuji",e.points.length,"click bodů");const t=Math.max(...e.points.map(e=>e.count));e.points.forEach(e=>{const n=e.x/100*this.canvas.width,a=e.y/100*this.canvas.height,r=e.count/t;this.drawHeatPoint(n,a,r)}),this.applyGradient(),console.log("[Heatmap Renderer] Click heatmap vykreslena")},renderScrollHeatmap:function(e){if(!this.ctx)return void console.error("[Heatmap Renderer] Canvas není inicializován");if(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),!e.buckets||0===e.buckets.length)return void console.warn("[Heatmap Renderer] Žádné scroll buckets k zobrazení");console.log("[Heatmap Renderer] Renderuji",e.buckets.length,"scroll buckets");const t=this.canvas.height/10;e.buckets.forEach(e=>{const n=e.depth/10*t,a=e.percentage/100,r=this.getColorForIntensity(a);this.ctx.fillStyle=`rgba(${r.r}, ${r.g}, ${r.b}, ${r.a/255})`,this.ctx.fillRect(0,n,this.canvas.width,t)}),console.log("[Heatmap Renderer] Scroll heatmap vykreslena")},drawHeatPoint:function(e,t,n){const a=this.ctx.createRadialGradient(e,t,0,e,t,this.config.radius),r=Math.min(.8*n,.8);a.addColorStop(0,`rgba(0, 0, 0, ${r})`),a.addColorStop(1,"rgba(0, 0, 0, 0)"),this.ctx.fillStyle=a,this.ctx.fillRect(e-this.config.radius,t-this.config.radius,2*this.config.radius,2*this.config.radius)},applyGradient:function(){const e=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height),t=e.data;for(let e=0;e<t.length;e+=4){const n=t[e+3];if(n>0){const a=n/255,r=this.getColorForIntensity(a);t[e]=r.r,t[e+1]=r.g,t[e+2]=r.b,t[e+3]=r.a}}this.ctx.putImageData(e,0,0)},getColorForIntensity:function(e){const t=Object.keys(this.config.gradient).map(Number).sort((e,t)=>e-t);for(let n=0;n<t.length-1;n++)if(e>=t[n]&&e<=t[n+1]){const a=t[n],r=t[n+1],o=(e-a)/(r-a),i=this.parseColor(this.config.gradient[a]),s=this.parseColor(this.config.gradient[r]);return{r:Math.round(i.r+(s.r-i.r)*o),g:Math.round(i.g+(s.g-i.g)*o),b:Math.round(i.b+(s.b-i.b)*o),a:Math.round(i.a+(s.a-i.a)*o)}}return{r:0,g:0,b:0,a:0}},parseColor:function(e){const t=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)/);return t?{r:parseInt(t[1]),g:parseInt(t[2]),b:parseInt(t[3]),a:t[4]?Math.round(255*parseFloat(t[4])):255}:{r:0,g:0,b:0,a:0}},renderLegend:function(e){const t=document.getElementById(e);if(!t)return void console.error("[Heatmap Renderer] Legend container nenalezen:",e);t.innerHTML="";const n=document.createElement("canvas");n.width=20,n.height=200;const a=n.getContext("2d"),r=a.createLinearGradient(0,200,0,0);Object.entries(this.config.gradient).forEach(([e,t])=>{r.addColorStop(parseFloat(e),t)}),a.fillStyle=r,a.fillRect(0,0,20,200);const o=document.createElement("div");o.style.cssText="position: absolute; right: 30px; height: 200px; display: flex; flex-direction: column; justify-content: space-between;";["Vysoká","Střední","Nízká"].forEach(e=>{const t=document.createElement("div");t.textContent=e,t.style.cssText="font-size: 12px; color: #333;",o.appendChild(t)}),t.style.position="relative",t.appendChild(n),t.appendChild(o),console.log("[Heatmap Renderer] Legenda vykreslena")},exportToPNG:function(e="heatmap.png"){if(!this.canvas)return void console.error("[Heatmap Renderer] Canvas není inicializován");const t=document.createElement("a");t.download=e,t.href=this.canvas.toDataURL("image/png"),t.click(),console.log("[Heatmap Renderer] Export PNG:",e)}};window.HeatmapRenderer=e}();