(function(){'use strict';var HEARTBEAT_INTERVAL = 30000;var API_ENDPOINT = '/api/heartbeat.php';var heartbeatTimer = null;var isRunning = false;function sendHeartbeat(){fetch(API_ENDPOINT,{method:'POST',credentials:'same-origin',headers:{'Cache-Control':'no-cache','Pragma':'no-cache'}}).then(function(response){return response.json();}).then(function(data){if(data.status === 'success'){if(window.console && window.console.debug){console.debug('[Heartbeat] OK:',data.timestamp);}}}).catch(function(error){if(window.console && window.console.debug){console.debug('[Heartbeat] Chyba:',error);}});}function startHeartbeat(){if(isRunning)return;isRunning = true;setTimeout(sendHeartbeat,500);heartbeatTimer = setInterval(sendHeartbeat,HEARTBEAT_INTERVAL);if(window.console && window.console.debug){console.debug('[Heartbeat] Spusten(interval:' + HEARTBEAT_INTERVAL + 'ms)');}}function stopHeartbeat(){if(!isRunning)return;isRunning = false;if(heartbeatTimer){clearInterval(heartbeatTimer);heartbeatTimer = null;}if(window.console && window.console.debug){console.debug('[Heartbeat] Zastaven');}}function init(){startHeartbeat();window.addEventListener('beforeunload',function(){stopHeartbeat();});document.addEventListener('visibilitychange',function(){if(document.hidden){stopHeartbeat();}else{startHeartbeat();}});}if(document.readyState === 'loading'){document.addEventListener('DOMContentLoaded',init);}else{init();}window.OnlineHeartbeat ={start:startHeartbeat,stop:stopHeartbeat,ping:sendHeartbeat};})();