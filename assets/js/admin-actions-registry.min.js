document.addEventListener("DOMContentLoaded",function(){"undefined"!=typeof Utils&&Utils.registerAction?(console.log("[AdminActions] Registrace centralizovaných akcí..."),Utils.registerAction("reloadPage",()=>location.reload()),Utils.registerAction("executeAction",(t,e)=>{e.id&&"function"==typeof executeAction&&executeAction(event,e.id)}),Utils.registerAction("completeAction",(t,e)=>{e.id&&"function"==typeof completeAction&&completeAction(e.id)}),Utils.registerAction("dismissAction",(t,e)=>{e.id&&"function"==typeof dismissAction&&dismissAction(e.id)}),Utils.registerAction("viewAllWebhooks",()=>{"function"==typeof viewAllWebhooks&&viewAllWebhooks()}),Utils.registerAction("setupGitHubWebhook",()=>{"function"==typeof setupGitHubWebhook&&setupGitHubWebhook()}),Utils.registerAction("saveConfig",(t,e)=>{e.id&&e.key&&"function"==typeof saveConfig&&saveConfig(e.id,e.key)}),Utils.registerAction("onChangeConfig",(t,e)=>{e.id&&e.key&&"function"==typeof saveConfig&&saveConfig(e.id,e.key)}),Utils.registerAction("runDiagnostics",()=>{"function"==typeof runDiagnostics&&runDiagnostics()}),Utils.registerAction("clearConsole",()=>{"function"==typeof clearConsole&&clearConsole()}),Utils.registerAction("exportLog",()=>{"function"==typeof exportLog&&exportLog()}),Utils.registerAction("clearCacheMaintenance",()=>{"function"==typeof clearCacheMaintenance&&clearCacheMaintenance()}),Utils.registerAction("optimizeDatabaseMaintenance",()=>{"function"==typeof optimizeDatabaseMaintenance&&optimizeDatabaseMaintenance()}),Utils.registerAction("cleanupLogsMaintenance",()=>{"function"==typeof cleanupLogsMaintenance&&cleanupLogsMaintenance()}),Utils.registerAction("archiveLogsMaintenance",()=>{"function"==typeof archiveLogsMaintenance&&archiveLogsMaintenance()}),Utils.registerAction("viewLog",(t,e)=>{e.log&&"function"==typeof viewLog&&viewLog(e.log)}),Utils.registerAction("clearCache",()=>{"function"==typeof clearCache&&clearCache()}),Utils.registerAction("archiveLogs",()=>{"function"==typeof archiveLogs&&archiveLogs()}),Utils.registerAction("optimizeDatabase",()=>{"function"==typeof optimizeDatabase&&optimizeDatabase()}),Utils.registerAction("createBackup",()=>{"function"==typeof createBackup&&createBackup()}),Utils.registerAction("viewBackups",()=>{"function"==typeof viewBackups&&viewBackups()}),Utils.registerAction("setupActionsSystem",()=>{"function"==typeof setupActionsSystem&&setupActionsSystem()}),Utils.registerAction("switchEmailSection",(t,e)=>{e.section&&"function"==typeof switchSection&&switchSection(e.section)}),Utils.registerAction("togglePasswordVisibility",(t,e)=>{e.id&&"function"==typeof togglePasswordVisibility&&togglePasswordVisibility(parseInt(e.id))}),Utils.registerAction("saveEmailConfig",(t,e)=>{e.id&&e.key&&"function"==typeof saveConfig&&saveConfig(parseInt(e.id),e.key)}),Utils.registerAction("sendTestEmail",()=>{"function"==typeof sendTestEmail&&sendTestEmail()}),Utils.registerAction("toggleNotifikaceActive",(t,e)=>{e.id&&"function"==typeof toggleNotifikaceActive&&toggleNotifikaceActive(e.id,t)}),Utils.registerAction("otevritNotifikace",(t,e)=>{e.id&&"function"==typeof otevritNotifikace&&otevritNotifikace(e.id)}),Utils.registerAction("switchSecuritySection",(t,e)=>{e.section&&"function"==typeof switchSection&&switchSection(e.section)}),Utils.registerAction("otevritPozvanku",()=>{"function"==typeof otevritPozvanku&&otevritPozvanku()}),Utils.registerAction("vytvorNovyKlic",()=>{"function"==typeof vytvorNovyKlic&&vytvorNovyKlic()}),Utils.registerAction("nactiRegistracniKlice",()=>{"function"==typeof nactiRegistracniKlice&&nactiRegistracniKlice()}),Utils.registerAction("togglePasswordVisibilitySimple",(t,e)=>{e.input&&"function"==typeof togglePasswordVisibilitySimple&&togglePasswordVisibilitySimple(e.input)}),Utils.registerAction("ulozitApiKlic",(t,e)=>{e.key&&e.input&&"function"==typeof ulozitApiKlic&&ulozitApiKlic(e.key,e.input)}),Utils.registerAction("saveSecurityConfig",(t,e)=>{e.id&&e.key&&"function"==typeof saveConfig&&saveConfig(parseInt(e.id),e.key)}),Utils.registerAction("zmenitAdminHeslo",()=>{"function"==typeof zmenitAdminHeslo&&zmenitAdminHeslo()}),Utils.registerAction("resetovatUzivatelskeHeslo",()=>{"function"==typeof resetovatUzivatelskeHeslo&&resetovatUzivatelskeHeslo()}),Utils.registerAction("nactiAuditLogy",()=>{"function"==typeof nactiAuditLogy&&nactiAuditLogy()}),Utils.registerAction("kopirovatDoSchranky",(t,e)=>{e.code&&"function"==typeof kopirovatDoSchranky&&kopirovatDoSchranky(e.code)}),Utils.registerAction("smazatKlic",(t,e)=>{e.code&&"function"==typeof smazatKlic&&smazatKlic(e.code)}),Utils.registerAction("odeslatVytvoreniKlice",()=>{"function"==typeof odeslatVytvoreniKlice&&odeslatVytvoreniKlice()}),Utils.registerAction("zavritModalVytvorKlic",()=>{const t=document.getElementById("modalVytvorKlic");t&&t.remove()}),Utils.registerAction("zavritModalPozvanka",()=>{const t=document.getElementById("modalPozvanka");t&&t.remove()}),Utils.registerAction("odeslatPozvanky",()=>{"function"==typeof odeslatPozvanky&&odeslatPozvanky()}),Utils.registerAction("aktualizovatVyber",()=>{"function"==typeof aktualizovatVyber&&aktualizovatVyber()}),Utils.registerAction("refreshOnlineUzivatele",()=>{"function"==typeof nactiOnlineUzivatele&&nactiOnlineUzivatele()}),Utils.registerAction("filterEmaily",(t,e)=>{e.filter&&"function"==typeof filterEmaily&&filterEmaily(e.filter)}),Utils.registerAction("openEmailDetailModal",(t,e)=>{e.id&&"function"==typeof openEmailDetailModal&&openEmailDetailModal(e.id)}),Utils.registerAction("closeEmailDetailModal",()=>{const t=document.getElementById("emailDetailModal");t&&(t.style.display="none")}),Utils.registerAction("zavritSablonaModal",()=>{const t=document.getElementById("sablonaModal");t&&(t.style.display="none")}),Utils.registerAction("editSmsTemplate",(t,e)=>{e.id&&"function"==typeof editSmsTemplate&&editSmsTemplate(e.id)}),Utils.registerAction("closeSmsModal",()=>{const t=document.getElementById("smsModal");t&&(t.style.display="none")}),Utils.registerAction("saveSmsTemplate",(t,e)=>{e.id&&"function"==typeof saveSmsTemplate&&saveSmsTemplate(e.id)}),Utils.registerAction("otevritModalPrijemcu",(t,e)=>{e.id&&"function"==typeof otevritModalPrijemcu&&otevritModalPrijemcu(e.id)}),Utils.registerAction("zavritModalPrijemcu",()=>{const t=document.getElementById("modalPrijemcu");t&&(t.style.display="none")}),Utils.registerAction("ulozitPrijemce",()=>{"function"==typeof ulozitPrijemce&&ulozitPrijemce()}),Utils.registerAction("ulozitSablonu",(t,e)=>{e.id&&"function"==typeof ulozitSablonu&&ulozitSablonu(e.id)}),Utils.registerAction("upravitEmailKlice",(t,e)=>{e.code&&"function"==typeof upravitEmailKlice&&upravitEmailKlice(e.code,e.email||"")}),Utils.registerAction("openNewWindow",(t,e)=>{e.url&&window.open(e.url,"_blank")}),Utils.registerAction("openSection",(t,e)=>{e.section&&"function"==typeof openSection&&openSection(e.section)}),Utils.registerAction("zmenitStavReklamace",(t,e)=>{e.id&&"function"==typeof zmenitStavReklamace&&zmenitStavReklamace(e.id,t.value)}),Utils.registerAction("filterReklamace",(t,e)=>{e.filter&&"function"==typeof filterReklamace&&filterReklamace(e.filter)}),Utils.registerAction("smazatReklamaci",(t,e)=>{e.id&&e.cislo&&"function"==typeof smazatReklamaci&&smazatReklamaci(e.id,e.cislo)}),Utils.registerAction("otevritDetailReklamace",(t,e)=>{e.id&&"function"==typeof otevritDetailReklamace&&otevritDetailReklamace(e.id)}),Utils.registerAction("zavritDetailModal",()=>{"function"==typeof zavritDetailModal&&zavritDetailModal()}),Utils.registerAction("zobrazDetailUzivatele",(t,e)=>{e.id&&"function"==typeof zobrazDetailUzivatele&&zobrazDetailUzivatele(e.id)}),Utils.registerAction("zavritDetailUzivatele",()=>{"function"==typeof zavritDetailUzivatele&&zavritDetailUzivatele()}),Utils.registerAction("ulozitZmenyUzivatele",(t,e)=>{e.id&&"function"==typeof ulozitZmenyUzivatele&&ulozitZmenyUzivatele(e.id)}),Utils.registerAction("zmenitHesloUzivatele",(t,e)=>{e.id&&"function"==typeof zmenitHesloUzivatele&&zmenitHesloUzivatele(e.id)}),Utils.registerAction("prepnoutStatusUzivatele",(t,e)=>{e.id&&e.status&&"function"==typeof prepnoutStatusUzivatele&&prepnoutStatusUzivatele(e.id,e.status)}),Utils.registerAction("otevritSpravuSupervize",(t,e)=>{e.id&&"function"==typeof otevritSpravuSupervize&&otevritSpravuSupervize(e.id)}),Utils.registerAction("zavritSupervizorOverlay",()=>{"function"==typeof zavritSupervizorOverlay&&zavritSupervizorOverlay()}),Utils.registerAction("ulozitSupervizorPrirazeni",(t,e)=>{e.id&&"function"==typeof ulozitSupervizorPrirazeni&&ulozitSupervizorPrirazeni(e.id)}),Utils.registerAction("deleteUser",(t,e)=>{e.id&&"function"==typeof deleteUser&&(t.closest('[data-action="stopPropagation"]')?.dispatchEvent(new Event("click",{bubbles:!1})),deleteUser(e.id))}),Utils.registerAction("cleanupTestData",()=>{"function"==typeof cleanupTestData&&cleanupTestData()}),Utils.registerAction("viewTestDataInDB",()=>{"function"==typeof viewTestDataInDB&&viewTestDataInDB()}),Utils.registerAction("copyResults",()=>{"function"==typeof copyResults&&copyResults()}),Utils.registerAction("selectRole",(t,e)=>{e.role&&"function"==typeof selectRole&&selectRole(e.role)}),Utils.registerAction("startInteractiveTest",()=>{"function"==typeof startTest&&startTest()}),Utils.registerAction("executeStep1",()=>{"function"==typeof executeStep1&&executeStep1()}),Utils.registerAction("resetInteractiveTest",()=>{"function"==typeof resetTest&&resetTest()}),Utils.registerAction("goToInteractiveStep",(t,e)=>{e.step&&"function"==typeof goToStep&&goToStep(parseInt(e.step))}),Utils.registerAction("cleanupInteractiveTestData",()=>{"function"==typeof cleanupTestData&&cleanupTestData()}),Utils.registerAction("startTest",()=>{"function"==typeof startTest&&startTest()}),Utils.registerAction("resetSimulator",()=>{"function"==typeof resetSimulator&&resetSimulator()}),Utils.registerAction("cleanupTest",()=>{"function"==typeof cleanupTest&&cleanupTest()}),Utils.registerAction("goToStage",(t,e)=>{e.stage&&"function"==typeof goToStage&&goToStage(parseInt(e.stage))}),Utils.registerAction("flagError",(t,e)=>{e.stage&&e.message&&"function"==typeof flagError&&flagError(parseInt(e.stage),e.message)}),Utils.registerAction("testSmtpConnection",async()=>{try{let t=null;if("function"==typeof getCSRFToken)t=await getCSRFToken();else{const e=document.querySelector('input[name="csrf_token"]');t=e?e.value:null}if(!t)throw new Error("CSRF token není dostupný");const e=await fetch("/api/admin.php?action=test_smtp_connection",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify({csrf_token:t})}),i=await e.json().catch(()=>({}));if(!e.ok||"error"===i.status)throw new Error(i.message||`HTTP ${e.status}`);"undefined"!=typeof wgsToast&&wgsToast.success?wgsToast.success(i.message||"SMTP test úspěšný"):alert(i.message||"SMTP test úspěšný")}catch(t){console.error("[SMTP] Test failed:",t),"undefined"!=typeof wgsToast&&wgsToast.error?wgsToast.error(t?.message||"Chyba při testu SMTP"):alert("Chyba: "+(t?.message||"Chyba při testu SMTP"))}}),Utils.registerAction("saveSmtpConfig",async()=>{try{let t=null;if("function"==typeof getCSRFToken)t=await getCSRFToken();else{const e=document.querySelector('input[name="csrf_token"]');t=e?e.value:null}if(!t)throw new Error("CSRF token není dostupný");const e={smtp_host:document.getElementById("smtp_host")?.value?.trim()||"",smtp_port:document.getElementById("smtp_port")?.value?.trim()||"587",smtp_encryption:document.getElementById("smtp_encryption")?.value||"tls",smtp_username:document.getElementById("smtp_username")?.value?.trim()||"",smtp_password:document.getElementById("smtp_password")?.value||"",smtp_from:document.getElementById("smtp_from")?.value?.trim()||"",smtp_from_name:document.getElementById("smtp_from_name")?.value?.trim()||""},i=await fetch("/api/admin.php?action=save_smtp_config",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,csrf_token:t})}),o=await i.json().catch(()=>({}));if(!i.ok||"error"===o.status)throw new Error(o.message||`HTTP ${i.status}`);"undefined"!=typeof wgsToast&&wgsToast.success?wgsToast.success(o.message||"SMTP konfigurace uložena"):alert(o.message||"SMTP konfigurace uložena")}catch(t){console.error("[SMTP] Save failed:",t),"undefined"!=typeof wgsToast&&wgsToast.error?wgsToast.error(t?.message||"Chyba při ukládání SMTP"):alert("Chyba: "+(t?.message||"Chyba při ukládání SMTP"))}}),console.log("[AdminActions] ✓ Všechny akce zaregistrovány")):console.error("[AdminActions] Utils není k dispozici!")});