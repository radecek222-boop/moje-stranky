!function(){"use strict";console.log("[Protokol-Kalkulačka] Inicializace integrace...");let o=null,a=null,l=null;async function e(){console.log("[Protokol-Kalkulačka] Otevírám modal...");try{if(l.innerHTML='\n                <div style="text-align: center; padding: 40px;">\n                    <div style="width: 50px; height: 50px; border: 4px solid #ddd;\n                                border-top: 4px solid #333333; border-radius: 50%;\n                                animation: spin 1s linear infinite; margin: 0 auto 15px;"></div>\n                    <p style="color: #666;">Načítám kalkulačku...</p>\n                </div>\n            ',!document.getElementById("calc-spinner-style")){const o=document.createElement("style");o.id="calc-spinner-style",o.textContent="@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }",document.head.appendChild(o)}window.calculatorModal&&window.calculatorModal.open?window.calculatorModal.open():a.style.display="flex";const o=await fetch("cenik.php");if(!o.ok)throw new Error("Nepodařilo se načíst kalkulačku");const e=await o.text(),n=new DOMParser,t=n.parseFromString(e,"text/html").getElementById("kalkulacka");if(!t)throw new Error("Kalkulačka nebyla nalezena v HTML");l.innerHTML=t.outerHTML,"function"==typeof window.initKalkulacka?(window.initKalkulacka(),console.log("[Protokol-Kalkulačka] Kalkulačka reinicializována")):console.warn("[Protokol-Kalkulačka] Funkce initKalkulacka není dostupná"),"function"==typeof window.nastavitKalkulackuRezim&&(window.nastavitKalkulackuRezim("protokol"),console.log('[Protokol-Kalkulačka] Režim nastaven na "protokol"'));const k=document.getElementById("address")?.value,c=document.getElementById("customer")?.value,i=document.getElementById("claim-number")?.value;if(console.log("[Protokol-Kalkulačka] Data zákazníka:",{address:k,name:c,claim:i}),k&&""!==k.trim()){const o=document.getElementById("calc-address");o&&(o.value=k,console.log("[Protokol-Kalkulačka] Adresa předvyplněna:",k),setTimeout(()=>{const a=new Event("input",{bubbles:!0});o.dispatchEvent(a)},300))}console.log("[Protokol-Kalkulačka] Kalkulačka načtena")}catch(o){console.error("[Protokol-Kalkulačka] Chyba při načítání kalkulačky:",o),l.innerHTML=`\n                <div style="text-align: center; padding: 40px;">\n                    <h2>Chyba</h2>\n                    <p style="color: #d32f2f;">Nepodařilo se načíst kalkulačku.</p>\n                    <p>${o.message}</p>\n                    <button class="btn-primary" onclick="window.protokolKalkulacka.zavritModal()">Zavřít</button>\n                </div>\n            `}}function n(){console.log("[Protokol-Kalkulačka] Zavírám modal..."),window.calculatorModal&&window.calculatorModal.close?window.calculatorModal.close():a.style.display="none",l.innerHTML="",o=null,"function"==typeof window.nastavitKalkulackuRezim&&window.nastavitKalkulackuRezim("standalone")}document.addEventListener("DOMContentLoaded",()=>{console.log("[Protokol-Kalkulačka] DOM loaded"),a=document.getElementById("calculatorModalOverlay"),l=document.getElementById("calculatorModalBody");const o=document.getElementById("price-total");a&&l?(o&&(o.addEventListener("click",e),o.style.cursor="pointer"),console.log("[Protokol-Kalkulačka] Inicializace dokončena")):console.error("[Protokol-Kalkulačka] Modal elementy nenalezeny!")}),window.protokolKalkulacka={zpracovatVysledek:function(a){console.log("[Protokol-Kalkulačka] Zpracovávám výsledek:",a),o=a;const l=document.getElementById("price-total");l&&a.celkovaCena?(l.value=a.celkovaCena.toFixed(2),"function"==typeof showNotif&&showNotif("success",`Cena ${a.celkovaCena.toFixed(2)} € byla započítána`)):(console.error("[Protokol-Kalkulačka] Pole price-total nebo celková cena nenalezeny"),"function"==typeof showNotif&&showNotif("error","Chyba při přenosu ceny")),n(),async function(o){try{console.log("[Protokol-Kalkulačka] Ukládám kalkulaci do DB...");const a=currentReklamaceId||new URLSearchParams(window.location.search).get("id");if(!a)return void console.warn("[Protokol-Kalkulačka] Není známo ID reklamace, kalkulace nebude uložena");const l=await window.fetchCsrfToken();if(!l)return void console.error("[Protokol-Kalkulačka] Nepodařilo se získat CSRF token");console.log("[Protokol-Kalkulačka] CSRF token získán");const e=await fetch("/api/protokol_api.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"save_kalkulace",reklamace_id:a,kalkulace_data:o,csrf_token:l})}),n=await e.json();"success"===n.status?(console.log("[Protokol-Kalkulačka] Kalkulace uložena do DB"),void 0!==window.kalkulaceData?(window.kalkulaceData=o,console.log("[Protokol-Kalkulačka] Globální kalkulaceData aktualizována"),console.log("[Protokol-Kalkulačka] Celková cena:",o.celkovaCena,"€")):console.warn("[Protokol-Kalkulačka] window.kalkulaceData není definována")):console.error("[Protokol-Kalkulačka] Chyba při ukládání:",n.message)}catch(o){console.error("[Protokol-Kalkulačka] Chyba při ukládání kalkulace:",o)}}(a),console.log("[Protokol-Kalkulačka] Výsledek zpracován")},zavritModal:n}}();
//# sourceMappingURL=protokol-calculator-integration.min.js.map