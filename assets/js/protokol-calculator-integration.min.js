!function(){"use strict";let a=null,o=null,e=null;async function t(){try{if(e.innerHTML='\n                <div style="text-align: center; padding: 40px;">\n                    <div style="width: 50px; height: 50px; border: 4px solid #ddd;\n                                border-top: 4px solid #333333; border-radius: 50%;\n                                animation: spin 1s linear infinite; margin: 0 auto 15px;"></div>\n                    <p style="color: #666;">Načítám kalkulačku...</p>\n                </div>\n            ',!document.getElementById("calc-spinner-style")){const a=document.createElement("style");a.id="calc-spinner-style",a.textContent="@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }",document.head.appendChild(a)}window.calculatorModal&&window.calculatorModal.open?window.calculatorModal.open():o.classList.remove("hidden");const a=await fetch("cenik.php");if(!a.ok)throw new Error("Nepodařilo se načíst kalkulačku");const t=await a.text(),n=new DOMParser,l=n.parseFromString(t,"text/html").getElementById("kalkulacka");if(!l)throw new Error("Kalkulačka nebyla nalezena v HTML");e.innerHTML=l.outerHTML,"function"==typeof window.initKalkulacka?window.initKalkulacka():console.warn("[Protokol-Kalkulačka] Funkce initKalkulacka není dostupná"),"function"==typeof window.nastavitKalkulackuRezim&&window.nastavitKalkulackuRezim("protokol");const i=document.getElementById("address")?.value;document.getElementById("customer"),document.getElementById("claim-number");if(i&&""!==i.trim()){const a=document.getElementById("calc-address");a&&(a.value=i,setTimeout(()=>{const o=new Event("input",{bubbles:!0});a.dispatchEvent(o)},300))}}catch(a){console.error("[Protokol-Kalkulačka] Chyba při načítání kalkulačky:",a),e.innerHTML=`\n                <div style="text-align: center; padding: 40px;">\n                    <h2>Chyba</h2>\n                    <p style="color: #d32f2f;">Nepodařilo se načíst kalkulačku.</p>\n                    <p>${a.message}</p>\n                    <button class="btn-primary" data-action="zavritProtokolModal">Zavřít</button>\n                </div>\n            `}}function n(){window.calculatorModal&&window.calculatorModal.close?window.calculatorModal.close():o.classList.add("hidden"),e.innerHTML="",a=null,"function"==typeof window.nastavitKalkulackuRezim&&window.nastavitKalkulackuRezim("standalone")}document.addEventListener("DOMContentLoaded",()=>{o=document.getElementById("calculatorModalOverlay"),e=document.getElementById("calculatorModalBody");const a=document.getElementById("price-total");o&&e?a&&(a.addEventListener("click",t),a.style.cursor="pointer"):console.error("[Protokol-Kalkulačka] Modal elementy nenalezeny!")}),window.protokolKalkulacka={zpracovatVysledek:function(o){a=o;const e=document.getElementById("price-total");e&&o.celkovaCena?(e.value=o.celkovaCena.toFixed(2),"function"==typeof showNotif&&showNotif("success",`Cena ${o.celkovaCena.toFixed(2)} € byla započítána`)):(console.error("[Protokol-Kalkulačka] Pole price-total nebo celková cena nenalezeny"),"function"==typeof showNotif&&showNotif("error","Chyba při přenosu ceny")),n(),async function(a){try{const o=currentReklamaceId||new URLSearchParams(window.location.search).get("id");if(!o)return void console.warn("[Protokol-Kalkulačka] Není známo ID reklamace, kalkulace nebude uložena");const e=await window.fetchCsrfToken();if(!e)return void console.error("[Protokol-Kalkulačka] Nepodařilo se získat CSRF token");const t=await fetch("/api/protokol_api.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"save_kalkulace",reklamace_id:o,kalkulace_data:a,csrf_token:e})}),n=await t.json();"success"===n.status?void 0!==window.kalkulaceData?window.kalkulaceData=a:console.warn("[Protokol-Kalkulačka] window.kalkulaceData není definována"):console.error("[Protokol-Kalkulačka] Chyba při ukládání:",n.message)}catch(a){console.error("[Protokol-Kalkulačka] Chyba při ukládání kalkulace:",a)}}(o)},zavritModal:n},"undefined"!=typeof Utils&&Utils.registerAction&&Utils.registerAction("zavritProtokolModal",()=>{window.protokolKalkulacka&&"function"==typeof window.protokolKalkulacka.zavritModal&&window.protokolKalkulacka.zavritModal()})}();
//# sourceMappingURL=protokol-calculator-integration.min.js.map